{
  Defaults defaults=new Defaults(BibDatabaseMode.fromPreference(Globals.prefs.getBoolean(JabRefPreferences.BIBLATEX_DEFAULT_MODE)));
  BibDatabaseContext bibDatabaseContext=new BibDatabaseContext(database,metaData,defaults);
  SavePreferences savePrefs=SavePreferences.loadForExportFromPreferences(Globals.prefs);
  List<BibEntry> entries=BibDatabaseWriter.getSortedEntries(bibDatabaseContext,keySet,savePrefs);
  GroupTreeNode gtn=metaData.getGroups();
  final int database_id=getDatabaseIDByName(metaData,out,dbName);
  removeAllRecordsForAGivenDB(out,database_id);
  populateEntryTypesTable(out,bibDatabaseContext.getMode());
  populateEntriesTable(database_id,entries,out);
  populateStringTable(database,out,database_id);
  populateGroupTypesTable(out);
  populateGroupsTable(gtn,0,1,out,database_id);
  populateEntryGroupsTable(gtn,0,1,out,database_id);
}
