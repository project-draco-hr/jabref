{
  if (upgradeDatabase) {
    NamedCompound ce=Util.upgradePdfPsToFile(pr.getDatabase(),FIELDS_TO_LOOK_FOR);
    panel.undoManager.addEdit(ce);
    panel.markBaseChanged();
  }
  if (fileDir != null) {
    Globals.prefs.put(GUIGlobals.FILE_FIELD + "Directory",fileDir);
  }
  if (upgradePrefs) {
    Globals.prefs.putBoolean("pdfColumn",Boolean.FALSE);
    Globals.prefs.putBoolean("fileColumn",Boolean.TRUE);
    if (!showsFileInGenFields()) {
      String gfs=Globals.prefs.get(Globals.prefs.CUSTOM_TAB_FIELDS + "0");
      StringBuffer sb=new StringBuffer(gfs);
      if (gfs.length() > 0)       sb.append(";");
      sb.append(GUIGlobals.FILE_FIELD);
      Globals.prefs.put(Globals.prefs.CUSTOM_TAB_FIELDS + "0",sb.toString());
      Globals.prefs.updateEntryEditorTabList();
      panel.frame().removeCachedEntryEditors();
    }
    panel.frame().setupAllTables();
  }
}
