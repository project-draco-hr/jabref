{
  char c;
  int count=0;
  StringBuilder part=new StringBuilder();
  i++;
  while (i < text.length() && Character.isWhitespace(text.charAt(i))) {
    i++;
  }
  while (i < text.length()) {
    c=text.charAt(i);
    if (!terminateOnEndBraceOnly && count == 0 && Character.isWhitespace(c)) {
      break;
    }
    if (c == '}' && --count < 0) {
      break;
    }
 else     if (c == '{') {
      count++;
    }
    part.append(c);
    i++;
  }
  return part.toString();
}
