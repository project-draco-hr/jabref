{
  int buf;
  try {
    boolean me;
    while (!stopped && (buf=stream.read()) != -1) {
synchronized (this) {
        me=flush;
      }
synchronized (out) {
        out.print((char)buf);
        if (me)         out.flush();
      }
    }
  }
 catch (  IOException e) {
    out.println("I/O error");
  }
 finally {
synchronized (out) {
      out.flush();
    }
    stop();
  }
}
