{
  setEnabled(false);
  panel.output(Localization.lang("Writing XMP metadata..."));
  panel.frame().setProgressBarIndeterminate(true);
  panel.frame().setProgressBarVisible(true);
  BibEntry entry=editor.getEntry();
  List<File> files=new ArrayList<>();
  String pdf=entry.getField("pdf");
  List<String> dirs=panel.metaData().getFileDirectory("pdf");
  File f=FileUtil.expandFilename(pdf,dirs);
  if (f != null) {
    files.add(f);
  }
  dirs=panel.metaData().getFileDirectory(Globals.FILE_FIELD);
  if (entry.hasField(Globals.FILE_FIELD)) {
    FileListTableModel tm=new FileListTableModel();
    tm.setContent(entry.getField(Globals.FILE_FIELD));
    for (int j=0; j < tm.getRowCount(); j++) {
      FileListEntry flEntry=tm.getEntry(j);
      if ((flEntry.type != null) && "pdf".equals(flEntry.type.getName().toLowerCase())) {
        f=FileUtil.expandFilename(flEntry.link,dirs);
        if (f != null) {
          files.add(f);
        }
      }
    }
  }
  AbstractWorker worker=new WriteXMPWorker(files,entry);
  worker.getWorker().run();
  panel.output(message);
  panel.frame().setProgressBarVisible(false);
  setEnabled(true);
}
