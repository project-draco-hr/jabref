{
  s=s.replaceAll("\\n(?!\\s*\\n)"," ");
  s=s.replaceAll("\\s*\\n\\s*","\n");
  return s.replaceAll(" {2,}"," ").replaceAll("(^\\s*|\\s+$)","");
}
