{
  StringBuffer sb=new StringBuffer();
  int c;
  while ((c=in.read()) != -1) {
    sb.append((char)c);
  }
  String[] lines=sb.toString().split("\n");
  int mode=NONE;
  for (int i=0; i < lines.length; i++) {
    String line=lines[i];
    if ((line.length() > 0) && (line.charAt(line.length() - 1) == '\r'))     line=line.substring(0,line.length() - 1);
    if ((line.trim().length() == 0) || (line.charAt(0) == '#'))     continue;
    if (line.equals(NAME_MARK)) {
      mode=NAME;
      continue;
    }
 else     if (line.equals(LAYOUT_MRK)) {
      mode=LAYOUT;
      continue;
    }
 else     if (line.equals(PROPERTIES_MARK)) {
      mode=PROPERTIES;
      continue;
    }
 else     if (line.equals(CITATION_MARK)) {
      mode=CITATION;
      continue;
    }
 else     if (line.equals(JOURNALS_MARK)) {
      mode=JOURNALS;
      continue;
    }
switch (mode) {
case NAME:
      if (line.trim().length() > 0)       name=line.trim();
case LAYOUT:
    handleStructureLine(line);
  break;
case PROPERTIES:
handlePropertiesLine(line,properties);
break;
case CITATION:
handlePropertiesLine(line,citProperties);
break;
case JOURNALS:
handleJournalsLine(line);
}
}
if (mode != NONE) valid=true;
}
