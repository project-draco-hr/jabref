{
  String[] fields={"note","url","ee"};
  if (bes.getField("doi") != null) {
    String doiFieldValue=bes.getField("doi");
    if (DOI.isHttpDOI(doiFieldValue)) {
      String newValue=new DOI(doiFieldValue).getDOI();
      ce.addEdit(new UndoableFieldChange(bes,"doi",doiFieldValue,newValue));
      bes.setField("doi",newValue);
    }
    if (DOI.isDOI(doiFieldValue)) {
      for (      String field : fields) {
        if (DOI.isDOI(bes.getField(field))) {
          removeDOIfromBibtexEntryField(bes,field,ce);
        }
      }
    }
  }
 else {
    for (    String field : fields) {
      if (DOI.isDOI(bes.getField(field))) {
        String oldValue=bes.getField("doi");
        String newValue=new DOI(bes.getField(field)).getDOI();
        ce.addEdit(new UndoableFieldChange(bes,"doi",oldValue,newValue));
        bes.setField("doi",newValue);
        removeDOIfromBibtexEntryField(bes,field,ce);
      }
    }
  }
}
