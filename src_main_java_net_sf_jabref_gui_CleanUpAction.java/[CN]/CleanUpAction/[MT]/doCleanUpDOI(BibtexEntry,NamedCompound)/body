{
  String[] fields={"note","url","ee"};
  if (bes.getField("doi") != null) {
    String doiFieldValue=bes.getField("doi");
    if (DOIUtil.isURI(doiFieldValue)) {
      String newValue=DOIUtil.getDOI(doiFieldValue);
      ce.addEdit(new UndoableFieldChange(bes,"doi",doiFieldValue,newValue));
      bes.setField("doi",newValue);
    }
    if (DOIUtil.isDOI(doiFieldValue)) {
      for (      String field : fields) {
        if (DOIUtil.isDOI(bes.getField(field))) {
          DOIUtil.removeDOIfromBibtexEntryField(bes,field,ce);
        }
      }
    }
  }
 else {
    for (    String field : fields) {
      if (DOIUtil.isDOI(bes.getField(field))) {
        String oldValue=bes.getField("doi");
        String newValue=DOIUtil.getDOI(bes.getField(field));
        ce.addEdit(new UndoableFieldChange(bes,"doi",oldValue,newValue));
        bes.setField("doi",newValue);
        DOIUtil.removeDOIfromBibtexEntryField(bes,field,ce);
      }
    }
  }
}
