{
  String[] fields={"note","url","ee"};
  if (bes.getField("doi") != null) {
    String doiFieldValue=bes.getField("doi");
    if (Doi.containsHttpDoi(doiFieldValue)) {
      String newValue=new Doi(doiFieldValue).getDoi();
      ce.addEdit(new UndoableFieldChange(bes,"doi",doiFieldValue,newValue));
      bes.setField("doi",newValue);
    }
    if (Doi.containsDoi(doiFieldValue)) {
      for (      String field : fields) {
        if (Doi.containsDoi(bes.getField(field))) {
          Doi.removeDOIfromBibtexEntryField(bes,field,ce);
        }
      }
    }
  }
 else {
    for (    String field : fields) {
      if (Doi.containsDoi(bes.getField(field))) {
        String oldValue=bes.getField("doi");
        String newValue=new Doi(bes.getField(field)).getDoi();
        ce.addEdit(new UndoableFieldChange(bes,"doi",oldValue,newValue));
        bes.setField("doi",newValue);
        Doi.removeDOIfromBibtexEntryField(bes,field,ce);
      }
    }
  }
}
