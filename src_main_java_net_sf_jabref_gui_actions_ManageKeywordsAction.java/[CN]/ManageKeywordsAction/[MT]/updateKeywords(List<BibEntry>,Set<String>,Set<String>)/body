{
  NamedCompound ce=new NamedCompound(Localization.lang("Update keywords"));
  for (  BibEntry entry : entries) {
    Set<String> keywords=entry.getKeywords();
    keywords.removeAll(keywordsToRemove);
    keywords.addAll(keywordsToAdd);
    Optional<FieldChange> change=entry.putKeywords(keywords,Globals.prefs.get(JabRefPreferences.KEYWORD_SEPARATOR));
    if (change.isPresent()) {
      ce.addEdit(new UndoableFieldChange(change.get()));
    }
    if (Globals.prefs.isKeywordSyncEnabled()) {
      SpecialFieldsUtils.syncSpecialFieldsFromKeywords(entry,ce);
    }
  }
  ce.end();
  return ce;
}
