{
  FileDialog fc=new FileDialog(owner);
  if (directory != null)   fc.setDirectory(directory.getParent());
  if (dialogType == JFileChooser.OPEN_DIALOG)   fc.setMode(FileDialog.LOAD);
 else   fc.setMode(FileDialog.SAVE);
  fc.show();
  if (fc.getFile() != null) {
    prefs.put("workingDirectory",fc.getDirectory() + fc.getFile());
    return fc.getDirectory() + fc.getFile();
  }
 else   return null;
}
