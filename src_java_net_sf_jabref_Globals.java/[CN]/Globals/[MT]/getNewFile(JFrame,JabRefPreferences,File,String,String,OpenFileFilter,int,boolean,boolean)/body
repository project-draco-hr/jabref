{
  if (ON_MAC) {
    return getNewFileForMac(owner,prefs,directory,extension,dialogType,updateWorkingDirectory,dirOnly,off);
  }
  JFileChooser fc=null;
  try {
    fc=new JabRefFileChooser(directory);
  }
 catch (  InternalError errl) {
    return getNewFileForMac(owner,prefs,directory,extension,dialogType,updateWorkingDirectory,dirOnly,off);
  }
  if (dirOnly) {
    fc.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
  }
  fc.addChoosableFileFilter(off);
  fc.setDialogType(dialogType);
  int dialogResult=JFileChooser.CANCEL_OPTION;
  if (dialogType == JFileChooser.OPEN_DIALOG) {
    dialogResult=fc.showOpenDialog(null);
  }
 else   if (dialogType == JFileChooser.SAVE_DIALOG) {
    dialogResult=fc.showSaveDialog(null);
  }
 else {
    dialogResult=fc.showDialog(null,description);
  }
  if (dialogResult != JFileChooser.APPROVE_OPTION)   return null;
  File selectedFile=fc.getSelectedFile();
  if (selectedFile == null) {
    return null;
  }
  if ((extension != null) && (dialogType == JFileChooser.SAVE_DIALOG) && (fc.getFileFilter() == off)&& !off.accept(selectedFile)) {
    selectedFile=new File(selectedFile.getPath() + extension.split("[, ]+",0)[0]);
  }
  if (updateWorkingDirectory) {
    prefs.put("workingDirectory",selectedFile.getPath());
  }
  return selectedFile.getAbsolutePath();
}
