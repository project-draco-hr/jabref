{
  success=false;
  cancelled=false;
  if (panel.getFile() == null)   saveAs();
 else {
    if (panel.isUpdatedExternally() || Globals.fileUpdateMonitor.hasBeenModified(panel.getFileMonitorHandle())) {
      String[] opts=new String[]{Globals.lang("Review changes"),Globals.lang("Save"),Globals.lang("Cancel")};
      int answer=JOptionPane.showOptionDialog(panel.frame(),Globals.lang("File has been updated externally. " + "What do you want to do?"),Globals.lang("File updated externally"),JOptionPane.YES_NO_CANCEL_OPTION,JOptionPane.QUESTION_MESSAGE,null,opts,opts[0]);
      if (answer == JOptionPane.CANCEL_OPTION)       return;
 else       if (answer == JOptionPane.YES_OPTION) {
        ChangeScanner scanner=new ChangeScanner(panel.frame(),panel);
        scanner.changeScan(panel.getFile());
        panel.setUpdatedExternally(false);
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            panel.getSidePaneManager().hide("fileUpdate");
          }
        }
);
        return;
      }
    }
    panel.frame().output(Globals.lang("Saving database") + "...");
    panel.setSaving(true);
  }
}
