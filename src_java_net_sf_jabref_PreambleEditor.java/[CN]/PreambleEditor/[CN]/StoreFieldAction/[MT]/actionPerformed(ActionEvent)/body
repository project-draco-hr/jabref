{
  String toSet=null;
  boolean set;
  if (ed.getText().length() > 0)   toSet=ed.getText();
  if (toSet == null) {
    set=base.getPreamble() != null;
  }
 else {
    set=!((base.getPreamble() != null) && toSet.equals(base.getPreamble()));
  }
  if (set) {
    panel.undoManager.addEdit(new UndoablePreambleChange(base,panel,base.getPreamble(),toSet));
    base.setPreamble(toSet);
    if ((toSet != null) && (toSet.length() > 0)) {
      ed.setLabelColor(GUIGlobals.entryEditorLabelColor);
      ed.setValidBackgroundColor();
    }
 else {
      ed.setLabelColor(GUIGlobals.nullFieldColor);
      ed.setValidBackgroundColor();
    }
    if (ed.getTextComponent().hasFocus())     ed.setActiveBackgroundColor();
    panel.markBaseChanged();
  }
}
