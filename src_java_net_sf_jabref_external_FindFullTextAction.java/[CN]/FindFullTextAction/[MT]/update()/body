{
  if (result.url != null) {
    String bibtexKey=entry.getCiteKey();
    String[] dirs=basePanel.metaData().getFileDirectory(GUIGlobals.FILE_FIELD);
    if (dirs.length == 0) {
      return;
    }
    DownloadExternalFile def=new DownloadExternalFile(basePanel.frame(),basePanel.metaData(),bibtexKey);
    try {
      def.download(result.url,new DownloadExternalFile.DownloadCallback(){
        public void downloadComplete(        FileListEntry file){
          System.out.println("finished");
          FileListTableModel tm=new FileListTableModel();
          String oldValue=entry.getField(GUIGlobals.FILE_FIELD);
          tm.setContent(oldValue);
          tm.addEntry(tm.getRowCount(),file);
          String newValue=tm.getStringRepresentation();
          UndoableFieldChange edit=new UndoableFieldChange(entry,GUIGlobals.FILE_FIELD,oldValue,newValue);
          entry.setField(GUIGlobals.FILE_FIELD,newValue);
          basePanel.undoManager.addEdit(edit);
          basePanel.markBaseChanged();
        }
      }
);
    }
 catch (    IOException e) {
      e.printStackTrace();
    }
    basePanel.output(Globals.lang("Finished downloading full text document"));
  }
 else {
    String message=null;
switch (result.status) {
case FindFullText.UNKNOWN_DOMAIN:
      message=Globals.lang("Unable to find full text article. No search algorithm " + "defined for the '%0' web site.",result.host);
    break;
case FindFullText.WRONG_MIME_TYPE:
  message=Globals.lang("Found pdf link, but received the wrong MIME type. " + "This could indicate that you don't have access to the fulltext article.");
break;
case FindFullText.LINK_NOT_FOUND:
message=Globals.lang("Unable to find full text document in the linked web page.");
break;
case FindFullText.IO_EXCEPTION:
message=Globals.lang("Connection error when trying to find full text document.");
break;
case FindFullText.NO_URLS_DEFINED:
message=Globals.lang("This entry provides no URL or DOI links.");
break;
}
basePanel.output(Globals.lang("Full text article download failed"));
JOptionPane.showMessageDialog(basePanel.frame(),message,Globals.lang("Full text article download failed"),JOptionPane.ERROR_MESSAGE);
}
}
