{
  LinkedHashMap<BibtexEntry,BibtexDatabase> newList=new LinkedHashMap<BibtexEntry,BibtexDatabase>();
  HashMap<BibtexEntry,BibtexEntry> adaptedEntries=new HashMap<BibtexEntry,BibtexEntry>();
  for (  String name : names) {
    Matcher m=citePattern.matcher(name);
    if (m.find()) {
      String[] keys=m.group(2).split(",");
      for (      String key : keys) {
        BibtexDatabase database=linkSourceBase.get(key);
        BibtexEntry origEntry=null;
        if (database != null)         origEntry=database.getEntryByKey(key);
        if (origEntry == null) {
          System.out.println("Bibtex key not found : '" + key + "'");
          System.out.println("Problem with reference mark: '" + name + "'");
          newList.put(new UndefinedBibtexEntry(key),null);
        }
 else {
          BibtexEntry entry=adaptedEntries.get(origEntry);
          if (entry == null) {
            entry=OOUtil.createAdaptedEntry(origEntry);
            adaptedEntries.put(origEntry,entry);
          }
          if (!newList.containsKey(entry)) {
            newList.put(entry,database);
          }
        }
      }
    }
  }
  return newList;
}
