{
  LinkedHashMap<BibtexEntry,BibtexDatabase> newList=new LinkedHashMap<BibtexEntry,BibtexDatabase>();
  HashMap<BibtexEntry,BibtexEntry> adaptedEntries=new HashMap<BibtexEntry,BibtexEntry>();
  for (  String name : names) {
    Matcher m=citePattern.matcher(name);
    if (m.find()) {
      String[] keys=m.group(2).split(",");
      for (int j=0; j < keys.length; j++) {
        BibtexDatabase database=linkSourceBase.get(keys[j]);
        BibtexEntry origEntry=null;
        if (database != null)         origEntry=database.getEntryByKey(keys[j]);
        if (origEntry == null) {
          System.out.println("Bibtex key not found : '" + keys[j] + "'");
          System.out.println("Problem with reference mark: '" + name + "'");
          newList.put(new UndefinedBibtexEntry(keys[j]),null);
        }
 else {
          BibtexEntry entry=adaptedEntries.get(origEntry);
          if (entry == null) {
            entry=OOUtil.createAdaptedEntry(origEntry);
            adaptedEntries.put(origEntry,entry);
          }
          if (!newList.containsKey(entry)) {
            newList.put(entry,database);
          }
        }
      }
    }
  }
  return newList;
}
