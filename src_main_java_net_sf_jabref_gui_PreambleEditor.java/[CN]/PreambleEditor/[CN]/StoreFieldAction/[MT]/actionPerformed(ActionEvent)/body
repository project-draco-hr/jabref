{
  String toSet=null;
  boolean set;
  if (!ed.getText().isEmpty()) {
    toSet=ed.getText();
  }
  if (toSet == null) {
    set=base.getPreamble() != null;
  }
 else {
    set=!((base.getPreamble() != null) && toSet.equals(base.getPreamble()));
  }
  if (set) {
    panel.getUndoManager().addEdit(new UndoablePreambleChange(base,panel,base.getPreamble(),toSet));
    base.setPreamble(toSet);
    if ((toSet == null) || toSet.isEmpty()) {
      ed.setLabelColor(GUIGlobals.NULL_FIELD_COLOR);
    }
 else {
      ed.setLabelColor(GUIGlobals.ENTRY_EDITOR_LABEL_COLOR);
    }
    ed.setValidBackgroundColor();
    if (ed.getTextComponent().hasFocus()) {
      ed.setActiveBackgroundColor();
    }
    panel.markBaseChanged();
  }
}
