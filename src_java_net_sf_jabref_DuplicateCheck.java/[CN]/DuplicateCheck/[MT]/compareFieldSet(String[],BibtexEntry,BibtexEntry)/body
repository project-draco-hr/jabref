{
  double res=0;
  double totWeights=0.;
  for (int i=0; i < fields.length; i++) {
    double weight;
    if (fieldWeights.containsKey(fields[i]))     weight=fieldWeights.get(fields[i]);
 else     weight=1.0;
    totWeights+=weight;
    int result=compareSingleField(fields[i],one,two);
    if (result == Util.EQUAL) {
      res+=weight;
    }
 else     if (result == Util.EMPTY_IN_BOTH)     totWeights-=weight;
  }
  if (totWeights > 0)   return res / totWeights;
 else   return 0.5f;
}
