{
  PDDocumentInformation di=document.getDocumentInformation();
  BibEntry resolvedEntry;
  if (database == null) {
    resolvedEntry=entry;
  }
 else {
    resolvedEntry=database.resolveForStrings(entry,false);
  }
  JabRefPreferences prefs=JabRefPreferences.getInstance();
  boolean useXmpPrivacyFilter=prefs.getBoolean(JabRefPreferences.USE_XMP_PRIVACY_FILTER);
  Set<String> filters=new TreeSet<>(prefs.getStringList(JabRefPreferences.XMP_PRIVACY_FILTERS));
  Set<String> fields=resolvedEntry.getFieldNames();
  for (  String field : fields) {
    if (useXmpPrivacyFilter && filters.contains(field)) {
      if ("author".equals(field)) {
        di.setAuthor(null);
      }
 else       if ("title".equals(field)) {
        di.setTitle(null);
      }
 else       if ("keywords".equals(field)) {
        di.setKeywords(null);
      }
 else       if ("abstract".equals(field)) {
        di.setSubject(null);
      }
 else {
        di.setCustomMetadataValue("bibtex/" + field,null);
      }
      continue;
    }
    if ("author".equals(field)) {
      di.setAuthor(resolvedEntry.getField("author"));
    }
 else     if ("title".equals(field)) {
      di.setTitle(resolvedEntry.getField("title"));
    }
 else     if ("keywords".equals(field)) {
      di.setKeywords(resolvedEntry.getField("keywords"));
    }
 else     if ("abstract".equals(field)) {
      di.setSubject(resolvedEntry.getField("abstract"));
    }
 else {
      di.setCustomMetadataValue("bibtex/" + field,resolvedEntry.getField(field));
    }
  }
  di.setCustomMetadataValue("bibtex/entrytype",EntryUtil.capitalizeFirst(resolvedEntry.getType()));
}
