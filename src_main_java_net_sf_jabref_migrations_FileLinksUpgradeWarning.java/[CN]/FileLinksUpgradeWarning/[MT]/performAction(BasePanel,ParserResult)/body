{
  if (!isThereSomethingToBeDone()) {
    return;
  }
  JCheckBox changeSettings=new JCheckBox(Localization.lang("Change table column and General fields settings to use the new feature"),offerChangeSettings);
  JCheckBox changeDatabase=new JCheckBox(Localization.lang("Upgrade old external file links to use the new feature"),offerChangeDatabase);
  JCheckBox setFileDir=new JCheckBox(Localization.lang("Set main external file directory") + ":",offerSetFileDir);
  JTextField fileDir=new JTextField(30);
  JCheckBox doNotShowDialog=new JCheckBox(Localization.lang("Do not show these options in the future"),false);
  JPanel message=new JPanel();
  FormBuilder formBuilder=FormBuilder.create().layout(new FormLayout("left:pref","p"));
  int row=1;
  formBuilder.add(new JLabel("<html>" + Localization.lang("This database uses outdated file links.") + "<br><br>"+ Localization.lang("JabRef no longer supports 'ps' or 'pdf' fields.<br>File links are now stored in the 'file' field and files are stored in an external file directory.<br>To make use of this feature, JabRef needs to upgrade file links.<br><br>")+ "<p>"+ Localization.lang("Do you want JabRef to do the following operations?")+ "</html>")).xy(1,row);
  if (offerChangeSettings) {
    formBuilder.appendRows("2dlu, p");
    row+=2;
    formBuilder.add(changeSettings).xy(1,row);
  }
  if (offerChangeDatabase) {
    formBuilder.appendRows("2dlu, p");
    row+=2;
    formBuilder.add(changeDatabase).xy(1,row);
  }
  if (offerSetFileDir) {
    if (Globals.prefs.hasKey("pdfDirectory")) {
      fileDir.setText(Globals.prefs.get("pdfDirectory"));
    }
 else {
      fileDir.setText(Globals.prefs.get("psDirectory"));
    }
    JPanel builderPanel=new JPanel();
    builderPanel.add(setFileDir);
    builderPanel.add(fileDir);
    JButton browse=new JButton(Localization.lang("Browse"));
    browse.addActionListener(BrowseAction.buildForDir(fileDir));
    builderPanel.add(browse);
    formBuilder.appendRows("2dlu, p");
    row+=2;
    formBuilder.add(builderPanel).xy(1,row);
  }
  formBuilder.appendRows("6dlu, p");
  formBuilder.add(doNotShowDialog).xy(1,row + 2);
  message.add(formBuilder.build());
  int answer=JOptionPane.showConfirmDialog(panel.frame(),message,Localization.lang("Upgrade file"),JOptionPane.YES_NO_OPTION);
  if (doNotShowDialog.isSelected()) {
    Globals.prefs.putBoolean(JabRefPreferences.SHOW_FILE_LINKS_UPGRADE_WARNING,false);
  }
  if (answer == JOptionPane.YES_OPTION) {
    makeChanges(panel,parserResult,changeSettings.isSelected(),changeDatabase.isSelected(),setFileDir.isSelected() ? fileDir.getText() : null);
  }
}
