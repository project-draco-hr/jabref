{
  _prefs=prefs;
  _frame=frame;
  setLayout(new BorderLayout());
  psDir=new JTextField(30);
  pdfDir=new JTextField(30);
  fileDir=new JTextField(30);
  pdf=new JTextField(30);
  ps=new JTextField(30);
  html=new JTextField(30);
  lyx=new JTextField(30);
  winEdt=new JTextField(30);
  vim=new JTextField(30);
  vimServer=new JTextField(30);
  citeCommand=new JTextField(30);
  led=new JTextField(30);
  editFileTypes=new JButton(Globals.lang("Manage external file types"));
  regExpTextField=new JTextField(30);
  useRegExpComboBox=new JCheckBox(Globals.lang("Use Regular Expression Search"));
  regExpListener=new ItemListener(){
    public void itemStateChanged(    ItemEvent e){
      regExpTextField.setEditable(useRegExpComboBox.isSelected());
      if (useRegExpComboBox.isSelected()) {
        regExpTextField.setText(Globals.prefs.get(JabRefPreferences.REG_EXP_SEARCH_EXPRESSION_KEY));
      }
 else {
        Globals.prefs.put(JabRefPreferences.REG_EXP_SEARCH_EXPRESSION_KEY,regExpTextField.getText());
        regExpTextField.setText(Globals.prefs.get(JabRefPreferences.DEFAULT_REG_EXP_SEARCH_EXPRESSION_KEY));
      }
    }
  }
;
  useRegExpComboBox.addItemListener(regExpListener);
  editFileTypes.addActionListener(ExternalFileTypeEditor.getAction(prefsDiag));
  ButtonGroup bg=new ButtonGroup();
  bg.add(matchExactKeyOnly);
  bg.add(matchStartsWithKey);
  BrowseAction browse;
  FormLayout layout=new FormLayout("1dlu, 8dlu, left:pref, 4dlu, fill:170dlu, 4dlu, fill:pref","");
  DefaultFormBuilder builder=new DefaultFormBuilder(layout);
  builder.appendSeparator(Globals.lang("External file links"));
  JPanel pan=new JPanel();
  builder.append(pan);
  JLabel lab=new JLabel(Globals.lang("Main file directory") + ":");
  builder.append(lab);
  builder.append(fileDir);
  browse=new BrowseAction(_frame,fileDir,true);
  builder.append(new JButton(browse));
  builder.nextLine();
  pan=new JPanel();
  builder.append(pan);
  lab=new JLabel(Globals.lang("Main PDF directory") + ":");
  builder.append(lab);
  builder.append(pdfDir);
  browse=new BrowseAction(_frame,pdfDir,true);
  builder.append(new JButton(browse));
  builder.nextLine();
  pan=new JPanel();
  builder.append(pan);
  lab=new JLabel(Globals.lang("Main PS directory") + ":");
  builder.append(lab);
  builder.append(psDir);
  browse=new BrowseAction(_frame,psDir,true);
  builder.append(new JButton(browse));
  builder.nextLine();
  builder.append(new JPanel());
  builder.append(matchStartsWithKey,3);
  builder.nextLine();
  builder.append(new JPanel());
  builder.append(matchExactKeyOnly,3);
  builder.nextLine();
  builder.appendSeparator(Globals.lang("External programs"));
  builder.nextLine();
  lab=new JLabel(Globals.lang("Path to HTML viewer") + ":");
  builder.append(pan);
  builder.append(lab);
  builder.append(html);
  browse=new BrowseAction(_frame,html,false);
  if (Globals.ON_WIN)   browse.setEnabled(false);
  builder.append(new JButton(browse));
  builder.nextLine();
  lab=new JLabel(Globals.lang("Path to LyX pipe") + ":");
  builder.append(pan);
  builder.append(lab);
  builder.append(lyx);
  browse=new BrowseAction(_frame,lyx,false);
  builder.append(new JButton(browse));
  builder.nextLine();
  lab=new JLabel(Globals.lang("Path to WinEdt.exe") + ":");
  builder.append(pan);
  builder.append(lab);
  builder.append(winEdt);
  browse=new BrowseAction(_frame,winEdt,false);
  builder.append(new JButton(browse));
  builder.nextLine();
  lab=new JLabel(Globals.lang("Path to LatexEditor (LEd.exe)") + ":");
  builder.append(pan);
  builder.append(lab);
  builder.append(led);
  browse=new BrowseAction(_frame,led,false);
  builder.append(new JButton(browse));
  builder.nextLine();
  builder.append(pan);
  lab=new JLabel(Globals.lang("Path to Vim") + ":");
  builder.append(lab);
  builder.append(vim);
  browse=new BrowseAction(_frame,vim,false);
  builder.append(new JButton(browse));
  builder.nextLine();
  lab=new JLabel(Globals.lang("Vim Server Name") + ":");
  builder.append(pan);
  builder.append(lab);
  builder.append(vimServer);
  browse=new BrowseAction(_frame,vimServer,false);
  builder.append(new JButton(browse));
  builder.nextLine();
  builder.append(pan);
  builder.append(Globals.lang("Cite command (for Emacs/WinEdt)") + ":");
  builder.append(citeCommand);
  builder.nextLine();
  builder.append(pan);
  builder.append(editFileTypes);
  pan=builder.getPanel();
  pan.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  add(pan,BorderLayout.CENTER);
}
