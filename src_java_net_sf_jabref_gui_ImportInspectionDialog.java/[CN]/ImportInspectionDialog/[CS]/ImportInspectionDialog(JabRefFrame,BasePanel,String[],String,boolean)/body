{
  this.frame=frame;
  this.panel=panel;
  this.fields=fields;
  this.undoName=undoName;
  this.newDatabase=newDatabase;
  tableModel.addColumn(Globals.lang("Keep"));
  for (int i=0; i < fields.length; i++) {
    tableModel.addColumn(Util.nCase(fields[i]));
    Object o=GUIGlobals.fieldLength.get(fields[i]);
    int width=o == null ? GUIGlobals.DEFAULT_FIELD_LENGTH : ((Integer)o).intValue();
    table.getColumnModel().getColumn(i + 1).setPreferredWidth(width);
  }
  table.getColumnModel().getColumn(0).setPreferredWidth(55);
  table.getColumnModel().getColumn(0).setMaxWidth(55);
  table.setRowSelectionAllowed(true);
  table.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
  previewListener=new TableSelectionListener();
  table.getSelectionModel().addListSelectionListener(previewListener);
  table.addMouseListener(new TableClickListener());
  getContentPane().setLayout(new BorderLayout());
  progressBar.setIndeterminate(true);
  JPanel centerPan=new JPanel();
  centerPan.setLayout(new BorderLayout());
  contentPane.setTopComponent(new JScrollPane(table));
  contentPane.setBottomComponent(new JScrollPane(preview));
  centerPan.add(contentPane,BorderLayout.CENTER);
  centerPan.add(progressBar,BorderLayout.SOUTH);
  if (!newDatabase) {
    GroupTreeNode node=panel.metaData().getGroups();
    groupsAdd.setEnabled(false);
    insertNodes(groupsAdd,node,true);
    popup.add(groupsAdd);
  }
  getContentPane().add(centerPan,BorderLayout.CENTER);
  ButtonBarBuilder bb=new ButtonBarBuilder();
  bb.addGlue();
  bb.addGridded(ok);
  bb.addGridded(stop);
  bb.addGridded(cancel);
  bb.addRelatedGap();
  bb.addGridded(help);
  bb.addGlue();
  bb.getPanel().setBorder(BorderFactory.createEmptyBorder(2,2,2,2));
  ButtonStackBuilder builder=new ButtonStackBuilder();
  builder.addGridded(selectAll);
  builder.addGridded(deselectAll);
  builder.addRelatedGap();
  builder.addGridded(delete);
  builder.addRelatedGap();
  builder.addGridded(generate);
  builder.getPanel().setBorder(BorderFactory.createEmptyBorder(2,2,2,2));
  centerPan.add(builder.getPanel(),BorderLayout.WEST);
  ok.setEnabled(false);
  generate.setEnabled(false);
  ok.addActionListener(new OkListener());
  cancel.addActionListener(new CancelListener());
  generate.addActionListener(new GenerateListener());
  stop.addActionListener(new StopListener());
  selectAll.addActionListener(new SelectionButton(true));
  deselectAll.addActionListener(new SelectionButton(false));
  delete.addActionListener(new DeleteListener());
  help.addActionListener(new HelpAction(frame.helpDiag,GUIGlobals.importInspectionHelp));
  getContentPane().add(bb.getPanel(),BorderLayout.SOUTH);
  setSize(new Dimension(650,650));
}
