{
  String cancelMessage=Globals.lang("Unable to open file.");
  String[] options=new String[]{Globals.lang("Define '%0'",fileType.getName()),Globals.lang("Change file type"),Globals.lang("Cancel")};
  String defOption=options[0];
  int answer=JOptionPane.showOptionDialog(frame,Globals.lang("This external link is of the type '%0', which is undefined. What do you want to do?",fileType.getName()),Globals.lang("Undefined file type"),JOptionPane.YES_NO_CANCEL_OPTION,JOptionPane.QUESTION_MESSAGE,null,options,defOption);
  if (answer == JOptionPane.CANCEL_OPTION) {
    frame.output(cancelMessage);
    return;
  }
 else   if (answer == JOptionPane.YES_OPTION) {
    ExternalFileType newType=new ExternalFileType(fileType.getName(),"","","new");
    ExternalFileTypeEntryEditor editor=new ExternalFileTypeEntryEditor(frame,newType);
    editor.setVisible(true);
    if (editor.okPressed()) {
      List<ExternalFileType> fileTypes=new ArrayList<ExternalFileType>();
      ExternalFileType[] oldTypes=Globals.prefs.getExternalFileTypeSelection();
      for (int i=0; i < oldTypes.length; i++) {
        fileTypes.add(oldTypes[i]);
      }
      fileTypes.add(newType);
      Collections.sort(fileTypes);
      Globals.prefs.setExternalFileTypes(fileTypes);
      openExternalFileAnyFormat(metaData,link,newType);
    }
 else {
      frame.output(cancelMessage);
      return;
    }
  }
 else {
    FileListTableModel tModel=new FileListTableModel();
    String oldValue=(String)entry.getField(GUIGlobals.FILE_FIELD);
    tModel.setContent(oldValue);
    FileListEntry flEntry=null;
    for (int i=0; i < tModel.getRowCount(); i++) {
      FileListEntry iEntry=tModel.getEntry(i);
      if (iEntry.getLink().equals(link)) {
        flEntry=iEntry;
        break;
      }
    }
    if (flEntry == null) {
      throw new RuntimeException("Could not find the file list entry " + link + " in "+ entry.toString());
    }
    FileListEntryEditor editor=new FileListEntryEditor(frame,flEntry,false,true,metaData);
    editor.setVisible(true);
    if (editor.okPressed()) {
      String newValue=tModel.getStringRepresentation();
      UndoableFieldChange ce=new UndoableFieldChange(entry,GUIGlobals.FILE_FIELD,oldValue,newValue);
      entry.setField(GUIGlobals.FILE_FIELD,newValue);
      frame.basePanel().undoManager.addEdit(ce);
      frame.basePanel().markBaseChanged();
      openExternalFileAnyFormat(metaData,flEntry.getLink(),flEntry.getType());
    }
 else {
      frame.output(cancelMessage);
      return;
    }
  }
}
