{
  if (fieldName.equals("ps") || fieldName.equals("pdf")) {
    String[] dir=metaData.getFileDirectory(fieldName);
    File file=expandFilename(link,dir);
    if ((file == null) || !file.exists()) {
      throw new IOException(Globals.lang("File not found") + " (" + fieldName+ "): '"+ link+ "'.");
    }
    link=file.getCanonicalPath();
    String[] split=file.getName().split("\\.");
    if (split.length >= 2) {
      if (split[split.length - 1].equalsIgnoreCase("pdf"))       fieldName="pdf";
 else       if (split[split.length - 1].equalsIgnoreCase("ps") || (split.length >= 3 && split[split.length - 2].equalsIgnoreCase("ps")))       fieldName="ps";
    }
  }
 else   if (fieldName.equals("doi")) {
    fieldName="url";
    link=sanitizeUrl(link);
    if (!link.startsWith("http://")) {
      if (link.matches("^doi:/*.*")) {
        link=link.replaceFirst("^doi:/*","");
      }
      link=Globals.DOI_LOOKUP_PREFIX + link;
    }
  }
 else   if (fieldName.equals("eprint")) {
    fieldName="url";
    link=sanitizeUrl(link);
    if (!link.startsWith("http://")) {
      link=Globals.ARXIV_LOOKUP_PREFIX + link;
    }
  }
 else   if (fieldName.equals("citeseerurl")) {
    fieldName="url";
    String canonicalLink=CiteSeerFetcher.generateCanonicalURL(link);
    if (canonicalLink != null)     link=canonicalLink;
  }
  if (fieldName.equals("url")) {
    try {
      link=sanitizeUrl(link);
      ExternalFileType fileType=Globals.prefs.getExternalFileTypeByExt("html");
      if (Globals.ON_MAC) {
        String[] cmd=((fileType.getOpenWith() != null) && (fileType.getOpenWith().length() > 0)) ? new String[]{"/usr/bin/open","-a",fileType.getOpenWith(),link} : new String[]{"/usr/bin/open",link};
        Runtime.getRuntime().exec(cmd);
      }
 else       if (Globals.ON_WIN) {
        if ((fileType.getOpenWith() != null) && (fileType.getOpenWith().length() > 0)) {
          openFileWithApplicationOnWindows(link,fileType.getOpenWith());
        }
 else         openFileOnWindows(link,true);
      }
 else {
        String[] openWith;
        if ((fileType.getOpenWith() != null) && (fileType.getOpenWith().length() > 0))         openWith=fileType.getOpenWith().split(" ");
 else         openWith=new String[]{"xdg-open"};
        String[] cmd=new String[openWith.length + 1];
        System.arraycopy(openWith,0,cmd,0,openWith.length);
        cmd[cmd.length - 1]=link;
        Runtime.getRuntime().exec(cmd);
      }
    }
 catch (    IOException e) {
      System.err.println(Globals.lang("Error_opening_file_'%0'.",link));
      e.printStackTrace();
    }
  }
 else   if (fieldName.equals("ps")) {
    try {
      if (Globals.ON_MAC) {
        ExternalFileType type=Globals.prefs.getExternalFileTypeByExt("ps");
        String viewer=type != null ? type.getOpenWith() : Globals.prefs.get("psviewer");
        String[] cmd={"/usr/bin/open","-a",viewer,link};
        Runtime.getRuntime().exec(cmd);
      }
 else       if (Globals.ON_WIN) {
        openFileOnWindows(link,true);
      }
 else {
        ExternalFileType type=Globals.prefs.getExternalFileTypeByExt("ps");
        String viewer=type != null ? type.getOpenWith() : "xdg-open";
        String[] cmdArray=new String[2];
        cmdArray[0]=viewer;
        cmdArray[1]=link;
        Runtime.getRuntime().exec(cmdArray);
      }
    }
 catch (    IOException e) {
      System.err.println("An error occured on the command: " + Globals.prefs.get("psviewer") + " "+ link);
    }
  }
 else   if (fieldName.equals("pdf")) {
    try {
      if (Globals.ON_MAC) {
        ExternalFileType type=Globals.prefs.getExternalFileTypeByExt("pdf");
        String viewer=type != null ? type.getOpenWith() : Globals.prefs.get("psviewer");
        String[] cmd={"/usr/bin/open","-a",viewer,link};
        Runtime.getRuntime().exec(cmd);
      }
 else       if (Globals.ON_WIN) {
        openFileOnWindows(link,true);
      }
 else {
        ExternalFileType type=Globals.prefs.getExternalFileTypeByExt("pdf");
        String viewer=type != null ? type.getOpenWith() : Globals.prefs.get("psviewer");
        String[] cmdArray=new String[2];
        cmdArray[0]=viewer;
        cmdArray[1]=link;
        Runtime.getRuntime().exec(cmdArray);
      }
    }
 catch (    IOException e) {
      e.printStackTrace();
      System.err.println("An error occured on the command: " + Globals.prefs.get("pdfviewer") + " #"+ link);
      System.err.println(e.getMessage());
    }
  }
 else {
    System.err.println("Message: currently only PDF, PS and HTML files can be opened by double clicking");
  }
}
