{
  while (active) {
    try {
      Socket newSocket=socket.accept();
      newSocket.setSoTimeout(1000);
      if (toStop) {
        active=false;
        return;
      }
      OutputStream out=newSocket.getOutputStream();
      InputStream in=newSocket.getInputStream();
      out.write(IDENTIFIER.getBytes());
      out.write('\0');
      out.flush();
      int c;
      StringBuffer sb=new StringBuffer();
      try {
        while (((c=in.read()) != '\0') && (c >= 0)) {
          sb.append((char)c);
        }
        if (sb.length() == 0) {
          continue;
        }
        String[] args=sb.toString().split("\n");
        Vector<ParserResult> loaded=jabref.processArguments(args,false);
        for (int i=0; i < loaded.size(); i++) {
          ParserResult pr=loaded.elementAt(i);
          if (!pr.toOpenTab()) {
            jabref.jrf.addTab(pr.getDatabase(),pr.getFile(),pr.getMetaData(),pr.getEncoding(),(i == 0));
          }
 else {
            BasePanel panel=jabref.jrf.basePanel();
            if (panel == null) {
              jabref.jrf.addTab(pr.getDatabase(),pr.getFile(),pr.getMetaData(),pr.getEncoding(),(i == 0));
            }
 else {
              List<BibtexEntry> entries=new ArrayList<BibtexEntry>(pr.getDatabase().getEntries());
              jabref.jrf.addImportedEntries(panel,entries,"",false);
            }
          }
        }
        in.close();
        out.close();
        newSocket.close();
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            jabref.jrf.showIfMinimizedToSysTray();
          }
        }
);
      }
 catch (      SocketTimeoutException ex) {
        in.close();
        out.close();
        newSocket.close();
      }
    }
 catch (    SocketException ex) {
      active=false;
    }
catch (    IOException e) {
      e.printStackTrace();
    }
  }
}
