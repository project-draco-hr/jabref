{
  ExternalFileType fileType=Globals.prefs.getExternalFileTypeByExt("pdf");
  NamedCompound edits=new NamedCompound(Globals.lang("Drop %0",fileType.extension));
  boolean isSingle=xmpEntriesInFile.size() == 1;
  BibtexEntry single=isSingle ? xmpEntriesInFile.get(0) : null;
  boolean success=true;
  String destFilename;
  if (linkInPlace.isSelected()) {
    destFilename=FileUtil.shortenFileName(new File(fileName),panel.metaData().getFileDirectory(GUIGlobals.FILE_FIELD)).toString();
  }
 else {
    if (renameCheckBox.isSelected()) {
      destFilename=fileName;
    }
 else {
      destFilename=single.getCiteKey() + "." + fileType.extension;
    }
    if (copyRadioButton.isSelected()) {
      success=doCopy(fileName,fileType,destFilename,edits);
    }
 else     if (moveRadioButton.isSelected()) {
      success=doMove(fileName,fileType,destFilename,edits);
    }
  }
  if (success) {
    for (    BibtexEntry aXmpEntriesInFile : xmpEntriesInFile) {
      try {
        aXmpEntriesInFile.setId(IdGenerator.next());
        edits.addEdit(new UndoableInsertEntry(panel.getDatabase(),aXmpEntriesInFile,panel));
        panel.getDatabase().insertEntry(aXmpEntriesInFile);
        doLink(aXmpEntriesInFile,fileType,destFilename,true,edits);
      }
 catch (      KeyCollisionException ignored) {
      }
    }
    panel.markBaseChanged();
    panel.updateEntryEditorIfShowing();
  }
  edits.end();
  panel.undoManager.addEdit(edits);
}
