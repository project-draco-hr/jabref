{
  if (tf.getText().trim().isEmpty()) {
    frame.output(Localization.lang("Please enter a search string"));
    return;
  }
  if (frame.getCurrentBasePanel() == null) {
    frame.output(Localization.lang("Please open or start a new database before searching"));
    return;
  }
  if (activeFetcher instanceof PreviewEntryFetcher) {
    frame.output(Localization.lang("Searching..."));
    frame.setProgressBarIndeterminate(true);
    frame.setProgressBarVisible(true);
    final PreviewEntryFetcher pFetcher=(PreviewEntryFetcher)activeFetcher;
    final FetcherPreviewDialog dialog=new FetcherPreviewDialog(frame,pFetcher.getWarningLimit(),pFetcher.getPreferredPreviewHeight());
    JabRefExecutorService.INSTANCE.execute(new Runnable(){
      @Override public void run(){
        final boolean result=pFetcher.processQueryGetPreview(tf.getText().trim(),dialog,dialog);
        SwingUtilities.invokeLater(new Runnable(){
          @Override public void run(){
            frame.setProgressBarVisible(false);
            frame.output("");
            if (!result) {
              return;
            }
            dialog.setLocationRelativeTo(frame);
            dialog.setVisible(true);
            if (dialog.isOkPressed()) {
              final ImportInspectionDialog d2=new ImportInspectionDialog(frame,frame.getCurrentBasePanel(),BibtexFields.DEFAULT_INSPECTION_FIELDS,activeFetcher.getTitle(),false);
              d2.addCallBack(activeFetcher);
              PositionWindow.placeDialog(d2,frame);
              d2.setVisible(true);
              JabRefExecutorService.INSTANCE.execute(new Runnable(){
                @Override public void run(){
                  pFetcher.getEntries(dialog.getSelection(),d2);
                  d2.entryListComplete();
                }
              }
);
            }
          }
        }
);
      }
    }
);
  }
 else {
    final ImportInspectionDialog dialog=new ImportInspectionDialog(frame,frame.getCurrentBasePanel(),BibtexFields.DEFAULT_INSPECTION_FIELDS,activeFetcher.getTitle(),false);
    dialog.addCallBack(activeFetcher);
    PositionWindow.placeDialog(dialog,frame);
    dialog.setVisible(true);
    JabRefExecutorService.INSTANCE.execute(new Runnable(){
      @Override public void run(){
        if (activeFetcher.processQuery(tf.getText().trim(),dialog,dialog)) {
          dialog.entryListComplete();
        }
 else {
          dialog.dispose();
        }
      }
    }
);
  }
}
