{
  if (numTreeParsers > 0) {
    tool.panic("You may only have one tree parser per grammar file: class " + name.getText());
  }
  numTreeParsers++;
  reset();
  Grammar g=(Grammar)grammars.get(name);
  if (g != null) {
    if (!(g instanceof TreeWalkerGrammar)) {
      tool.panic("'" + name.getText() + "' is already defined as a non-tree-walker");
    }
 else {
      tool.panic("Tree-walker '" + name.getText() + "' is already defined");
    }
  }
 else {
    grammar=new TreeWalkerGrammar(name.getText(),tool,superClass);
    grammar.comment=doc;
    grammar.processArguments(args);
    grammar.setFilename(file);
    grammars.put(grammar.getClassName(),grammar);
    grammar.preambleAction=thePreambleAction;
    thePreambleAction=new CommonToken(Token.INVALID_TYPE,"");
  }
}
