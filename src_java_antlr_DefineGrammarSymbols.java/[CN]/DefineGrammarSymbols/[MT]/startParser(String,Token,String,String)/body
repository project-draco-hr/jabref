{
  if (numParsers > 0) {
    tool.panic("You may only have one parser per grammar file: class " + name.getText());
  }
  numParsers++;
  reset();
  Grammar g=(Grammar)grammars.get(name);
  if (g != null) {
    if (!(g instanceof ParserGrammar)) {
      tool.panic("'" + name.getText() + "' is already defined as a non-parser");
    }
 else {
      tool.panic("Parser '" + name.getText() + "' is already defined");
    }
  }
 else {
    grammar=new ParserGrammar(name.getText(),tool,superClass);
    grammar.comment=doc;
    grammar.processArguments(args);
    grammar.setFilename(file);
    grammars.put(grammar.getClassName(),grammar);
    grammar.preambleAction=thePreambleAction;
    thePreambleAction=new CommonToken(Token.INVALID_TYPE,"");
  }
}
