{
  Optional<String> suppliedEncoding=Optional.empty();
  try (Reader utf8Reader=ImportFormatReader.getUTF8Reader(fileToOpen)){
    suppliedEncoding=OpenDatabaseAction.getSuppliedEncoding(utf8Reader);
  }
   if (!suppliedEncoding.isPresent()) {
    try (Reader utf16Reader=ImportFormatReader.getUTF16Reader(fileToOpen)){
      suppliedEncoding=OpenDatabaseAction.getSuppliedEncoding(utf16Reader);
    }
   }
  try (InputStreamReader reader=openFile(fileToOpen,suppliedEncoding,fallbackEncoding)){
    BibtexParser bp=new BibtexParser(reader);
    ParserResult pr=bp.parse();
    pr.setEncoding(reader.getEncoding());
    pr.setFile(fileToOpen);
    if (SpecialFieldsUtils.keywordSyncEnabled()) {
      for (      BibtexEntry entry : pr.getDatabase().getEntries()) {
        SpecialFieldsUtils.syncSpecialFieldsFromKeywords(entry,null);
      }
      LOGGER.info("Synchronized special fields based on keywords");
    }
    if (!pr.getMetaData().isGroupTreeValid()) {
      pr.addWarning(Localization.lang("Group tree could not be parsed. If you save the BibTeX database, all groups will be lost."));
    }
    return pr;
  }
 }
