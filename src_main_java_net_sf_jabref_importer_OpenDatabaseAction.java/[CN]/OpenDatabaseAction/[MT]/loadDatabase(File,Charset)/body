{
  Optional<Charset> suppliedEncoding=Optional.empty();
  try (Reader utf8Reader=ImportFormatReader.getUTF8Reader(fileToOpen)){
    suppliedEncoding=OpenDatabaseAction.getSuppliedEncoding(utf8Reader);
  }
   if (!suppliedEncoding.isPresent()) {
    try (Reader utf16Reader=ImportFormatReader.getUTF16Reader(fileToOpen)){
      suppliedEncoding=OpenDatabaseAction.getSuppliedEncoding(utf16Reader);
    }
   }
  try (InputStreamReader reader=openFile(fileToOpen,suppliedEncoding,defaultEncoding)){
    BibtexParser parser=new BibtexParser(reader);
    ParserResult result=parser.parse();
    result.setEncoding(Charset.forName(reader.getEncoding()));
    result.setFile(fileToOpen);
    if (SpecialFieldsUtils.keywordSyncEnabled()) {
      for (      BibtexEntry entry : result.getDatabase().getEntries()) {
        SpecialFieldsUtils.syncSpecialFieldsFromKeywords(entry,null);
      }
      LOGGER.info("Synchronized special fields based on keywords");
    }
    if (!result.getMetaData().isGroupTreeValid()) {
      result.addWarning(Localization.lang("Group tree could not be parsed. If you save the BibTeX database, all groups will be lost."));
    }
    return result;
  }
 }
