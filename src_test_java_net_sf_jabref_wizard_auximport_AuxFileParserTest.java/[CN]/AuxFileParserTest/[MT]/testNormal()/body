{
  InputStream originalStream=AuxFileParserTest.class.getResourceAsStream("origin.bib");
  File auxFile=new File(AuxFileParserTest.class.getResource("paper.aux").getFile());
  try (InputStreamReader originalReader=new InputStreamReader(originalStream)){
    ParserResult result=BibtexParser.parse(originalReader);
    AuxFileParser auxFileParser=new AuxFileParser();
    List<String> unresolved=auxFileParser.generateBibDatabase(auxFile.getAbsolutePath(),result.getDatabase());
    assertFalse(auxFileParser.getGeneratedBibDatabase().isEmpty());
    assertEquals(0,unresolved.size());
    assertEquals(0,auxFileParser.getNotResolvedKeysCount());
    BibDatabase newDB=auxFileParser.getGeneratedBibDatabase();
    assertEquals(2,newDB.getEntries().size());
    assertEquals(2,auxFileParser.getResolvedKeysCount());
    assertEquals(2,auxFileParser.getFoundKeysInAux());
    assertEquals(auxFileParser.getFoundKeysInAux(),auxFileParser.getResolvedKeysCount() + auxFileParser.getNotResolvedKeysCount());
    assertEquals(0,auxFileParser.getCrossreferencedEntriesCount());
    auxFileParser.clear();
    assertEquals(0,unresolved.size());
    assertEquals(0,auxFileParser.getNotResolvedKeysCount());
    newDB=auxFileParser.getGeneratedBibDatabase();
    assertEquals(0,newDB.getEntries().size());
    assertEquals(0,auxFileParser.getResolvedKeysCount());
    assertEquals(0,auxFileParser.getFoundKeysInAux());
    assertEquals(auxFileParser.getFoundKeysInAux(),auxFileParser.getResolvedKeysCount() + auxFileParser.getNotResolvedKeysCount());
    assertEquals(0,auxFileParser.getCrossreferencedEntriesCount());
  }
 catch (  IOException ex) {
    fail("Cannot open file");
  }
}
