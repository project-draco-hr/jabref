{
  String defaultPrefix="/images/crystal_16/";
  String prefix=defaultPrefix;
  URL defaultResource=GUIGlobals.class.getResource(prefix + "Icons.properties");
  URL resource=defaultResource;
  if (Globals.prefs.getBoolean(JabRefPreferences.USE_CUSTOM_ICON_THEME)) {
    String filename=Globals.prefs.get(JabRefPreferences.CUSTOM_ICON_THEME_FILE);
    if (filename != null) {
      try {
        File file=new File(filename);
        String parent=file.getParentFile().getAbsolutePath();
        prefix="file://" + parent + System.getProperty("file.separator");
        resource=new URL("file://" + file.getAbsolutePath());
      }
 catch (      MalformedURLException e) {
        e.printStackTrace();
      }
    }
  }
  try {
    GUIGlobals.iconMap=GUIGlobals.readIconThemeFile(resource,prefix);
  }
 catch (  IOException e) {
    System.err.println(Globals.lang("Unable to read icon theme file") + " '" + resource.toString()+ '\'');
    if (resource != defaultResource) {
      try {
        GUIGlobals.iconMap=GUIGlobals.readIconThemeFile(defaultResource,defaultPrefix);
      }
 catch (      IOException e2) {
        System.err.println(Globals.lang("Unable to read default icon theme."));
      }
    }
  }
}
