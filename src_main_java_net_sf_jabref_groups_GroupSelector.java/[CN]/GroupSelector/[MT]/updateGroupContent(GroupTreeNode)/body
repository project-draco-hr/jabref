{
  List<BibEntry> entries=panel.getSelectedEntries();
  AbstractGroup group=node.getGroup();
  AbstractUndoableEdit undoRemove=null;
  AbstractUndoableEdit undoAdd=null;
  List<BibEntry> toRemove=new ArrayList<>(entries.size());
  List<BibEntry> toAdd=new ArrayList<>(entries.size());
  for (  BibEntry entry : entries) {
    if (group.contains(entry)) {
      LOGGER.info("Removing entry " + entry);
      toRemove.add(entry);
    }
 else {
      LOGGER.info("Adding entry " + entry);
      toAdd.add(entry);
    }
  }
  if (!toRemove.isEmpty()) {
    undoRemove=node.removeFromGroup(toRemove);
  }
  if (!toAdd.isEmpty()) {
    undoAdd=node.addToGroup(toAdd);
  }
  if (undoRemove != null) {
    if (undoAdd != null) {
      undoRemove.addEdit(undoAdd);
    }
    panel.undoManager.addEdit(undoRemove);
  }
 else   if (undoAdd != null) {
    panel.undoManager.addEdit(undoAdd);
  }
}
