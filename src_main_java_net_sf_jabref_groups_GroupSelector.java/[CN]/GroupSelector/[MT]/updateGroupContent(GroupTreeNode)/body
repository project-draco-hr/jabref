{
  BibEntry[] entries=panel.getSelectedEntries();
  AbstractGroup group=node.getGroup();
  AbstractUndoableEdit undoRemove=null;
  AbstractUndoableEdit undoAdd=null;
  ArrayList<BibEntry> toRemove=new ArrayList<>(entries.length);
  ArrayList<BibEntry> toAdd=new ArrayList<>(entries.length);
  for (  BibEntry entry : entries) {
    if (group.contains(entry)) {
      LOGGER.info("Removing entry " + entry);
      toRemove.add(entry);
    }
 else {
      LOGGER.info("Adding entry " + entry);
      toAdd.add(entry);
    }
  }
  if (!toRemove.isEmpty()) {
    undoRemove=node.removeFromGroup(toRemove.toArray(new BibEntry[toRemove.size()]));
  }
  if (!toAdd.isEmpty()) {
    undoAdd=node.addToGroup(toAdd.toArray(new BibEntry[toAdd.size()]));
  }
  if (undoRemove != null) {
    if (undoAdd != null) {
      undoRemove.addEdit(undoAdd);
    }
    panel.undoManager.addEdit(undoRemove);
  }
 else   if (undoAdd != null) {
    panel.undoManager.addEdit(undoAdd);
  }
}
