{
  int count=0;
  CompoundEdit ce=new CompoundEdit();
  for (  File f : files) {
    EntryFromFileCreator creator=getEntryCreator(f);
    if (creator != null) {
      BibEntry entry=creator.createEntry(f,generateKeywordsFromPathToFile);
      if (entry == null) {
        importGUIMessages.add("Problem importing " + f.getPath() + ": Entry could not be created.");
        continue;
      }
      if (entryType != null) {
        entry.setType(entryType);
      }
      if (entry.getId() == null) {
        entry.setId(IdGenerator.next());
      }
      if (database.getEntryById(entry.getId()) == null) {
        if (database.insertEntry(entry)) {
          importGUIMessages.add("Problem importing " + f.getPath() + ": Insert into BibDatabase failed.");
        }
 else {
          count++;
          if (panel != null) {
            ce.addEdit(new UndoableInsertEntry(database,entry,panel));
          }
        }
      }
    }
 else {
      importGUIMessages.add("Problem importing " + f.getPath() + ": Unknown filetype.");
    }
    if (changeListener != null) {
      changeListener.stateChanged(new ChangeEvent(this));
    }
  }
  System.out.println("count = " + count);
  if ((count > 0) && (panel != null)) {
    System.out.println("adding edit");
    ce.end();
    panel.undoManager.addEdit(ce);
  }
  return count;
}
