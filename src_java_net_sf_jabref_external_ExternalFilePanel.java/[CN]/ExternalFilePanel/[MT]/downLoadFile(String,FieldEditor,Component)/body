{
  String res=JOptionPane.showInputDialog(parent,Globals.lang("Enter URL to download"));
  if (res != null) {
class Downloader extends Thread {
      String res;
      public Downloader(      String res){
        this.res=res;
      }
      public void run(){
        URL url;
        try {
          url=new URL(res);
          String suffix=off.getSuffix(res);
          if (suffix == null)           suffix="." + fieldName.toLowerCase();
          String plannedName=null;
          if (getKey() != null)           plannedName=getKey() + suffix;
 else {
            plannedName=JOptionPane.showInputDialog(parent,Globals.lang("BibTeX key not set. Enter a name for the downloaded file"));
            if (plannedName == null)             return;
            if (!off.accept(plannedName))             plannedName+=suffix;
          }
          File file=new File(new File(Globals.prefs.get(fieldName + "Directory")),plannedName);
          URLDownload udl=new URLDownload(parent,url,file);
          output(Globals.lang("Downloading..."));
          try {
            udl.download();
          }
 catch (          IOException e2) {
            JOptionPane.showMessageDialog(parent,Globals.lang("Invalid URL"),Globals.lang("Download file"),JOptionPane.ERROR_MESSAGE);
            Globals.logger("Error while downloading " + url.toString());
          }
          output(Globals.lang("Download completed"));
          String filename=file.getPath();
          String directory=Globals.prefs.get(fieldName + "Directory");
          if (filename.startsWith(directory)) {
            String relPath=filename.substring(directory.length(),filename.length());
            if (relPath.startsWith(File.separator)) {
              relPath=relPath.substring(File.separator.length(),relPath.length());
            }
            filename=relPath;
          }
          editor.setText(filename);
          SwingUtilities.invokeLater(new Thread(){
            public void run(){
              entryEditor.updateField(editor);
            }
          }
);
        }
 catch (        MalformedURLException e1) {
          JOptionPane.showMessageDialog(parent,"Invalid URL","Download file",JOptionPane.ERROR_MESSAGE);
        }
      }
    }
    (new Downloader(res)).start();
  }
}
