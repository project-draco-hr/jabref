{
  boolean close=true;
  Vector<String> filenames=new Vector<>();
  if (tabbedPane.getTabCount() > 0) {
    for (int i=0; i < tabbedPane.getTabCount(); i++) {
      if (baseAt(i).isBaseChanged()) {
        tabbedPane.setSelectedIndex(i);
        Object[] options={Localization.lang("Save changes"),Localization.lang("Discard changes"),Localization.lang("Return to JabRef")};
        String filename;
        if (baseAt(i).getFile() != null) {
          filename=baseAt(i).getFile().getAbsolutePath();
        }
 else {
          filename=GUIGlobals.untitledTitle;
        }
        int answer=JOptionPane.showOptionDialog(JabRefFrame.this,"<html><br><b>" + Localization.lang("Database %0 has changed.",filename) + "</b>\n\n"+ Localization.lang("Click \"%0\" to save the changes,\nclick \"%1\" to discard any changes,\nclick \"%2\" to return to the main window.",options[0].toString(),options[1].toString(),options[2].toString()),Localization.lang("Unsaved changes"),JOptionPane.YES_NO_CANCEL_OPTION,JOptionPane.WARNING_MESSAGE,null,options,options[2]);
        if ((answer == JOptionPane.CANCEL_OPTION) || (answer == JOptionPane.CLOSED_OPTION)) {
          return false;
        }
        if (answer == JOptionPane.YES_OPTION) {
          try {
            SaveDatabaseAction saveAction=new SaveDatabaseAction(basePanel());
            saveAction.runCommand();
            if (saveAction.isCancelled() || !saveAction.isSuccess()) {
              output(Localization.lang("Unable to save database"));
              close=false;
            }
          }
 catch (          Throwable ex) {
            close=false;
            break;
          }
        }
      }
      if (baseAt(i).getFile() != null) {
        filenames.add(baseAt(i).getFile().getAbsolutePath());
      }
    }
  }
  if (close) {
    for (int i=0; i < tabbedPane.getTabCount(); i++) {
      if (baseAt(i).isSaving()) {
        WaitForSaveOperation w=new WaitForSaveOperation(this);
        w.show();
        if (w.cancelled()) {
          return false;
        }
      }
    }
    tearDownJabRef(filenames);
    return true;
  }
  return false;
}
