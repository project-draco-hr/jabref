{
  Transferable tsf=dtde.getTransferable();
  dtde.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
  DataFlavor dtURL=null;
  try {
    dtURL=new DataFlavor("application/x-java-url; class=java.net.URL");
  }
 catch (  ClassNotFoundException e) {
    LOGGER.warn("Could not find DropTargetDropEvent class",e);
  }
  try {
    URL url=(URL)tsf.getTransferData(dtURL);
    JOptionChoice res=(JOptionChoice)JOptionPane.showInputDialog(editor,"",Globals.lang("Select action"),JOptionPane.QUESTION_MESSAGE,null,new JOptionChoice[]{new JOptionChoice(Globals.lang("Insert URL"),0),new JOptionChoice(Globals.lang("Download file"),1)},new JOptionChoice(Globals.lang("Insert URL"),0));
switch (res.getId()) {
case 0:
      feditor.setText(url.toString());
    editor.updateField(feditor);
  break;
case 1:
try {
  File file=new File(new File(Globals.prefs.get("pdfDirectory")),editor.getEntry().getField(BibtexFields.KEY_FIELD) + ".pdf");
  frame.output(Globals.lang("Downloading..."));
  URLDownload.buildMonitoredDownload(editor,url).downloadToFile(file);
  frame.output(Globals.lang("Download completed"));
  feditor.setText(file.toURI().toURL().toString());
  editor.updateField(feditor);
}
 catch (IOException ioex) {
  LOGGER.error("Error while downloading file",ioex);
  JOptionPane.showMessageDialog(editor,Globals.lang("File download"),Globals.lang("Error while downloading file:" + ioex.getMessage()),JOptionPane.ERROR_MESSAGE);
}
break;
}
return;
}
 catch (UnsupportedFlavorException nfe) {
LOGGER.warn("Could not parse URL",nfe);
}
catch (IOException ioex) {
LOGGER.warn("Could not perform drage and drop",ioex);
}
try {
@SuppressWarnings("unchecked") List<File> filelist=(List<File>)tsf.getTransferData(DataFlavor.javaFileListFlavor);
if (filelist.size() > 1) {
JOptionPane.showMessageDialog(editor,Globals.lang("Only one item is supported"),Globals.lang("Drag and Drop Error"),JOptionPane.ERROR_MESSAGE);
return;
}
File fl=filelist.get(0);
feditor.setText(fl.toURI().toURL().toString());
editor.updateField(feditor);
}
 catch (UnsupportedFlavorException nfe) {
JOptionPane.showMessageDialog(editor,Globals.lang("Operation not supported"),Globals.lang("Drag and Drop Error"),JOptionPane.ERROR_MESSAGE);
LOGGER.warn("Could not perform drage and drop",nfe);
}
catch (IOException ioex) {
LOGGER.warn("Could not perform drage and drop",ioex);
}
}
