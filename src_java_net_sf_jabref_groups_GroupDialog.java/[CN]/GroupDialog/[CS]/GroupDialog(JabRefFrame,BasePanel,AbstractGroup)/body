{
  super(jabrefFrame,Globals.lang("Edit group"),true);
  m_basePanel=basePanel;
  m_parent=jabrefFrame;
  m_editedGroup=editedGroup;
  m_kgSearchField.setText(jabrefFrame.prefs().get("groupsDefaultField"));
  ButtonGroup groupType=new ButtonGroup();
  groupType.add(m_explicitRadioButton);
  groupType.add(m_keywordsRadioButton);
  groupType.add(m_searchRadioButton);
  m_description.setVerticalAlignment(JLabel.TOP);
  getRootPane().setDefaultButton(m_ok);
  m_optionsPanel.setLayout(m_optionsLayout);
  m_optionsPanel.add(new JPanel(),"" + INDEX_EXPLICITGROUP);
  FormLayout layoutKG=new FormLayout("right:pref, 4dlu, fill:1dlu:grow, 2dlu, left:pref");
  DefaultFormBuilder builderKG=new DefaultFormBuilder(layoutKG);
  builderKG.append(Globals.lang("Field"));
  builderKG.append(m_kgSearchField,3);
  builderKG.nextLine();
  builderKG.append(Globals.lang("Keyword"));
  builderKG.append(m_kgSearchTerm);
  builderKG.append(new FieldContentSelector(m_parent,m_basePanel,this,m_kgSearchTerm,m_basePanel.metaData(),null,true));
  builderKG.nextLine();
  builderKG.append(m_kgCaseSensitive,3);
  builderKG.nextLine();
  builderKG.append(m_kgRegExp,3);
  m_optionsPanel.add(builderKG.getPanel(),"" + INDEX_KEYWORDGROUP);
  FormLayout layoutSG=new FormLayout("right:pref, 4dlu, fill:1dlu:grow");
  DefaultFormBuilder builderSG=new DefaultFormBuilder(layoutSG);
  builderSG.append(Globals.lang("Search expression"));
  builderSG.append(m_sgSearchExpression);
  builderSG.nextLine();
  builderSG.append(m_sgCaseSensitive,3);
  builderSG.nextLine();
  builderSG.append(m_sgRegExp,3);
  m_optionsPanel.add(builderSG.getPanel(),"" + INDEX_SEARCHGROUP);
  FormLayout layoutBP=new FormLayout("pref, 4dlu, pref","p");
  layoutBP.setColumnGroups(new int[][]{{1,3}});
  DefaultFormBuilder builderBP=new DefaultFormBuilder(layoutBP);
  builderBP.append(m_ok);
  builderBP.add(m_cancel);
  FormLayout layoutAll=new FormLayout("right:pref, 4dlu, fill:500px, 4dlu, fill:pref","p, 3dlu, p, 3dlu, p, 0dlu, p, 0dlu, p, 3dlu, p, 3dlu, " + "p, 3dlu, p, 3dlu, top:80dlu, 9dlu, p, , 9dlu, p");
  DefaultFormBuilder builderAll=new DefaultFormBuilder(layoutAll);
  builderAll.setDefaultDialogBorder();
  builderAll.appendSeparator(Globals.lang("General"));
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.append(Globals.lang("Name"));
  builderAll.append(m_name);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.append(m_explicitRadioButton,5);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.append(m_keywordsRadioButton,5);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.append(m_searchRadioButton,5);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.appendSeparator(Globals.lang("Options"));
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.append(m_optionsPanel,5);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.appendSeparator(Globals.lang("Description"));
  builderAll.nextLine();
  builderAll.nextLine();
  JScrollPane sp=new JScrollPane(m_description,JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,JScrollPane.HORIZONTAL_SCROLLBAR_AS_NEEDED){
    public Dimension getPreferredSize(){
      return getMaximumSize();
    }
  }
;
  builderAll.append(sp,5);
  builderAll.nextLine();
  builderAll.nextLine();
  builderAll.appendSeparator();
  builderAll.nextLine();
  builderAll.nextLine();
  CellConstraints cc=new CellConstraints();
  builderAll.add(builderBP.getPanel(),cc.xyw(builderAll.getColumn(),builderAll.getRow(),5,"center, fill"));
  Container cp=getContentPane();
  cp.setLayout(new BoxLayout(cp,BoxLayout.Y_AXIS));
  cp.add(builderAll.getPanel());
  pack();
  setResizable(false);
  updateComponents();
  setLayoutForSelectedGroup();
  Util.placeDialog(this,m_parent);
  ItemListener radioButtonItemListener=new ItemListener(){
    public void itemStateChanged(    ItemEvent e){
      setLayoutForSelectedGroup();
      updateComponents();
    }
  }
;
  m_explicitRadioButton.addItemListener(radioButtonItemListener);
  m_keywordsRadioButton.addItemListener(radioButtonItemListener);
  m_searchRadioButton.addItemListener(radioButtonItemListener);
  m_cancel.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      dispose();
    }
  }
);
  m_ok.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      m_okPressed=true;
      if (m_explicitRadioButton.isSelected()) {
        if (m_editedGroup instanceof ExplicitGroup) {
          m_resultingGroup=m_editedGroup.deepCopy();
          m_resultingGroup.setName(m_name.getText().trim());
        }
 else {
          m_resultingGroup=new ExplicitGroup(m_name.getText().trim());
          if (m_editedGroup != null)           addPreviousEntries();
        }
      }
 else       if (m_keywordsRadioButton.isSelected()) {
        m_resultingGroup=new KeywordGroup(m_name.getText().trim(),m_kgSearchField.getText().trim(),m_kgSearchTerm.getText().trim(),m_kgCaseSensitive.isSelected(),m_kgRegExp.isSelected());
        if (m_editedGroup != null && m_resultingGroup.supportsAdd()) {
          addPreviousEntries();
        }
      }
 else       if (m_searchRadioButton.isSelected()) {
        try {
          m_resultingGroup=new SearchGroup(m_name.getText().trim(),m_sgSearchExpression.getText().trim(),m_sgCaseSensitive.isSelected(),m_sgRegExp.isSelected());
        }
 catch (        Exception e1) {
        }
      }
      dispose();
    }
  }
);
  CaretListener caretListener=new CaretListener(){
    public void caretUpdate(    CaretEvent e){
      updateComponents();
    }
  }
;
  ItemListener itemListener=new ItemListener(){
    public void itemStateChanged(    ItemEvent e){
      updateComponents();
    }
  }
;
  m_name.addCaretListener(caretListener);
  m_kgSearchField.addCaretListener(caretListener);
  m_kgSearchTerm.addCaretListener(caretListener);
  m_kgCaseSensitive.addItemListener(itemListener);
  m_kgRegExp.addItemListener(itemListener);
  m_sgSearchExpression.addCaretListener(caretListener);
  m_sgRegExp.addItemListener(itemListener);
  m_sgCaseSensitive.addItemListener(itemListener);
  if (editedGroup instanceof KeywordGroup) {
    KeywordGroup group=(KeywordGroup)editedGroup;
    m_name.setText(group.getName());
    m_kgSearchField.setText(group.getSearchField());
    m_kgSearchTerm.setText(group.getSearchExpression());
    m_kgCaseSensitive.setSelected(group.isCaseSensitive());
    m_kgRegExp.setSelected(group.isRegExp());
    m_keywordsRadioButton.setSelected(true);
  }
 else   if (editedGroup instanceof SearchGroup) {
    SearchGroup group=(SearchGroup)editedGroup;
    m_name.setText(group.getName());
    m_sgSearchExpression.setText(group.getSearchExpression());
    m_sgCaseSensitive.setSelected(group.isCaseSensitive());
    m_sgRegExp.setSelected(group.isRegExp());
    m_searchRadioButton.setSelected(true);
  }
 else   if (editedGroup instanceof ExplicitGroup) {
    m_name.setText(editedGroup.getName());
    m_explicitRadioButton.setSelected(true);
  }
 else {
    m_explicitRadioButton.setSelected(true);
  }
}
