{
  super(jabrefFrame,Globals.lang("Edit group"),true);
  m_basePanel=basePanel;
  m_parent=jabrefFrame;
  m_editedGroup=editedGroup;
  m_searchField.setText(jabrefFrame.prefs().get("groupsDefaultField"));
  m_types.addElement("Explicit");
  m_types.addElement("Keywords");
  m_types.addElement("Search Expression");
  m_typeSelector.setModel(m_types);
  m_mainPanel=new JPanelYBoxPreferredWidth();
  FormLayout layout=new FormLayout("left:pref, 4dlu, fill:130dlu","");
  DefaultFormBuilder builder=new DefaultFormBuilder(layout);
  builder.append(m_searchFieldLabel);
  builder.append(m_searchField);
  builder.nextLine();
  builder.append(m_keywordLabel);
  builder.append(m_kgSearchExpression);
  builder.nextLine();
  builder.append(m_kgCaseSensitive);
  builder.nextLine();
  builder.append(m_kgIsRegExp);
  m_keywordGroupPanel=builder.getPanel();
  layout=new FormLayout("left:pref, 4dlu, fill:130dlu","");
  builder=new DefaultFormBuilder(layout);
  builder.append(m_searchExpressionLabel);
  builder.append(m_sgSearchExpression);
  builder.nextLine();
  builder.append(m_sgCaseSensitive);
  builder.nextLine();
  builder.append(m_sgIsRegExp);
  builder.nextLine();
  builder.append(m_searchAllFields);
  builder.nextLine();
  builder.append(m_searchRequiredFields);
  builder.nextLine();
  builder.append(m_searchOptionalFields);
  builder.nextLine();
  builder.append(m_searchGeneralFields);
  m_searchGroupPanel=builder.getPanel();
  m_keywordGroupPanel.setBorder(BorderFactory.createEmptyBorder(2,2,2,2));
  m_searchGroupPanel.setBorder(BorderFactory.createEmptyBorder(2,2,2,2));
  lowerPanel=new JPanel();
  lowerPanel.setLayout(lowerLayout);
  lowerPanel.add(new JPanel(),String.valueOf(INDEX_EXPLICITGROUP));
  lowerPanel.add(m_keywordGroupPanel,String.valueOf(INDEX_KEYWORDGROUP));
  lowerPanel.add(m_searchGroupPanel,String.valueOf(INDEX_SEARCHGROUP));
  layout=new FormLayout("left:pref, 4dlu, fill:80dlu","");
  builder=new DefaultFormBuilder(layout);
  builder.append(m_nameLabel);
  builder.append(m_name);
  builder.nextLine();
  builder.append(m_typeLabel);
  builder.append(m_typeSelector);
  m_mainPanel=builder.getPanel();
  m_mainPanel.setBorder(BorderFactory.createEmptyBorder(4,4,4,4));
  lowerPanel.setBorder(BorderFactory.createEtchedBorder());
  JPanel buttons=new JPanel();
  buttons.add(m_ok);
  buttons.add(m_cancel);
  Container cp=getContentPane();
  cp.setLayout(new BorderLayout());
  cp.add(m_mainPanel,BorderLayout.NORTH);
  cp.add(lowerPanel,BorderLayout.CENTER);
  cp.add(buttons,BorderLayout.SOUTH);
  m_typeSelector.addItemListener(new ItemListener(){
    public void itemStateChanged(    ItemEvent e){
      setLayoutForGroup(m_typeSelector.getSelectedIndex());
      updateComponents();
    }
  }
);
  m_cancel.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      dispose();
    }
  }
);
  m_ok.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      m_okPressed=true;
switch (m_typeSelector.getSelectedIndex()) {
case INDEX_EXPLICITGROUP:
        if (m_editedGroup instanceof ExplicitGroup) {
          m_resultingGroup=m_editedGroup.deepCopy();
          m_resultingGroup.setName(m_name.getText().trim());
        }
 else {
          m_resultingGroup=new ExplicitGroup(m_name.getText().trim(),m_basePanel.database());
          if (m_editedGroup == null)           break;
          addPreviousEntries();
        }
      break;
case INDEX_KEYWORDGROUP:
    m_resultingGroup=new KeywordGroup(m_name.getText().trim(),m_searchField.getText().trim(),m_kgSearchExpression.getText().trim(),m_kgCaseSensitive.isSelected(),m_kgIsRegExp.isSelected());
  break;
case INDEX_SEARCHGROUP:
try {
  m_resultingGroup=new SearchGroup(m_name.getText().trim(),m_sgSearchExpression.getText().trim(),m_sgCaseSensitive.isSelected(),m_sgIsRegExp.isSelected(),m_searchAllFields.isSelected(),m_searchRequiredFields.isSelected(),m_searchOptionalFields.isSelected(),m_searchGeneralFields.isSelected());
}
 catch (Exception e1) {
}
break;
}
dispose();
}
}
);
CaretListener caretListener=new CaretListener(){
public void caretUpdate(CaretEvent e){
updateComponents();
}
}
;
ItemListener itemListener=new ItemListener(){
public void itemStateChanged(ItemEvent e){
updateComponents();
}
}
;
m_name.addCaretListener(caretListener);
m_searchField.addCaretListener(caretListener);
m_kgSearchExpression.addCaretListener(caretListener);
m_kgCaseSensitive.addItemListener(itemListener);
m_kgIsRegExp.addItemListener(itemListener);
m_sgSearchExpression.addCaretListener(caretListener);
m_sgIsRegExp.addItemListener(itemListener);
m_sgCaseSensitive.addItemListener(itemListener);
m_searchAllFields.addItemListener(itemListener);
m_searchRequiredFields.addItemListener(itemListener);
m_searchOptionalFields.addItemListener(itemListener);
m_searchGeneralFields.addItemListener(itemListener);
if (editedGroup instanceof KeywordGroup) {
KeywordGroup group=(KeywordGroup)editedGroup;
m_name.setText(group.getName());
m_searchField.setText(group.getSearchField());
m_kgSearchExpression.setText(group.getSearchExpression());
m_kgCaseSensitive.setSelected(group.isCaseSensitive());
m_kgIsRegExp.setSelected(group.isRegExp());
m_typeSelector.setSelectedIndex(INDEX_KEYWORDGROUP);
}
 else if (editedGroup instanceof SearchGroup) {
SearchGroup group=(SearchGroup)editedGroup;
m_name.setText(group.getName());
m_sgSearchExpression.setText(group.getSearchExpression());
m_sgCaseSensitive.setSelected(group.isCaseSensitive());
m_sgIsRegExp.setSelected(group.isRegExp());
m_searchAllFields.setSelected(group.searchAllFields());
m_searchRequiredFields.setSelected(group.searchRequiredFields());
m_searchOptionalFields.setSelected(group.searchOptionalFields());
m_searchGeneralFields.setSelected(group.searchGeneralFields());
m_typeSelector.setSelectedIndex(INDEX_SEARCHGROUP);
}
 else if (editedGroup instanceof ExplicitGroup) {
m_name.setText(editedGroup.getName());
m_typeSelector.setSelectedIndex(INDEX_EXPLICITGROUP);
}
pack();
setResizable(true);
updateComponents();
setLayoutForGroup(m_typeSelector.getSelectedIndex());
Util.placeDialog(this,m_parent);
}
