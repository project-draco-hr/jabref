{
  super(parent,Globals.lang("JabRef preferences"),false);
  _prefs=prefs;
  frame=parent;
  getContentPane().setLayout(new BorderLayout());
  getContentPane().add(upper,BorderLayout.CENTER);
  getContentPane().add(lower,BorderLayout.SOUTH);
  String GEN=Globals.lang("General"), APP=Globals.lang("Appearance"), GRP=Globals.lang("Groups"), EXT=Globals.lang("External programs"), TAB=Globals.lang("Entry table"), COL=Globals.lang("Entry table columns"), KEY=Globals.lang("Key pattern"), PRE=Globals.lang("Entry preview"), ADV=Globals.lang("Advanced");
  ArrayList al=new ArrayList();
  al.add(GEN);
  al.add(APP);
  al.add(GRP);
  al.add(EXT);
  al.add(TAB);
  al.add(COL);
  al.add(KEY);
  al.add(PRE);
  al.add(ADV);
  main.setLayout(cardLayout);
  main.add(new GeneralTab(frame,_prefs),GEN);
  main.add(new AdvancedTab(_prefs,parent.helpDiag),ADV);
  main.add(new GroupsPrefsTab(_prefs),GRP);
  main.add(new AppearancePrefsTab(_prefs),APP);
  main.add(new ExternalTab(frame,_prefs,parent.helpDiag),EXT);
  main.add(new TablePrefsTab(_prefs,parent),TAB);
  main.add(new TableColumnsTab(_prefs,parent),COL);
  main.add(new TabLabelPattern(_prefs,parent.helpDiag),KEY);
  main.add(new PreviewPrefsTab(_prefs,parent.helpDiag),PRE);
  upper.setBorder(BorderFactory.createEtchedBorder());
  chooser=new JList(al.toArray());
  chooser.setBorder(BorderFactory.createEtchedBorder());
  chooser.setPrototypeCellValue("This should be wide enough");
  chooser.setSelectedIndex(0);
  chooser.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  chooser.addListSelectionListener(new ListSelectionListener(){
    public void valueChanged(    ListSelectionEvent e){
      if (e.getValueIsAdjusting())       return;
      String o=(String)chooser.getSelectedValue();
      cardLayout.show(main,o);
    }
  }
);
  JPanel one=new JPanel(), two=new JPanel();
  one.setLayout(new BorderLayout());
  two.setLayout(new BorderLayout());
  one.add(chooser,BorderLayout.CENTER);
  one.add(importPrefs,BorderLayout.SOUTH);
  two.add(one,BorderLayout.CENTER);
  two.add(exportPrefs,BorderLayout.SOUTH);
  upper.setLayout(new BorderLayout());
  upper.add(two,BorderLayout.WEST);
  upper.add(main,BorderLayout.CENTER);
  JButton ok=new JButton(Globals.lang("Ok")), cancel=new JButton(Globals.lang("Cancel"));
  ok.addActionListener(new OkAction());
  CancelAction cancelAction=new CancelAction();
  cancel.addActionListener(cancelAction);
  lower.setBorder(BorderFactory.createEmptyBorder(2,2,2,2));
  ButtonBarBuilder bb=new ButtonBarBuilder(lower);
  bb.addGlue();
  bb.addGridded(ok);
  bb.addGridded(cancel);
  bb.addGlue();
  ActionMap am=chooser.getActionMap();
  InputMap im=chooser.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  im.put(frame.prefs().getKey("Close dialog"),"close");
  am.put("close",cancelAction);
  exportPrefs.setToolTipText(Globals.lang("Export preferences to file"));
  importPrefs.setToolTipText(Globals.lang("Import preferences from file"));
  exportPrefs.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      String filename=Globals.getNewFile(frame,new File(System.getProperty("user.home")),".xml",JFileChooser.SAVE_DIALOG,false);
      if (filename == null)       return;
      File file=new File(filename);
      if (!file.exists() || (JOptionPane.showConfirmDialog(ths,"'" + file.getName() + "' "+ Globals.lang("exists. Overwrite file?"),Globals.lang("Export preferences"),JOptionPane.OK_CANCEL_OPTION) == JOptionPane.OK_OPTION)) {
        try {
          _prefs.exportPreferences(filename);
        }
 catch (        IOException ex) {
          JOptionPane.showMessageDialog(ths,Globals.lang("Could not export preferences") + ": " + ex.getMessage(),Globals.lang("Export preferences"),JOptionPane.ERROR_MESSAGE);
        }
      }
    }
  }
);
  importPrefs.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      String filename=Globals.getNewFile(frame,new File(System.getProperty("user.home")),".xml",JFileChooser.OPEN_DIALOG,false);
      if (filename == null)       return;
      try {
        _prefs.importPreferences(filename);
        setValues();
        BibtexEntryType.loadCustomEntryTypes(_prefs);
        frame.removeCachedEntryEditors();
      }
 catch (      IOException ex) {
        JOptionPane.showMessageDialog(ths,Globals.lang("Could not import preferences") + ": " + ex.getMessage(),Globals.lang("Import preferences"),JOptionPane.ERROR_MESSAGE);
      }
    }
  }
);
  setValues();
  pack();
}
