{
  super(parent,Globals.lang("JabRef preferences"),false);
  _prefs=prefs;
  frame=parent;
  getContentPane().setLayout(new BorderLayout());
  getContentPane().add(upper,BorderLayout.CENTER);
  getContentPane().add(lower,BorderLayout.SOUTH);
  String GEN=Globals.lang("General"), EXT=Globals.lang("External programs"), APP=Globals.lang("Appearance"), KEY=Globals.lang("Key pattern"), PRE=Globals.lang("Entry preview"), ADV=Globals.lang("Advanced");
  ArrayList al=new ArrayList();
  al.add(GEN);
  al.add(EXT);
  al.add(APP);
  al.add(KEY);
  al.add(PRE);
  main.setLayout(cardLayout);
  main.add(new GeneralTab(frame,_prefs),GEN);
  if (!Globals.ON_MAC) {
    al.add(ADV);
    main.add(new AdvancedTab(_prefs,parent.helpDiag),ADV);
  }
  main.add(new ExternalTab(frame,_prefs),EXT);
  main.add(new TablePrefsTab(_prefs,parent),APP);
  main.add(new TabLabelPattern(_prefs,parent.helpDiag),KEY);
  main.add(new PreviewPrefsTab(_prefs,parent.helpDiag),PRE);
  upper.setBorder(BorderFactory.createEtchedBorder());
  chooser=new JList(al.toArray());
  chooser.setBorder(BorderFactory.createEtchedBorder());
  chooser.setPrototypeCellValue("This should be wide enough");
  chooser.setSelectedIndex(0);
  chooser.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  chooser.addListSelectionListener(new ListSelectionListener(){
    public void valueChanged(    ListSelectionEvent e){
      if (e.getValueIsAdjusting())       return;
      String o=(String)chooser.getSelectedValue();
      cardLayout.show(main,o);
    }
  }
);
  upper.setLayout(new BorderLayout());
  upper.add(chooser,BorderLayout.WEST);
  upper.add(main,BorderLayout.CENTER);
  JButton ok=new JButton(Globals.lang("Ok")), cancel=new JButton(Globals.lang("Cancel"));
  ok.addActionListener(new OkAction());
  CancelAction cancelAction=new CancelAction();
  cancel.addActionListener(cancelAction);
  lower.add(ok);
  lower.add(cancel);
  ActionMap am=chooser.getActionMap();
  InputMap im=chooser.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  im.put(frame.prefs().getKey("Close dialog"),"close");
  am.put("close",cancelAction);
  pack();
}
