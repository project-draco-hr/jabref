{
  Charset oldEncoding=panel.getEncoding();
  Charset newEncoding=(Charset)encoding.getSelectedItem();
  panel.setEncoding(newEncoding);
  List<String> dir=new ArrayList<>(1);
  String text=fileDir.getText().trim();
  if (text.isEmpty()) {
    metaData.remove(Globals.prefs.get(JabRefPreferences.USER_FILE_DIR));
  }
 else {
    dir.add(text);
    metaData.putData(Globals.prefs.get(JabRefPreferences.USER_FILE_DIR),new Vector<>(dir));
  }
  dir=new ArrayList<>(1);
  text=fileDirIndv.getText().trim();
  if (text.isEmpty()) {
    metaData.remove(Globals.prefs.get(JabRefPreferences.USER_FILE_DIR_INDIVIDUAL));
  }
 else {
    dir.add(text);
    metaData.putData(Globals.prefs.get(JabRefPreferences.USER_FILE_DIR_INDIVIDUAL),new Vector<>(dir));
  }
  if (protect.isSelected()) {
    dir=new ArrayList<>(1);
    dir.add("true");
    metaData.putData(Globals.PROTECTED_FLAG_META,new Vector<>(dir));
  }
 else {
    metaData.remove(Globals.PROTECTED_FLAG_META);
  }
  SaveOrderConfig newSaveOrderConfig=saveOrderPanel.getSaveOrderConfig();
  if (saveInOriginalOrder.isSelected()) {
    newSaveOrderConfig.setSaveInOriginalOrder();
  }
 else {
    newSaveOrderConfig.setSaveInSpecifiedOrder();
  }
  boolean saveOrderConfigChanged;
  if (newSaveOrderConfig.equals(oldSaveOrderConfig)) {
    saveOrderConfigChanged=false;
  }
 else {
    saveOrderConfigChanged=true;
  }
  if (saveOrderConfigChanged) {
    Vector<String> serialized=newSaveOrderConfig.getVector();
    if (newSaveOrderConfig.equals(defaultSaveOrderConfig)) {
      metaData.remove(MetaData.SAVE_ORDER_CONFIG);
    }
 else {
      metaData.putData(MetaData.SAVE_ORDER_CONFIG,serialized);
    }
  }
  boolean saveActionsChanged=saveActionsPanel.hasChanged();
  if (saveActionsChanged) {
    saveActionsPanel.storeSettings(metaData);
  }
  boolean changed=saveOrderConfigChanged || !newEncoding.equals(oldEncoding) || !oldFileVal.equals(fileDir.getText())|| !oldFileIndvVal.equals(fileDirIndv.getText())|| (oldProtectVal != protect.isSelected())|| saveActionsChanged;
  if (changed) {
    panel.markNonUndoableBaseChanged();
  }
}
