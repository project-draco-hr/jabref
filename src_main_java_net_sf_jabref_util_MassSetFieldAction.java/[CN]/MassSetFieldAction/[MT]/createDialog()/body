{
  diag=new JDialog(frame,Localization.lang("Set/clear/rename fields"),true);
  field=new JComboBox<>();
  field.setEditable(true);
  text=new JTextField();
  text.setEnabled(false);
  renameTo=new JTextField();
  renameTo.setEnabled(false);
  JButton ok=new JButton(Localization.lang("OK"));
  JButton cancel=new JButton(Localization.lang("Cancel"));
  all=new JRadioButton(Localization.lang("All entries"));
  selected=new JRadioButton(Localization.lang("Selected entries"));
  clear=new JRadioButton(Localization.lang("Clear fields"));
  set=new JRadioButton(Localization.lang("Set fields"));
  rename=new JRadioButton(Localization.lang("Rename field to") + ":");
  rename.setToolTipText(Localization.lang("Move contents of a field into a field with a different name"));
  Set<String> allFields=frame.getCurrentBasePanel().database().getAllVisibleFields();
  for (  String f : allFields) {
    field.addItem(f);
  }
  set.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent e){
      text.setEnabled(set.isSelected());
    }
  }
);
  clear.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent event){
      overwrite.setEnabled(!clear.isSelected());
    }
  }
);
  rename.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent e){
      renameTo.setEnabled(rename.isSelected());
    }
  }
);
  overwrite=new JCheckBox(Localization.lang("Overwrite existing field values"),true);
  ButtonGroup bg=new ButtonGroup();
  bg.add(all);
  bg.add(selected);
  bg=new ButtonGroup();
  bg.add(clear);
  bg.add(set);
  bg.add(rename);
  FormBuilder builder=FormBuilder.create().layout(new FormLayout("left:pref, 4dlu, fill:100dlu:grow","pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref, 2dlu, pref"));
  builder.addSeparator(Localization.lang("Field name")).xyw(1,1,3);
  builder.add(Localization.lang("Field name")).xy(1,3);
  builder.add(field).xy(3,3);
  builder.addSeparator(Localization.lang("Include entries")).xyw(1,5,3);
  builder.add(all).xyw(1,7,3);
  builder.add(selected).xyw(1,9,3);
  builder.addSeparator(Localization.lang("New field value")).xyw(1,11,3);
  builder.add(set).xy(1,13);
  builder.add(text).xy(3,13);
  builder.add(clear).xyw(1,15,3);
  builder.add(rename).xy(1,17);
  builder.add(renameTo).xy(3,17);
  builder.add(overwrite).xyw(1,19,3);
  ButtonBarBuilder bb=new ButtonBarBuilder();
  bb.addGlue();
  bb.addButton(ok);
  bb.addButton(cancel);
  bb.addGlue();
  builder.getPanel().setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  bb.getPanel().setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  diag.getContentPane().add(builder.getPanel(),BorderLayout.CENTER);
  diag.getContentPane().add(bb.getPanel(),BorderLayout.SOUTH);
  diag.pack();
  ok.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      if (rename.isSelected()) {
        String[] fields=getFieldNames((String)field.getSelectedItem());
        if (fields.length > 1) {
          JOptionPane.showMessageDialog(diag,Localization.lang("You can only rename one field at a time"),"",JOptionPane.ERROR_MESSAGE);
          return;
        }
      }
      cancelled=false;
      diag.dispose();
    }
  }
);
  AbstractAction cancelAction=new AbstractAction(){
    @Override public void actionPerformed(    ActionEvent e){
      cancelled=true;
      diag.dispose();
    }
  }
;
  cancel.addActionListener(cancelAction);
  ActionMap am=builder.getPanel().getActionMap();
  InputMap im=builder.getPanel().getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  im.put(Globals.getKeyPrefs().getKey(KeyBinding.CLOSE_DIALOG),"close");
  am.put("close",cancelAction);
}
