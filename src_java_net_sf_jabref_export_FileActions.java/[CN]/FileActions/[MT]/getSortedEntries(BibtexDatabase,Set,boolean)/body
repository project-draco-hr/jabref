{
  String pri, sec, ter;
  boolean priD, secD, terD, priBinary=false;
  if (!isSaveOperation || !Globals.prefs.getBoolean("saveInStandardOrder")) {
    priBinary=Globals.prefs.getBoolean("priBinary");
    pri=Globals.prefs.get("priSort");
    sec=Globals.prefs.get("secSort");
    ter=Globals.prefs.get("terSort");
    priD=Globals.prefs.getBoolean("priDescending");
    secD=Globals.prefs.getBoolean("secDescending");
    terD=Globals.prefs.getBoolean("terDescending");
  }
 else {
    pri="author";
    sec="editor";
    ter="year";
    priD=false;
    secD=false;
    terD=true;
  }
  EntryComparator comp=new EntryComparator(false,false,Globals.KEY_FIELD);
  comp=new EntryComparator(false,terD,ter,comp);
  comp=new EntryComparator(false,secD,sec,comp);
  comp=new EntryComparator(priBinary,priD,pri,comp);
  TreeSet sorter=new TreeSet(new CrossRefEntryComparator(comp));
  if (keySet == null)   keySet=database.getKeySet();
  if (keySet != null) {
    Iterator i=keySet.iterator();
    for (; i.hasNext(); ) {
      sorter.add(database.getEntryById((String)(i.next())));
    }
  }
  return sorter;
}
