{
  PrintStream ps=null;
  try {
    LayoutHelper layoutHelper=new LayoutHelper(formatReader);
    Layout layout=layoutHelper.getLayoutFromText();
    Object[] keys=database.getKeySet().toArray();
    String key;
    ps=new PrintStream(new FileOutputStream(outFile));
    String pri=prefs.get("priSort"), sec=prefs.get("secSort"), ter=prefs.get("terSort");
    EntrySorter sorter=database.getSorter(new EntryComparator(prefs.getBoolean("priDescending"),prefs.getBoolean("secDescending"),prefs.getBoolean("terDescending"),pri,sec,ter));
    for (int i=0; i < sorter.getEntryCount(); i++) {
      key=(String)sorter.getIdAt(i);
      BibtexEntry entry=database.getEntryById(key);
      ps.println(layout.doLayout(entry));
    }
  }
 catch (  IOException ex) {
    ex.printStackTrace();
  }
}
