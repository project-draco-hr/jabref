{
  SaveSession ss=getSaveSession(StandardCharsets.UTF_8,new File(file));
  try (VerifyingWriter ps=ss.getWriter()){
    MODSDatabase md=new MODSDatabase(database,keySet);
    try {
      DOMSource source=new DOMSource(md.getDOMrepresentation());
      StreamResult result=new StreamResult(ps);
      Transformer trans=TransformerFactory.newInstance().newTransformer();
      trans.setOutputProperty(OutputKeys.INDENT,"yes");
      trans.transform(source,result);
    }
 catch (    TransformerException|IllegalArgumentException|TransformerFactoryConfigurationError e) {
      throw new Error(e);
    }
    finalizeSaveSession(ss);
  }
 catch (  SaveException|IOException ex) {
    throw new IOException(ex.getMessage());
  }
}
