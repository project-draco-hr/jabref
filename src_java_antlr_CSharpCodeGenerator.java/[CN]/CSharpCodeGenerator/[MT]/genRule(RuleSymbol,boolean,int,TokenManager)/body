{
  tabs=1;
  if (DEBUG_CODE_GENERATOR)   System.out.println("genRule(" + s.getId() + ")");
  if (!s.isDefined()) {
    antlrTool.error("undefined rule: " + s.getId());
    return;
  }
  RuleBlock rblk=s.getBlock();
  currentRule=rblk;
  currentASTResult=s.getId();
  declaredASTVariables.clear();
  boolean savegenAST=genAST;
  genAST=genAST && rblk.getAutoGen();
  saveText=rblk.getAutoGen();
  if (s.comment != null) {
    _println(s.comment);
  }
  print(s.access + " ");
  if (rblk.returnAction != null) {
    _print(extractTypeOfAction(rblk.returnAction,rblk.getLine(),rblk.getColumn()) + " ");
  }
 else {
    _print("void ");
  }
  _print(s.getId() + "(");
  _print(commonExtraParams);
  if (commonExtraParams.length() != 0 && rblk.argAction != null) {
    _print(",");
  }
  if (rblk.argAction != null) {
    _println("");
    tabs++;
    println(rblk.argAction);
    tabs--;
    print(")");
  }
 else {
    _print(")");
  }
  _print(" //throws " + exceptionThrown);
  if (grammar instanceof ParserGrammar) {
    _print(", TokenStreamException");
  }
 else   if (grammar instanceof LexerGrammar) {
    _print(", CharStreamException, TokenStreamException");
  }
  if (rblk.throwsSpec != null) {
    if (grammar instanceof LexerGrammar) {
      antlrTool.error("user-defined throws spec not allowed (yet) for lexer rule " + rblk.ruleName);
    }
 else {
      _print(", " + rblk.throwsSpec);
    }
  }
  _println("");
  _println("{");
  tabs++;
  if (rblk.returnAction != null)   println(rblk.returnAction + ";");
  println(commonLocalVars);
  if (grammar.traceRules) {
    if (grammar instanceof TreeWalkerGrammar) {
      if (usingCustomAST)       println("traceIn(\"" + s.getId() + "\",(AST)_t);");
 else       println("traceIn(\"" + s.getId() + "\",_t);");
    }
 else {
      println("traceIn(\"" + s.getId() + "\");");
    }
  }
  if (grammar instanceof LexerGrammar) {
    if (s.getId().equals("mEOF"))     println("_ttype = Token.EOF_TYPE;");
 else     println("_ttype = " + s.getId().substring(1) + ";");
    bSaveIndexCreated=false;
  }
  if (grammar.debuggingOutput)   if (grammar instanceof ParserGrammar)   println("fireEnterRule(" + ruleNum + ",0);");
 else   if (grammar instanceof LexerGrammar)   println("fireEnterRule(" + ruleNum + ",_ttype);");
  if (grammar.debuggingOutput || grammar.traceRules) {
    println("try { // debugging");
    tabs++;
  }
  if (grammar instanceof TreeWalkerGrammar) {
    println(labeledElementASTType + " " + s.getId()+ "_AST_in = ("+ labeledElementASTType+ ")_t;");
  }
  if (grammar.buildAST) {
    println("returnAST = null;");
    println("ASTPair currentAST = new ASTPair();");
    println(labeledElementASTType + " " + s.getId()+ "_AST = null;");
  }
  genBlockPreamble(rblk);
  genBlockInitAction(rblk);
  println("");
  ExceptionSpec unlabeledUserSpec=rblk.findExceptionSpec("");
  if (unlabeledUserSpec != null || rblk.getDefaultErrorHandler()) {
    println("try {      // for error handling");
    tabs++;
  }
  if (rblk.alternatives.size() == 1) {
    Alternative alt=rblk.getAlternativeAt(0);
    String pred=alt.semPred;
    if (pred != null)     genSemPred(pred,currentRule.line);
    if (alt.synPred != null) {
      antlrTool.warning("Syntactic predicate ignored for single alternative",grammar.getFilename(),alt.synPred.getLine(),alt.synPred.getColumn());
    }
    genAlt(alt,rblk);
  }
 else {
    boolean ok=grammar.theLLkAnalyzer.deterministic(rblk);
    CSharpBlockFinishingInfo howToFinish=genCommonBlock(rblk,false);
    genBlockFinish(howToFinish,throwNoViable);
  }
  if (unlabeledUserSpec != null || rblk.getDefaultErrorHandler()) {
    tabs--;
    println("}");
  }
  if (unlabeledUserSpec != null) {
    genErrorHandler(unlabeledUserSpec);
  }
 else   if (rblk.getDefaultErrorHandler()) {
    println("catch (" + exceptionThrown + " ex)");
    println("{");
    tabs++;
    if (grammar.hasSyntacticPredicate) {
      println("if (0 == inputState.guessing)");
      println("{");
      tabs++;
    }
    println("reportError(ex);");
    if (!(grammar instanceof TreeWalkerGrammar)) {
      Lookahead follow=grammar.theLLkAnalyzer.FOLLOW(1,rblk.endNode);
      String followSetName=getBitsetName(markBitsetForGen(follow.fset));
      println("consume();");
      println("consumeUntil(" + followSetName + ");");
    }
 else {
      println("if (null != _t)");
      println("{");
      tabs++;
      println("_t = _t.getNextSibling();");
      tabs--;
      println("}");
    }
    if (grammar.hasSyntacticPredicate) {
      tabs--;
      println("}");
      println("else");
      println("{");
      tabs++;
      println("throw;");
      tabs--;
      println("}");
    }
    tabs--;
    println("}");
  }
  if (grammar.buildAST) {
    println("returnAST = " + s.getId() + "_AST;");
  }
  if (grammar instanceof TreeWalkerGrammar) {
    println("retTree_ = _t;");
  }
  if (rblk.getTestLiterals()) {
    if (s.access.equals("protected")) {
      genLiteralsTestForPartialToken();
    }
 else {
      genLiteralsTest();
    }
  }
  if (grammar instanceof LexerGrammar) {
    println("if (_createToken && (null == _token) && (_ttype != Token.SKIP))");
    println("{");
    tabs++;
    println("_token = makeToken(_ttype);");
    println("_token.setText(text.ToString(_begin, text.Length-_begin));");
    tabs--;
    println("}");
    println("returnToken_ = _token;");
  }
  if (rblk.returnAction != null) {
    println("return " + extractIdOfAction(rblk.returnAction,rblk.getLine(),rblk.getColumn()) + ";");
  }
  if (grammar.debuggingOutput || grammar.traceRules) {
    tabs--;
    println("}");
    println("finally");
    println("{ // debugging");
    tabs++;
    if (grammar.debuggingOutput)     if (grammar instanceof ParserGrammar)     println("fireExitRule(" + ruleNum + ",0);");
 else     if (grammar instanceof LexerGrammar)     println("fireExitRule(" + ruleNum + ",_ttype);");
    if (grammar.traceRules) {
      if (grammar instanceof TreeWalkerGrammar) {
        println("traceOut(\"" + s.getId() + "\",_t);");
      }
 else {
        println("traceOut(\"" + s.getId() + "\");");
      }
    }
    tabs--;
    println("}");
  }
  tabs--;
  println("}");
  println("");
  genAST=savegenAST;
}
