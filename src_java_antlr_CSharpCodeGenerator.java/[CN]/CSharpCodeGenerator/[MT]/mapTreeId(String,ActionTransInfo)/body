{
  if (currentRule == null)   return idParam;
  boolean in_var=false;
  String id=idParam;
  if (grammar instanceof TreeWalkerGrammar) {
    if (!grammar.buildAST) {
      in_var=true;
    }
 else     if (id.length() > 3 && id.lastIndexOf("_in") == id.length() - 3) {
      id=id.substring(0,id.length() - 3);
      in_var=true;
    }
  }
  for (int i=0; i < currentRule.labeledElements.size(); i++) {
    AlternativeElement elt=(AlternativeElement)currentRule.labeledElements.elementAt(i);
    if (elt.getLabel().equals(id)) {
      return in_var ? id : id + "_AST";
    }
  }
  String s=(String)treeVariableMap.get(id);
  if (s != null) {
    if (s == NONUNIQUE) {
      antlrTool.error("Ambiguous reference to AST element " + id + " in rule "+ currentRule.getRuleName());
      return null;
    }
 else     if (s.equals(currentRule.getRuleName())) {
      antlrTool.error("Ambiguous reference to AST element " + id + " in rule "+ currentRule.getRuleName());
      return null;
    }
 else {
      return in_var ? s + "_in" : s;
    }
  }
  if (id.equals(currentRule.getRuleName())) {
    String r=in_var ? id + "_AST_in" : id + "_AST";
    if (transInfo != null) {
      if (!in_var) {
        transInfo.refRuleRoot=r;
      }
    }
    return r;
  }
 else {
    return id;
  }
}
