{
  File testBibtexFile=new File("src/test/resources/testbib/complex.bib");
  Charset encoding=StandardCharsets.UTF_8;
  ParserResult result=BibtexParser.parse(ImportFormatReader.getReader(testBibtexFile,encoding));
  BibDatabaseWriter databaseWriter=new BibDatabaseWriter();
  SavePreferences preferences=new SavePreferences().withEncoding(encoding).withSaveInOriginalOrder(true);
  BibDatabaseContext context=new BibDatabaseContext(result.getDatabase(),result.getMetaData(),new Defaults(BibDatabaseMode.BIBTEX));
  StringWriter stringWriter=new StringWriter();
  databaseWriter.writePartOfDatabase(stringWriter,context,result.getDatabase().getEntries(),preferences);
  try (Scanner scanner=new Scanner(testBibtexFile)){
    Assert.assertEquals(scanner.useDelimiter("\\A").next(),stringWriter.toString());
  }
 }
