{
  BibDatabaseWriter databaseWriter=new BibDatabaseWriter();
  SavePreferences preferences=new SavePreferences();
  preferences.setEncoding(Charsets.US_ASCII);
  BibDatabase database=new BibDatabase();
  database.setPreamble("Test preamble");
  BibDatabaseContext context=new BibDatabaseContext(database,new Defaults(BibDatabaseMode.BIBTEX));
  StringWriter stringWriter=new StringWriter();
  databaseWriter.writePartOfDatabase(stringWriter,context,Collections.emptyList(),preferences,false,false);
  Assert.assertEquals("% Encoding: US-ASCII" + Globals.NEWLINE + Globals.NEWLINE+ "@PREAMBLE{Test preamble}"+ Globals.NEWLINE,stringWriter.toString());
}
