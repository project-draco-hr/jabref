{
  tokenStart=tokenEnd;
  while (tokenStart < original.length()) {
    char c=original.charAt(tokenStart);
    if (!(c == '~' || c == '-' || Character.isWhitespace(c))) {
      break;
    }
    tokenStart++;
  }
  tokenEnd=tokenStart;
  if (tokenStart >= original.length()) {
    return AuthorList.TOKEN_EOF;
  }
  if (original.charAt(tokenStart) == ',') {
    tokenEnd++;
    return AuthorList.TOKEN_COMMA;
  }
  tokenAbbr=-1;
  tokenTerm=' ';
  tokenCase=true;
  int braces_level=0;
  int current_backslash=-1;
  boolean first_letter_is_found=false;
  while (tokenEnd < original.length()) {
    char c=original.charAt(tokenEnd);
    if (c == '{') {
      braces_level++;
    }
    if (braces_level > 0) {
      if (c == '}') {
        braces_level--;
      }
    }
    if (first_letter_is_found && tokenAbbr < 0 && braces_level == 0) {
      tokenAbbr=tokenEnd;
    }
    if (!first_letter_is_found && current_backslash < 0 && Character.isLetter(c)) {
      if (braces_level == 0) {
        tokenCase=Character.isUpperCase(c);
      }
 else {
        tokenCase=true;
      }
      first_letter_is_found=true;
    }
    if (current_backslash >= 0 && !Character.isLetter(c)) {
      if (!first_letter_is_found) {
        String tex_cmd_name=original.substring(current_backslash + 1,tokenEnd);
        if (AuthorList.TEX_NAMES.contains(tex_cmd_name)) {
          tokenCase=Character.isUpperCase(tex_cmd_name.charAt(0));
          first_letter_is_found=true;
        }
      }
      current_backslash=-1;
    }
    if (c == '\\') {
      current_backslash=tokenEnd;
    }
    if (braces_level == 0) {
      if (c == ',' || c == '~' || c == '-' || Character.isWhitespace(c)) {
        break;
      }
    }
    tokenEnd++;
  }
  if (tokenAbbr < 0) {
    tokenAbbr=tokenEnd;
  }
  if (tokenEnd < original.length() && original.charAt(tokenEnd) == '-') {
    tokenTerm='-';
  }
  if (original.substring(tokenStart,tokenEnd).equalsIgnoreCase("and")) {
    return AuthorList.TOKEN_AND;
  }
 else {
    return AuthorList.TOKEN_WORD;
  }
}
