{
  if (bibDatabaseContext.getMetaData() == null) {
    List<BibEntry> result=new LinkedList<>();
    result.addAll(bibDatabaseContext.getDatabase().getEntries());
    return result;
  }
  List<Comparator<BibEntry>> comparators=BibDatabaseWriter.getSaveComparators(prefs,bibDatabaseContext.getMetaData());
  FieldComparatorStack<BibEntry> comparatorStack=new FieldComparatorStack<>(comparators);
  List<BibEntry> sorted=new ArrayList<>();
  if (keySet == null) {
    keySet=bibDatabaseContext.getDatabase().getKeySet();
  }
  for (  String id : keySet) {
    sorted.add(bibDatabaseContext.getDatabase().getEntryById(id));
  }
  Collections.sort(sorted,comparatorStack);
  return sorted;
}
