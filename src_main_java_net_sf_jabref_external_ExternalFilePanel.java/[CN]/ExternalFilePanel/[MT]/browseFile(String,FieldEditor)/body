{
  String[] dirs=metaData.getFileDirectory(fieldName);
  String directory=null;
  if (dirs.length > 0) {
    directory=dirs[0];
  }
  String dir=editor.getText();
  String retVal;
  if (directory == null || !new File(dir).isAbsolute()) {
    if (directory != null) {
      dir=directory;
    }
 else {
      dir=Globals.prefs.get(fieldName + Globals.FILETYPE_PREFS_EXT,"");
    }
  }
  String chosenFile=FileDialogs.getNewFile(frame,new File(dir),'.' + fieldName,JFileChooser.OPEN_DIALOG,false);
  if (chosenFile != null) {
    File newFile=new File(chosenFile);
    String position=newFile.getParent();
    if (directory != null && position.startsWith(directory)) {
      String relPath=position.substring(directory.length(),position.length()) + File.separator + newFile.getName();
      if (relPath.startsWith(File.separator)) {
        relPath=relPath.substring(File.separator.length(),relPath.length());
      }
      retVal=relPath;
    }
 else {
      retVal=newFile.getPath();
    }
    editor.setText(retVal);
    Globals.prefs.put(fieldName + Globals.FILETYPE_PREFS_EXT,newFile.getPath());
  }
}
