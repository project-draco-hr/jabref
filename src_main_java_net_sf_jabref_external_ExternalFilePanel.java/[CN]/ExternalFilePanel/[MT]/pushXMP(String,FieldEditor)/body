{
  JabRefExecutorService.INSTANCE.execute(new Runnable(){
    @Override public void run(){
      output(Globals.lang("Looking for pdf..."));
      String[] dirs=metaData.getFileDirectory(fieldName);
      File file=null;
      if (dirs.length > 0) {
        File tmp=FileUtil.expandFilename(editor.getText(),dirs);
        if (tmp != null) {
          file=tmp;
        }
      }
      if (file == null) {
        file=new File(editor.getText());
      }
      final File finalFile=file;
      output(Globals.lang("Writing XMP to '%0'...",finalFile.getName()));
      try {
        XMPUtil.writeXMP(finalFile,getEntry(),getDatabase());
        output(Globals.lang("Wrote XMP to '%0'.",finalFile.getName()));
      }
 catch (      IOException e) {
        JOptionPane.showMessageDialog(editor.getParent(),Globals.lang("Error writing XMP to file: %0",e.getLocalizedMessage()),Globals.lang("Writing XMP"),JOptionPane.ERROR_MESSAGE);
        Globals.logger(Globals.lang("Error writing XMP to file: %0",finalFile.getAbsolutePath()));
        output(Globals.lang("Error writing XMP to file: %0",finalFile.getName()));
      }
catch (      TransformerException e) {
        JOptionPane.showMessageDialog(editor.getParent(),Globals.lang("Error converting BibTeX to XMP: %0",e.getLocalizedMessage()),Globals.lang("Writing XMP"),JOptionPane.ERROR_MESSAGE);
        Globals.logger(Globals.lang("Error while converting BibtexEntry to XMP %0",finalFile.getAbsolutePath()));
        output(Globals.lang("Error converting XMP to '%0'...",finalFile.getName()));
      }
    }
  }
);
}
