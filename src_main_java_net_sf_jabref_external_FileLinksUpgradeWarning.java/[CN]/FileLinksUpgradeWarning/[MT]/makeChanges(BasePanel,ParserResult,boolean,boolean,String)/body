{
  if (upgradeDatabase) {
    NamedCompound ce=Util.upgradePdfPsToFile(pr.getDatabase(),FileLinksUpgradeWarning.FIELDS_TO_LOOK_FOR);
    panel.undoManager.addEdit(ce);
    panel.markBaseChanged();
  }
  if (fileDir != null) {
    Globals.prefs.put(GUIGlobals.FILE_FIELD + "Directory",fileDir);
  }
  if (upgradePrefs) {
    Globals.prefs.putBoolean(JabRefPreferences.PDF_COLUMN,Boolean.FALSE);
    Globals.prefs.putBoolean(JabRefPreferences.FILE_COLUMN,Boolean.TRUE);
    if (!showsFileInGenFields()) {
      String gfs=Globals.prefs.get(JabRefPreferences.CUSTOM_TAB_FIELDS + "0");
      StringBuilder sb=new StringBuilder(gfs);
      if (gfs.length() > 0) {
        sb.append(";");
      }
      sb.append(GUIGlobals.FILE_FIELD);
      Globals.prefs.put(JabRefPreferences.CUSTOM_TAB_FIELDS + "0",sb.toString());
      Globals.prefs.updateEntryEditorTabList();
      panel.frame().removeCachedEntryEditors();
    }
    panel.frame().setupAllTables();
  }
}
