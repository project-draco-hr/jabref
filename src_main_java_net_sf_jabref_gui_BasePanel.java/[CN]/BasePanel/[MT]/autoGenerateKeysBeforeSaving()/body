{
  if (Globals.prefs.getBoolean(JabRefPreferences.GENERATE_KEYS_BEFORE_SAVING)) {
    NamedCompound ce=new NamedCompound(Localization.lang("Autogenerate BibTeX keys"));
    boolean any=false;
    for (    BibEntry bes : bibDatabaseContext.getDatabase().getEntries()) {
      Optional<String> oldKey=bes.getCiteKeyOptional();
      if (!(oldKey.isPresent()) || oldKey.get().isEmpty()) {
        BibtexKeyPatternUtil.makeLabel(bibDatabaseContext.getMetaData().getCiteKeyPattern(Globals.prefs.getBibtexKeyPatternPreferences().getKeyPattern()),bibDatabaseContext.getDatabase(),bes,Globals.prefs.getBibtexKeyPatternPreferences());
        ce.addEdit(new UndoableKeyChange(bibDatabaseContext.getDatabase(),bes,null,bes.getCiteKeyOptional().get()));
        any=true;
      }
    }
    if (any) {
      ce.end();
      getUndoManager().addEdit(ce);
    }
  }
}
