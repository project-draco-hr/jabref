{
  if (Globals.prefs.getBoolean(JabRefPreferences.GENERATE_KEYS_BEFORE_SAVING)) {
    NamedCompound ce=new NamedCompound(Localization.lang("autogenerate keys"));
    boolean any=false;
    for (    BibtexEntry bes : database.getEntries()) {
      String oldKey=bes.getCiteKey();
      if (oldKey == null || oldKey.isEmpty()) {
        LabelPatternUtil.makeLabel(metaData,database,bes);
        ce.addEdit(new UndoableKeyChange(database,bes.getId(),null,bes.getField(BibtexEntry.KEY_FIELD)));
        any=true;
      }
    }
    if (any) {
      ce.end();
      undoManager.addEdit(ce);
    }
  }
}
