{
  if (database != null)   entries=database.resolveForStrings(entries,false);
  PDDocumentCatalog catalog=document.getDocumentCatalog();
  PDMetadata metaRaw=catalog.getMetadata();
  XMPMetadata meta;
  if (metaRaw != null) {
    meta=new XMPMetadata(XMLUtil.parse(metaRaw.createInputStream()));
  }
 else {
    meta=new XMPMetadata();
  }
  List<XMPSchema> schemas=meta.getSchemasByNamespaceURI(XMPSchemaDublinCore.NAMESPACE);
  for (  XMPSchema schema : schemas) {
    schema.getElement().getParentNode().removeChild(schema.getElement());
  }
  for (  BibtexEntry entry : entries) {
    XMPSchemaDublinCore dcSchema=new XMPSchemaDublinCore(meta);
    writeToDCSchema(dcSchema,entry,null);
    meta.addSchema(dcSchema);
  }
  ByteArrayOutputStream os=new ByteArrayOutputStream();
  meta.save(os);
  ByteArrayInputStream is=new ByteArrayInputStream(os.toByteArray());
  PDMetadata metadataStream=new PDMetadata(document,is,false);
  catalog.setMetadata(metadataStream);
}
