{
  String newKey="";
  if (ruleTable.containsKey(newEntry.getType().getName())) {
    newKey=ruleTable.get(newEntry.getType().getName()).applyRule(newEntry);
  }
 else {
    newKey=applyDefaultRule(newEntry);
  }
  newKey=Util.checkLegalKey(newKey);
  if (base.setCiteKeyForEntry(newEntry.getId(),newKey)) {
    char c='b';
    String modKey=newKey + 'a';
    while (base.setCiteKeyForEntry(newEntry.getId(),modKey)) {
      modKey=newKey + ((c));
      c++;
    }
  }
  return newEntry;
}
