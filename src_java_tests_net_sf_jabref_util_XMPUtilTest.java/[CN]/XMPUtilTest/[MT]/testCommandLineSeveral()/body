{
  File tempBib=File.createTempFile("JabRef",".bib");
  FileWriter fileWriter=null;
  try {
    fileWriter=new FileWriter(tempBib);
    fileWriter.write(t1BibtexString());
    fileWriter.write(t3BibtexString());
    fileWriter.close();
    ByteArrayOutputStream s=new ByteArrayOutputStream();
    PrintStream oldOut=System.out;
    System.setOut(new PrintStream(s));
    XMPUtil.main(new String[]{tempBib.getAbsolutePath(),pdfFile.getAbsolutePath()});
    System.setOut(oldOut);
    s.close();
    List<BibtexEntry> l=XMPUtil.readXMP(pdfFile);
    assertEquals(2,l.size());
    BibtexEntry a=(BibtexEntry)l.get(0);
    BibtexEntry b=(BibtexEntry)l.get(1);
    if (a.getCiteKey().equals("Clarkson06")) {
      BibtexEntry tmp=a;
      a=b;
      b=tmp;
    }
    BibtexEntry t1=t1BibtexEntry();
    BibtexEntry t3=t3BibtexEntry();
    t3.setField("month","July");
    assertEquals(t1,a);
    assertEquals(t3,b);
  }
  finally {
    if (fileWriter != null)     fileWriter.close();
    if (tempBib != null)     tempBib.delete();
  }
}
