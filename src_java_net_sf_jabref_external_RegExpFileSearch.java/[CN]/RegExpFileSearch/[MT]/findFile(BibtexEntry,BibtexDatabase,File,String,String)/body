{
  ArrayList<File> res=new ArrayList<File>();
  if (file.startsWith("/")) {
    directory=new File(".");
    file=file.substring(1);
  }
  Matcher m=Pattern.compile("([^\\\\])\\\\([^\\\\])").matcher(file);
  StringBuffer s=new StringBuffer();
  while (m.find()) {
    m.appendReplacement(s,m.group(1) + "/" + m.group(2));
  }
  m.appendTail(s);
  file=s.toString();
  String[] fileParts=file.split("/");
  if (fileParts.length == 0)   return res;
  if (fileParts.length > 1) {
    for (int i=0; i < fileParts.length - 1; i++) {
      String dirToProcess=fileParts[i];
      dirToProcess=Util.expandBrackets(dirToProcess,entry,database);
      if (dirToProcess.matches("^.:$")) {
        directory=new File(dirToProcess + "/");
        continue;
      }
      if (dirToProcess.equals(".")) {
        continue;
      }
      if (dirToProcess.equals("..")) {
        directory=new File(directory.getParent());
        continue;
      }
      if (dirToProcess.equals("*")) {
        File[] subDirs=directory.listFiles();
        if (subDirs != null) {
          String restOfFileString=Util.join(fileParts,"/",i + 1,fileParts.length);
          for (          File subDir : subDirs) {
            if (subDir.isDirectory()) {
              res.addAll(findFile(entry,database,subDir,restOfFileString,extensionRegExp));
            }
          }
        }
      }
      if (dirToProcess.equals("**")) {
        List<File> toDo=new LinkedList<File>();
        toDo.add(directory);
        String restOfFileString=Util.join(fileParts,"/",i + 1,fileParts.length);
        while (!toDo.isEmpty()) {
          File[] subDirs=toDo.remove(0).listFiles();
          if (subDirs == null)           continue;
          toDo.addAll(Arrays.asList(subDirs));
          for (          File subDir : subDirs) {
            if (!subDir.isDirectory())             continue;
            res.addAll(findFile(entry,database,subDir,restOfFileString,extensionRegExp));
          }
        }
      }
    }
  }
  String filePart=fileParts[fileParts.length - 1].replaceAll("\\[extension\\]",EXT_MARKER);
  String filenameToLookFor=Util.expandBrackets(filePart,entry,database).replaceAll(EXT_MARKER,extensionRegExp);
  final Pattern toMatch=Pattern.compile("^" + filenameToLookFor.replaceAll("\\\\\\\\","\\\\") + "$",Pattern.CASE_INSENSITIVE);
  File[] matches=directory.listFiles(new FilenameFilter(){
    public boolean accept(    File arg0,    String arg1){
      return toMatch.matcher(arg1).matches();
    }
  }
);
  if (matches != null && (matches.length > 0))   for (  File match : matches) {
    res.add(match);
  }
  return res;
}
