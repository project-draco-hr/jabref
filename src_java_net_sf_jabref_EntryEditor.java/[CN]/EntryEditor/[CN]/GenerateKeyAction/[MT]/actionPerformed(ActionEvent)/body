{
  try {
    storeCurrentEdit();
    Object oldValue=entry.getField(BibtexFields.KEY_FIELD);
    LabelPatternUtil.makeLabel(prefs.getKeyPattern(),panel.database,entry);
    panel.undoManager.addEdit(new UndoableKeyChange(panel.database,entry.getId(),(String)oldValue,(String)entry.getField(BibtexFields.KEY_FIELD)));
    String bibtexKeyData=(String)entry.getField(BibtexFields.KEY_FIELD);
    setField(BibtexFields.KEY_FIELD,bibtexKeyData);
    updateSource();
    panel.markBaseChanged();
  }
 catch (  Throwable t) {
    System.err.println("error setting key: " + t);
  }
}
