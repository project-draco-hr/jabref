{
  frame=frame_;
  panel=panel_;
  entry=entry_;
  prefs=prefs_;
  entry.addPropertyChangeListener(this);
  helpAction=new HelpAction(frame.helpDiag,GUIGlobals.entryEditorHelp,"Help (F1)");
  closeAction=new CloseAction();
  copyKeyAction=new CopyKeyAction();
  generateKeyAction=new GenerateKeyAction(frame);
  storeFieldAction=new StoreFieldAction();
  setLayout(new BorderLayout());
  setupToolBar();
  setupFieldPanels(reqPanel,optPanel,genPanel);
  setupSourcePanel();
  tabbed.addTab("Required fields",new ImageIcon(GUIGlobals.showReqIconFile),reqPanel.getPane(),"Show required fields");
  tabbed.addTab("Optional fields",new ImageIcon(GUIGlobals.showOptIconFile),optPanel.getPane(),"Show optional fields");
  tabbed.addTab("General fields",new ImageIcon(GUIGlobals.showGenIconFile),genPanel.getPane(),"Show general fields");
  tabbed.addTab("Bibtex source",new ImageIcon(GUIGlobals.sourceIconFile),srcPanel,"Show/edit bibtex source");
  tabbed.addChangeListener(new TabListener());
  add(tabbed,BorderLayout.CENTER);
  setFocusTraversalPolicy(new LayoutFocusTraversalPolicy(){
    protected boolean accept(    Component c){
      return (super.accept(c) && (c instanceof JTextComponent));
    }
  }
);
  int prefHeight=(int)(Math.max(genW,Math.max(optW,reqW)) * GUIGlobals.FORM_HEIGHT[prefs.getInt("entryTypeFormHeightFactor")]);
  setSize(GUIGlobals.FORM_WIDTH[prefs.getInt("entryTypeFormWidth")],prefHeight);
  if (prefs.getBoolean("defaultShowSource")) {
    tabbed.setSelectedIndex(3);
  }
}
