{
  double scale=1.0;
  Graphics2D graphics2D;
  View rootView;
  graphics2D=(Graphics2D)graphics;
  pane.setSize((int)pageFormat.getImageableWidth(),Integer.MAX_VALUE);
  pane.validate();
  rootView=pane.getUI().getRootView(pane);
  if ((scaleWidthToFit) && (pane.getMinimumSize().getWidth() > pageFormat.getImageableWidth())) {
    scale=pageFormat.getImageableWidth() / pane.getMinimumSize().getWidth();
    graphics2D.scale(scale,scale);
  }
  graphics2D.setClip((int)(pageFormat.getImageableX() / scale),(int)(pageFormat.getImageableY() / scale),(int)(pageFormat.getImageableWidth() / scale),(int)(pageFormat.getImageableHeight() / scale));
  if (pageIndex > currentPage) {
    currentPage=pageIndex;
    pageStartY+=pageEndY;
    pageEndY=graphics2D.getClipBounds().getHeight();
  }
  graphics2D.translate(graphics2D.getClipBounds().getX(),graphics2D.getClipBounds().getY());
  Rectangle allocation=new Rectangle(0,(int)-pageStartY,(int)(pane.getMinimumSize().getWidth()),(int)(pane.getPreferredSize().getHeight()));
  if (printView(graphics2D,allocation,rootView)) {
    return Printable.PAGE_EXISTS;
  }
 else {
    pageStartY=0;
    pageEndY=0;
    currentPage=-1;
    return Printable.NO_SUCH_PAGE;
  }
}
