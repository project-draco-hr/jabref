{
  final ArrayList<BibEntry> result=new ArrayList<>(1);
  try (PDDocument document=PDDocument.load(in)){
    if (document.isEncrypted()) {
      LOGGER.error("Encrypted documents are not supported");
      return result;
    }
    String firstPageContents=getFirstPageContents(document);
    Optional<DOI> doi=DOI.findInText(firstPageContents);
    if (doi.isPresent()) {
      ImportInspector inspector=new ImportInspector(){
        @Override public void toFront(){
        }
        @Override public void setProgress(        int current,        int max){
        }
        @Override public void addEntry(        BibEntry entry){
          result.add(entry);
        }
      }
;
      doiToBibTeXFetcher.processQuery(doi.get().getDOI(),inspector,status);
      if (!result.isEmpty()) {
        return result;
      }
    }
    lines=firstPageContents.split(System.lineSeparator());
    proceedToNextNonEmptyLine();
    if (i >= lines.length) {
      return result;
    }
    curString=lines[i];
    i=i + 1;
    String author;
    String editor=null;
    String abstractT=null;
    String keywords=null;
    String title;
    String conference=null;
    String DOI=null;
    String series=null;
    String volume=null;
    String number=null;
    String pages=null;
    String publisher=null;
    EntryType type=BibtexEntryTypes.INPROCEEDINGS;
    if (curString.length() > 4) {
      extractYear();
      if (curString.contains("Conference")) {
        fillCurStringWithNonEmptyLines();
        conference=curString;
        curString="";
      }
 else {
        String lower=curString.toLowerCase();
        if (lower.contains("copyright")) {
          fillCurStringWithNonEmptyLines();
          publisher=curString;
          curString="";
        }
      }
    }
    fillCurStringWithNonEmptyLines();
    title=streamlineTitle(curString);
    curString="";
    author=null;
    while ((i < lines.length) && !"".equals(lines[i])) {
      curString=streamlineNames(lines[i]);
      if (author == null) {
        author=curString;
      }
 else {
        if ("".equals(curString)) {
        }
 else {
          author=author.concat(" and ").concat(curString);
        }
      }
      i++;
    }
    curString="";
    i++;
    while (i < lines.length) {
      curString=lines[i];
      if ((curString.length() >= "Abstract".length()) && "Abstract".equalsIgnoreCase(curString.substring(0,"Abstract".length()))) {
        if (curString.length() == "Abstract".length()) {
          curString="";
        }
 else {
          curString=curString.substring("Abstract".length() + 1).trim().concat(System.lineSeparator());
        }
        i++;
        while ((i < lines.length) && !"".equals(lines[i])) {
          curString=curString.concat(lines[i]).concat(System.lineSeparator());
          i++;
        }
        abstractT=curString;
        i++;
      }
 else       if ((curString.length() >= "Keywords".length()) && "Keywords".equalsIgnoreCase(curString.substring(0,"Keywords".length()))) {
        if (curString.length() == "Keywords".length()) {
          curString="";
        }
 else {
          curString=curString.substring("Keywords".length() + 1).trim();
        }
        i++;
        fillCurStringWithNonEmptyLines();
        keywords=removeNonLettersAtEnd(curString);
      }
 else {
        String lower=curString.toLowerCase();
        int pos=lower.indexOf("technical");
        if (pos >= 0) {
          type=BibtexEntryTypes.TECHREPORT;
          pos=curString.trim().lastIndexOf(' ');
          if (pos >= 0) {
            number=curString.substring(pos + 1);
          }
        }
        i++;
        proceedToNextNonEmptyLine();
      }
    }
    i=lines.length - 1;
    while (i >= 0) {
      readLastBlock();
      extractYear();
      int pos=curString.indexOf("(Eds.)");
      if ((pos >= 0) && (publisher == null)) {
        publisher="Springer";
        editor=streamlineNames(curString.substring(0,pos - 1));
        curString=curString.substring(pos + "(Eds.)".length() + 2);
        String[] springerSplit=curString.split(", ");
        if (springerSplit.length >= 4) {
          conference=springerSplit[0];
          String seriesData=springerSplit[1];
          int lastSpace=seriesData.lastIndexOf(' ');
          series=seriesData.substring(0,lastSpace);
          volume=seriesData.substring(lastSpace + 1);
          pages=springerSplit[2].substring(4);
          if (springerSplit[3].length() >= 4) {
            year=springerSplit[3].substring(0,4);
          }
        }
      }
 else {
        if (DOI == null) {
          pos=curString.indexOf("DOI");
          if (pos < 0) {
            pos=curString.indexOf("doi");
          }
          if (pos >= 0) {
            pos+=3;
            char delimiter=curString.charAt(pos);
            if ((delimiter == ':') || (delimiter == ' ')) {
              pos++;
            }
            int nextSpace=curString.indexOf(' ',pos);
            if (nextSpace > 0) {
              DOI=curString.substring(pos,nextSpace);
            }
 else {
              DOI=curString.substring(pos);
            }
          }
        }
        if ((publisher == null) && curString.contains("IEEE")) {
          publisher="IEEE";
          if (conference == null) {
            pos=curString.indexOf('$');
            if (pos > 0) {
              pos-=2;
              while ((pos >= 0) && (curString.charAt(pos) != ' ')) {
                pos--;
              }
              if (pos > 0) {
                conference=curString.substring(0,pos);
              }
            }
          }
        }
      }
    }
    BibEntry entry=new BibEntry();
    entry.setType(type);
    if (author != null) {
      entry.setField("author",author);
    }
    if (editor != null) {
      entry.setField("editor",editor);
    }
    if (abstractT != null) {
      entry.setField("abstract",abstractT);
    }
    if (keywords != null) {
      entry.setField("keywords",keywords);
    }
    if (title != null) {
      entry.setField("title",title);
    }
    if (conference != null) {
      entry.setField("booktitle",conference);
    }
    if (DOI != null) {
      entry.setField("doi",DOI);
    }
    if (series != null) {
      entry.setField("series",series);
    }
    if (volume != null) {
      entry.setField("volume",volume);
    }
    if (number != null) {
      entry.setField("number",number);
    }
    if (pages != null) {
      entry.setField("pages",pages);
    }
    if (year != null) {
      entry.setField("year",year);
    }
    if (publisher != null) {
      entry.setField("publisher",publisher);
    }
    entry.setField("review",firstPageContents);
    result.add(entry);
  }
 catch (  IOException e) {
    LOGGER.error("Could not load document",e);
  }
  return result;
}
