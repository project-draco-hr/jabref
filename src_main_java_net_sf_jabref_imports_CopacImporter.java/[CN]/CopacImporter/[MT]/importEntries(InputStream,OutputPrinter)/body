{
  if (stream == null) {
    throw new IOException("No stream given.");
  }
  BufferedReader in=new BufferedReader(ImportFormatReader.getReaderDefaultEncoding(stream));
  List<String> entries=new LinkedList<>();
  String str;
  StringBuffer sb=new StringBuffer();
  while ((str=in.readLine()) != null) {
    if (str.length() < 4) {
      continue;
    }
    String code=str.substring(0,4);
    if (code.equals("    ")) {
      sb.append(" ").append(str.trim());
    }
 else {
      if (str.substring(0,4).equals("TI- ")) {
        if (sb.length() > 0) {
          entries.add(sb.toString());
        }
        sb=new StringBuffer();
      }
      sb.append('\n').append(str);
    }
  }
  if (sb.length() > 0) {
    entries.add(sb.toString());
  }
  List<BibtexEntry> results=new LinkedList<>();
  for (  String entry : entries) {
    BibtexEntry b=new BibtexEntry(BibtexFields.DEFAULT_BIBTEXENTRY_ID,BibtexEntryType.BOOK);
    String[] lines=entry.split("\n");
    for (    String line1 : lines) {
      String line=line1.trim();
      if (line.length() < 4) {
        continue;
      }
      String code=line.substring(0,4);
switch (code) {
case "TI- ":
        setOrAppend(b,"title",line.substring(4).trim(),", ");
      break;
case "AU- ":
    setOrAppend(b,"author",line.substring(4).trim()," and ");
  break;
case "PY- ":
setOrAppend(b,"year",line.substring(4).trim(),", ");
break;
case "PU- ":
setOrAppend(b,"publisher",line.substring(4).trim(),", ");
break;
case "SE- ":
setOrAppend(b,"series",line.substring(4).trim(),", ");
break;
case "IS- ":
setOrAppend(b,"isbn",line.substring(4).trim(),", ");
break;
case "KW- ":
setOrAppend(b,"keywords",line.substring(4).trim(),", ");
break;
case "NT- ":
setOrAppend(b,"note",line.substring(4).trim(),", ");
break;
case "PD- ":
setOrAppend(b,"physicaldimensions",line.substring(4).trim(),", ");
break;
case "DT- ":
setOrAppend(b,"documenttype",line.substring(4).trim(),", ");
break;
default :
setOrAppend(b,code.substring(0,2),line.substring(4).trim(),", ");
break;
}
}
results.add(b);
}
return results;
}
