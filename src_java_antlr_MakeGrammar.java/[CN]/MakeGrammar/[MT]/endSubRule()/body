{
  super.endSubRule();
  nested--;
  BlockContext ctx=(BlockContext)blocks.pop();
  AlternativeBlock block=ctx.block;
  if (block.not && !(block instanceof SynPredBlock) && !(block instanceof ZeroOrMoreBlock)&& !(block instanceof OneOrMoreBlock)) {
    if (!analyzer.subruleCanBeInverted(block,grammar instanceof LexerGrammar)) {
      String newline=System.getProperty("line.separator");
      tool.error("This subrule cannot be inverted.  Only subrules of the form:" + newline + "    (T1|T2|T3...) or"+ newline+ "    ('c1'|'c2'|'c3'...)"+ newline+ "may be inverted (ranges are also allowed).",grammar.getFilename(),block.getLine(),block.getColumn());
    }
  }
  if (block instanceof SynPredBlock) {
    SynPredBlock synpred=(SynPredBlock)block;
    context().block.hasASynPred=true;
    context().currentAlt().synPred=synpred;
    grammar.hasSyntacticPredicate=true;
    synpred.removeTrackingOfRuleRefs(grammar);
  }
 else {
    addElementToCurrentAlt(block);
  }
  ctx.blockEnd.block.prepareForAnalysis();
}
