{
  boolean first=frame.getBasePanelCount() == 0;
  List<ParserResult> loaded=new ArrayList<>();
  Map<ParserResult,Integer> location=new HashMap<>();
  for (  File file : files) {
    File fileToLoad=file;
    boolean tryingAutosave;
    if (Globals.prefs.getBoolean(JabRefPreferences.PROMPT_BEFORE_USING_AUTOSAVE)) {
      int answer=JOptionPane.showConfirmDialog(null,"<html>" + Localization.lang("An autosave file was found for this database. This could indicate " + "that JabRef didn't shut down cleanly last time the file was used.") + "<br>"+ Localization.lang("Do you want to recover the database from the autosave file?")+ "</html>",Localization.lang("Autosave of file '%0'",file.getName()),JOptionPane.YES_NO_OPTION);
      tryingAutosave=answer == JOptionPane.YES_OPTION;
    }
 else {
      tryingAutosave=true;
    }
    if (tryingAutosave) {
      fileToLoad=AutoSaveManager.getAutoSaveFile(file);
    }
    boolean done=false;
    ParserResult pr;
    do {
      pr=OpenDatabaseAction.loadDatabaseOrAutoSave(fileToLoad.getPath(),true);
      if (pr.isInvalid()) {
        loaded.add(pr);
        BibDatabaseContext databaseContext=pr.getDatabaseContext();
        databaseContext.setDatabaseFile(file);
        BasePanel panel=frame.addTab(databaseContext,pr.getEncoding(),first);
        location.put(pr,frame.getBasePanelCount() - 1);
        if (tryingAutosave) {
          panel.markNonUndoableBaseChanged();
        }
        first=false;
        done=true;
      }
 else {
        if (tryingAutosave) {
          JOptionPane.showMessageDialog(frame,Localization.lang("Error opening autosave of '%0'. Trying to load '%0' instead.",file.getName()),Localization.lang("Error opening file"),JOptionPane.ERROR_MESSAGE);
          tryingAutosave=false;
          fileToLoad=file;
        }
 else {
          String message="<html>" + pr.getErrorMessage() + "<p>"+ Localization.lang("Error opening file '%0'.",file.getName())+ "</html>";
          JOptionPane.showMessageDialog(frame,message,Localization.lang("Error opening file"),JOptionPane.ERROR_MESSAGE);
          done=true;
        }
      }
    }
 while (!done);
    if (!pr.isInvalid() && Globals.prefs.getBoolean(JabRefPreferences.DISPLAY_KEY_WARNING_DIALOG_AT_STARTUP)) {
      ParserResultWarningDialog.showParserResultWarningDialog(pr,frame);
    }
  }
}
