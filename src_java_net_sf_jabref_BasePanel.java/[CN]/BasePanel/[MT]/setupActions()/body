{
  actions.put("undo",undoAction);
  actions.put("redo",redoAction);
  actions.put("edit",new BaseAction(){
    public void action(){
      int clickedOn=-1;
      if (entryTable.getSelectedRowCount() == 1) {
        clickedOn=entryTable.getSelectedRow();
      }
      if (clickedOn >= 0) {
        String id=tableModel.getNameFromNumber(clickedOn);
        if (!entryTypeForms.containsKey(id)) {
          BibtexEntry be=database.getEntryById(id);
          EntryTypeForm form=new EntryTypeForm(frame,ths,be,prefs);
          Util.placeDialog(form,frame);
          form.setVisible(true);
          entryTypeForms.put(id,form);
        }
 else {
          ((EntryTypeForm)(entryTypeForms.get(id))).setVisible(true);
        }
      }
    }
  }
);
  actions.put("save",new BaseAction(){
    public void action(){
      if (file == null)       runCommand("saveAs");
 else {
        try {
          FileActions.saveDatabase(database,metaData,file,prefs,false,false);
          undoManager.markUnchanged();
          baseChanged=false;
          frame.setTabTitle(ths,file.getName());
          frame.output(Globals.lang("Saved database") + " '" + file.getPath()+ "'.");
        }
 catch (        SaveException ex) {
          if (ex.specificEntry()) {
            int row=tableModel.getNumberFromName(ex.getEntry().getId()), topShow=Math.max(0,row - 3);
            entryTable.setRowSelectionInterval(row,row);
            entryTable.setColumnSelectionInterval(0,entryTable.getColumnCount() - 1);
            entryTable.scrollTo(topShow);
          }
          ex.printStackTrace();
          JOptionPane.showMessageDialog(frame,Globals.lang("Could not save file") + ".\n" + ex.getMessage(),Globals.lang("Save database"),JOptionPane.ERROR_MESSAGE);
        }
      }
    }
  }
);
  actions.put("saveAs",new BaseAction(){
    public void action(){
      JFileChooser chooser=new JFileChooser(prefs.get("workingDirectory"));
      Util.pr("BasePanel: must set file filter");
      int returnVal=chooser.showSaveDialog(frame);
      if (returnVal == JFileChooser.APPROVE_OPTION) {
        String name=chooser.getSelectedFile().getName(), path=chooser.getSelectedFile().getParent();
        if (!name.endsWith(".bib"))         name=name + ".bib";
        file=new File(path,name);
        if (!file.exists() || (JOptionPane.showConfirmDialog(frame,"File '" + name + "' exists. Overwrite?","Save database",JOptionPane.OK_CANCEL_OPTION) == JOptionPane.OK_OPTION)) {
          runCommand("save");
          prefs.put("workingDirectory",path);
        }
 else         file=null;
      }
 else {
      }
    }
  }
);
  actions.put("editPreamble",new BaseAction(){
    public void action(){
      if (preambleEditor == null) {
        PreambleEditor form=new PreambleEditor(frame,ths,database,prefs);
        Util.placeDialog(form,frame);
        form.setVisible(true);
        preambleEditor=form;
      }
 else {
        preambleEditor.setVisible(true);
      }
    }
  }
);
  actions.put("editStrings",new BaseAction(){
    public void action(){
      if (stringDialog == null) {
        StringDialog form=new StringDialog(frame,ths,database,prefs);
        Util.placeDialog(form,frame);
        form.setVisible(true);
        stringDialog=form;
      }
 else {
        stringDialog.setVisible(true);
      }
    }
  }
);
  actions.put("toggleGroups",new BaseAction(){
    public void action(){
      sidePaneManager.togglePanel("groups");
    }
  }
);
}
