{
  final ArrayList<BibtexEntry> res=new ArrayList<BibtexEntry>(1);
  PDDocument document=null;
  try {
    document=PDDocument.load(in);
  }
 catch (  IOException e) {
    logger.log(Level.SEVERE,"Could not load document",e);
    return res;
  }
  try {
    if (document.isEncrypted()) {
      logger.log(Level.INFO,Globals.lang("Encrypted documents are not supported"));
    }
    PDFTextStripper stripper=new PDFTextStripper();
    stripper.setStartPage(1);
    stripper.setEndPage(1);
    stripper.setSortByPosition(true);
    stripper.setParagraphEnd(System.getProperty("line.separator"));
    StringWriter writer=new StringWriter();
    stripper.writeText(document,writer);
    String textResult=writer.toString();
    String doi=Util.getDOI(textResult);
    if (doi.length() < textResult.length()) {
      ImportInspector i=new ImportInspector(){
        @Override public void toFront(){
        }
        @Override public void setProgress(        int current,        int max){
        }
        @Override public void addEntry(        BibtexEntry entry){
          res.add(entry);
        }
      }
;
      doiToBibTeXFetcher.processQuery(doi,i,status);
      if (res.size() != 0) {
        return res;
      }
 else {
      }
    }
    String author=null;
    String editor=null;
    String institution=null;
    String abstractT=null;
    String keywords=null;
    String title=null;
    String conference=null;
    String DOI=null;
    String series=null;
    String volume=null;
    String number=null;
    String pages=null;
    String publisher=null;
    BibtexEntryType type=BibtexEntryType.INPROCEEDINGS;
    final String lineBreak=System.getProperty("line.separator");
    split=textResult.split(lineBreak);
    proceedToNextNonEmptyLine();
    if (i >= split.length) {
      return res;
    }
    curString=split[i];
    i=i + 1;
    if (curString.length() > 4) {
      extractYear();
      if (curString.contains("Conference")) {
        fillCurStringWithNonEmptyLines();
        conference=curString;
        curString="";
      }
 else {
        String lower=curString.toLowerCase();
        if (lower.contains("copyright")) {
          fillCurStringWithNonEmptyLines();
          publisher=curString;
          curString="";
        }
      }
    }
    fillCurStringWithNonEmptyLines();
    title=streamlineTitle(curString);
    curString="";
    author=null;
    while ((i < split.length) && (!split[i].equals(""))) {
      curString=streamlineNames(split[i]);
      if (author == null) {
        author=curString;
      }
 else {
        if (curString.equals("")) {
        }
 else {
          author=author.concat(" and ").concat(curString);
        }
      }
      i++;
    }
    curString="";
    i++;
    while (i < split.length) {
      curString=split[i];
      if ((curString.length() >= "Abstract".length()) && (curString.substring(0,"Abstract".length()).equalsIgnoreCase("Abstract"))) {
        if (curString.length() == "Abstract".length()) {
          curString="";
        }
 else {
          curString=curString.substring("Abstract".length() + 1).trim().concat(lineBreak);
        }
        i++;
        while ((i < split.length) && (!split[i].equals(""))) {
          curString=curString.concat(split[i]).concat(lineBreak);
          i++;
        }
        abstractT=curString;
        i++;
      }
 else       if ((curString.length() >= "Keywords".length()) && (curString.substring(0,"Keywords".length()).equalsIgnoreCase("Keywords"))) {
        if (curString.length() == "Keywords".length()) {
          curString="";
        }
 else {
          curString=curString.substring("Keywords".length() + 1).trim();
        }
        i++;
        fillCurStringWithNonEmptyLines();
        keywords=removeNonLettersAtEnd(curString);
      }
 else {
        String lower=curString.toLowerCase();
        int pos=lower.indexOf("technical");
        if (pos >= 0) {
          type=BibtexEntryType.TECHREPORT;
          pos=curString.trim().lastIndexOf(' ');
          if (pos >= 0) {
            number=curString.substring(pos + 1);
          }
        }
        i++;
        proceedToNextNonEmptyLine();
      }
    }
    i=split.length - 1;
    while (i >= 0) {
      readLastBlock();
      extractYear();
      int pos=curString.indexOf("(Eds.)");
      if ((pos >= 0) && (publisher == null)) {
        publisher="Springer";
        editor=streamlineNames(curString.substring(0,pos - 1));
        curString=curString.substring(pos + "(Eds.)".length() + 2);
        String[] springerSplit=curString.split(", ");
        if (springerSplit.length >= 4) {
          conference=springerSplit[0];
          String seriesData=springerSplit[1];
          int lastSpace=seriesData.lastIndexOf(' ');
          series=seriesData.substring(0,lastSpace);
          volume=seriesData.substring(lastSpace + 1);
          pages=springerSplit[2].substring(4);
          if (springerSplit[3].length() >= 4) {
            year=springerSplit[3].substring(0,4);
          }
        }
      }
 else {
        if (DOI == null) {
          pos=curString.indexOf("DOI");
          if (pos < 0)           pos=curString.indexOf("doi");
          if (pos >= 0) {
            pos+=3;
            char delimiter=curString.charAt(pos);
            if ((delimiter == ':') || (delimiter == ' ')) {
              pos++;
            }
            int nextSpace=curString.indexOf(' ',pos);
            if (nextSpace > 0)             DOI=curString.substring(pos,nextSpace);
 else             DOI=curString.substring(pos);
          }
        }
        if ((publisher == null) && (curString.contains("IEEE"))) {
          publisher="IEEE";
          if (conference == null) {
            pos=curString.indexOf('$');
            if (pos > 0) {
              pos-=2;
              while ((pos >= 0) && (curString.charAt(pos) != ' '))               pos--;
              if (pos > 0) {
                conference=curString.substring(0,pos);
              }
            }
          }
        }
      }
    }
    BibtexEntry entry=new BibtexEntry();
    entry.setType(type);
    if (author != null)     entry.setField("author",author);
    if (editor != null)     entry.setField("editor",editor);
    if (institution != null)     entry.setField("institution",institution);
    if (abstractT != null)     entry.setField("abstract",abstractT);
    if (keywords != null)     entry.setField("keywords",keywords);
    if (title != null)     entry.setField("title",title);
    if (conference != null)     entry.setField("booktitle",conference);
    if (DOI != null)     entry.setField("doi",DOI);
    if (series != null)     entry.setField("series",series);
    if (volume != null)     entry.setField("volume",volume);
    if (number != null)     entry.setField("number",number);
    if (pages != null)     entry.setField("pages",pages);
    if (year != null)     entry.setField("year",year);
    if (publisher != null)     entry.setField("publisher",publisher);
    entry.setField("review",textResult);
    res.add(entry);
  }
 catch (  NoClassDefFoundError e) {
    if (e.getMessage().equals("org/bouncycastle/jce/provider/BouncyCastleProvider")) {
      status.showMessage(Globals.lang("Java Bouncy Castle library not found. Please download and install it. For more information see http://www.bouncycastle.org/."));
    }
 else {
      logger.log(Level.SEVERE,e.getLocalizedMessage(),e);
    }
  }
 finally {
    document.close();
  }
  return res;
}
