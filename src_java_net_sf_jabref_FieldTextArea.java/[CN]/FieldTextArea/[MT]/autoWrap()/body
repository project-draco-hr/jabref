{
  int pos=getCaretPosition();
  int posAfter=pos + 1;
  StringBuffer sb=new StringBuffer(getText());
  sb.insert(pos,'\n');
  int idx=sb.substring(0,pos).lastIndexOf("\n") + 1;
  String prevLine=sb.substring(idx,pos);
  if (bull.matcher(prevLine).matches()) {
    int id=findFirstNonWhitespace(prevLine);
    if (id >= 0) {
      sb.insert(posAfter,prevLine.substring(0,id));
      posAfter+=id;
    }
  }
 else   if (indent.matcher(prevLine).matches()) {
    int id=findFirstNonWhitespace(prevLine);
    if (id >= 0) {
      sb.insert(posAfter,prevLine.substring(0,id));
      posAfter+=id;
    }
  }
  setText(sb.toString());
  setCaretPosition(posAfter);
}
