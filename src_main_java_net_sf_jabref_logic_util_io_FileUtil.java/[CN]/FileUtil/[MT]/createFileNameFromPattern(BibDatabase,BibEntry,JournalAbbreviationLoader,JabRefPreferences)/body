{
  String targetName=entry.getCiteKeyOptional().orElse("default");
  StringReader sr=new StringReader(prefs.get(JabRefPreferences.IMPORT_FILENAMEPATTERN));
  Layout layout=null;
  try {
    layout=new LayoutHelper(sr,LayoutFormatterPreferences.fromPreferences(prefs,repositoryLoader)).getLayoutFromText();
  }
 catch (  IOException e) {
    LOGGER.info("Wrong format " + e.getMessage(),e);
  }
  if (layout != null) {
    targetName=layout.doLayout(entry,database);
  }
  targetName=FileNameCleaner.cleanFileName(targetName);
  return targetName;
}
