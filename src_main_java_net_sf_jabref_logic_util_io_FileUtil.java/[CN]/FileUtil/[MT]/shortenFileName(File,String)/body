{
  if (fileName == null || !fileName.isAbsolute() || (dir == null)) {
    return fileName;
  }
  String longName;
  if (OS.WINDOWS) {
    longName=fileName.toString().toLowerCase();
    dir=dir.toLowerCase();
  }
 else {
    longName=fileName.toString();
  }
  if (!dir.endsWith(FILE_SEPARATOR)) {
    dir=dir.concat(FILE_SEPARATOR);
  }
  if (longName.startsWith(dir)) {
    String newName=fileName.toString().substring(dir.length());
    return new File(newName);
  }
 else {
    return fileName;
  }
}
