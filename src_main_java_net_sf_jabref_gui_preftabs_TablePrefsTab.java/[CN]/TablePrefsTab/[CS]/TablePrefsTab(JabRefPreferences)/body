{
  this.prefs=prefs;
  setLayout(new BorderLayout());
  Vector<String> fieldNames=new Vector<String>(Arrays.asList(BibtexFields.getAllFieldNames()));
  fieldNames.add(BibtexEntry.KEY_FIELD);
  Collections.sort(fieldNames);
  String[] allPlusKey=fieldNames.toArray(new String[fieldNames.size()]);
  priSort=new JComboBox<>(allPlusKey);
  secSort=new JComboBox<>(allPlusKey);
  terSort=new JComboBox<>(allPlusKey);
  autoResizeMode=new JCheckBox(Localization.lang("Fit table horizontally on screen"));
  namesAsIs=new JRadioButton(Localization.lang("Show names unchanged"));
  namesFf=new JRadioButton(Localization.lang("Show 'Firstname Lastname'"));
  namesFl=new JRadioButton(Localization.lang("Show 'Lastname, Firstname'"));
  namesNatbib=new JRadioButton(Localization.lang("Natbib style"));
  noAbbrNames=new JRadioButton(Localization.lang("Do not abbreviate names"));
  abbrNames=new JRadioButton(Localization.lang("Abbreviate names"));
  lastNamesOnly=new JRadioButton(Localization.lang("Show last names only"));
  floatMarked=new JCheckBox(Localization.lang("Float marked entries"));
  priField=new JTextField(10);
  secField=new JTextField(10);
  terField=new JTextField(10);
  numericFields=new JTextField(30);
  priSort.insertItemAt(Localization.lang("<select>"),0);
  secSort.insertItemAt(Localization.lang("<select>"),0);
  terSort.insertItemAt(Localization.lang("<select>"),0);
  priSort.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      if (priSort.getSelectedIndex() > 0) {
        priField.setText(priSort.getSelectedItem().toString());
        priSort.setSelectedIndex(0);
      }
    }
  }
);
  secSort.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      if (secSort.getSelectedIndex() > 0) {
        secField.setText(secSort.getSelectedItem().toString());
        secSort.setSelectedIndex(0);
      }
    }
  }
);
  terSort.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      if (terSort.getSelectedIndex() > 0) {
        terField.setText(terSort.getSelectedItem().toString());
        terSort.setSelectedIndex(0);
      }
    }
  }
);
  ButtonGroup nameStyle=new ButtonGroup();
  nameStyle.add(namesAsIs);
  nameStyle.add(namesNatbib);
  nameStyle.add(namesFf);
  nameStyle.add(namesFl);
  ButtonGroup nameAbbrev=new ButtonGroup();
  nameAbbrev.add(lastNamesOnly);
  nameAbbrev.add(abbrNames);
  nameAbbrev.add(noAbbrNames);
  priDesc=new JCheckBox(Localization.lang("Descending"));
  secDesc=new JCheckBox(Localization.lang("Descending"));
  terDesc=new JCheckBox(Localization.lang("Descending"));
  FormLayout layout=new FormLayout("1dlu, 8dlu, left:pref, 4dlu, fill:pref, 4dlu, fill:60dlu, 4dlu, fill:pref","");
  DefaultFormBuilder builder=new DefaultFormBuilder(layout);
  JLabel lab;
  JPanel pan=new JPanel();
  builder.appendSeparator(Localization.lang("Format of author and editor names"));
  DefaultFormBuilder nameBuilder=new DefaultFormBuilder(new FormLayout("left:pref, 8dlu, left:pref",""));
  nameBuilder.append(namesAsIs);
  nameBuilder.append(noAbbrNames);
  nameBuilder.nextLine();
  nameBuilder.append(namesFf);
  nameBuilder.append(abbrNames);
  nameBuilder.nextLine();
  nameBuilder.append(namesFl);
  nameBuilder.append(lastNamesOnly);
  nameBuilder.nextLine();
  nameBuilder.append(namesNatbib);
  builder.append(pan);
  builder.append(nameBuilder.getPanel());
  builder.nextLine();
  builder.appendSeparator(Localization.lang("Default sort criteria"));
  FormLayout layout2=new FormLayout("left:pref, 8dlu, fill:pref, 4dlu, fill:60dlu, 4dlu, left:pref","");
  DefaultFormBuilder builder2=new DefaultFormBuilder(layout2);
  lab=new JLabel(Localization.lang("Primary sort criterion"));
  builder2.append(lab);
  builder2.append(priSort);
  builder2.append(priField);
  builder2.append(priDesc);
  builder2.nextLine();
  lab=new JLabel(Localization.lang("Secondary sort criterion"));
  builder2.append(lab);
  builder2.append(secSort);
  builder2.append(secField);
  builder2.append(secDesc);
  builder2.nextLine();
  lab=new JLabel(Localization.lang("Tertiary sort criterion"));
  builder2.append(lab);
  builder2.append(terSort);
  builder2.append(terField);
  builder2.append(terDesc);
  builder.nextLine();
  builder.append(pan);
  builder.append(builder2.getPanel());
  builder.nextLine();
  builder.append(pan);
  builder.append(floatMarked);
  builder.nextLine();
  builder.append(pan);
  builder2=new DefaultFormBuilder(new FormLayout("left:pref, 8dlu, fill:pref",""));
  builder2.append(Localization.lang("Sort the following fields as numeric fields") + ':');
  builder2.append(numericFields);
  builder.append(builder2.getPanel(),5);
  builder.nextLine();
  builder.appendSeparator(Localization.lang("General"));
  builder.append(pan);
  builder.append(autoResizeMode);
  builder.nextLine();
  pan=builder.getPanel();
  pan.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  add(pan,BorderLayout.CENTER);
  namesNatbib.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent changeEvent){
      abbrNames.setEnabled(!namesNatbib.isSelected());
      lastNamesOnly.setEnabled(!namesNatbib.isSelected());
      noAbbrNames.setEnabled(!namesNatbib.isSelected());
    }
  }
);
}
