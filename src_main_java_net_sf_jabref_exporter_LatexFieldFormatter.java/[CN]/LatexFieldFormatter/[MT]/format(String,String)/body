{
  if (content == null) {
    return valueDelimiterStartOfValue + String.valueOf(valueDelimiterEndOfValue);
  }
  String result=content;
  boolean shouldWrapWithBraces=Globals.prefs.putBracesAroundCapitals(fieldName) && !BIBTEX_STRING.equals(fieldName);
  if (shouldWrapWithBraces) {
    result=StringUtil.putBracesAroundCapitals(result);
  }
  boolean shouldNormalizeNewlines=!result.contains(Globals.NEWLINE) && result.contains("\n");
  if (shouldNormalizeNewlines) {
    result=result.replace("\n",Globals.NEWLINE);
  }
  boolean resolveStrings=shouldResolveStrings(fieldName);
  if (!resolveStrings) {
    return formatWithoutResolvingStrings(result,fieldName);
  }
  return formatAndResolveStrings(result,fieldName);
}
