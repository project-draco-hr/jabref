{
  if (content == null) {
    return valueDelimiterStartOfValue + String.valueOf(valueDelimiterEndOfValue);
  }
  boolean shouldWrapWithBraces=Globals.prefs.putBracesAroundCapitals(fieldName) && !BIBTEX_STRING.equals(fieldName);
  if (shouldWrapWithBraces) {
    content=StringUtil.putBracesAroundCapitals(content);
  }
  boolean shouldNormalizeNewlines=!content.contains(Globals.NEWLINE) && content.contains("\n");
  if (shouldNormalizeNewlines) {
    content=content.replace("\n",Globals.NEWLINE);
  }
  boolean resolveStrings=shouldResolveStrings(fieldName);
  if (!resolveStrings) {
    return formatWithoutResolvingStrings(content,fieldName);
  }
  return formatAndResolveStrings(content,fieldName);
}
