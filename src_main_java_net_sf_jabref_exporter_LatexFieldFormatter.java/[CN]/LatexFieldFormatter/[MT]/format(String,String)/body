{
  if (content == null) {
    return valueDelimiterStartOfValue + "" + valueDelimiterEndOfValue;
  }
  if (Globals.prefs.putBracesAroundCapitals(fieldName) && !BIBTEX_STRING.equals(fieldName)) {
    content=StringUtil.putBracesAroundCapitals(content);
  }
  if (!content.contains(Globals.NEWLINE) && content.contains("\n")) {
    content=content.replaceAll("\n",Globals.NEWLINE);
  }
  boolean resolveStrings=shouldResolveStrings(fieldName);
  if (!resolveStrings) {
    return formatWithoutResolvingStrings(content,fieldName);
  }
  return formatAndResolveStrings(content,fieldName);
}
