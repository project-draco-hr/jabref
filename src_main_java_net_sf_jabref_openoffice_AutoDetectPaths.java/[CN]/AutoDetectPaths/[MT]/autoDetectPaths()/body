{
  if (OS.WINDOWS) {
    List<File> progFiles=new OpenOfficeFileSearch().findWindowsProgramFilesDir();
    File sOffice=null;
    List<File> sofficeFiles=new ArrayList<>();
    for (    File dir : progFiles) {
      if (fileSearchCancelled) {
        return false;
      }
      sOffice=findFileDir(dir,"soffice.exe");
      if (sOffice != null) {
        sofficeFiles.add(sOffice);
      }
    }
    if (sOffice == null) {
      JOptionPane.showMessageDialog(parent,Localization.lang("Unable to autodetect OpenOffice/LibreOffice installation. Please choose the installation directory manually."),Localization.lang("Could not find OpenOffice/LibreOffice installation"),JOptionPane.INFORMATION_MESSAGE);
      JFileChooser fileChooser=new JFileChooser(new File(System.getenv("ProgramFiles")));
      fileChooser.setDialogType(JFileChooser.OPEN_DIALOG);
      fileChooser.setFileFilter(new javax.swing.filechooser.FileFilter(){
        @Override public boolean accept(        File file){
          return file.isDirectory();
        }
        @Override public String getDescription(){
          return Localization.lang("Directories");
        }
      }
);
      fileChooser.setFileSelectionMode(JFileChooser.DIRECTORIES_ONLY);
      fileChooser.showOpenDialog(parent);
      if (fileChooser.getSelectedFile() != null) {
        sofficeFiles.add(fileChooser.getSelectedFile());
      }
    }
    if (sOffice == null) {
      return false;
    }
    if (sofficeFiles.size() > 1) {
      DefaultListModel<File> mod=new DefaultListModel<>();
      for (      File tmpfile : sofficeFiles) {
        mod.addElement(tmpfile);
      }
      JList<File> fileList=new JList<>(mod);
      fileList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
      fileList.setSelectedIndex(0);
      FormBuilder builder=FormBuilder.create().layout(new FormLayout("left:pref","pref, 2dlu, pref, 4dlu, pref"));
      builder.add(Localization.lang("Found more than one OpenOffice/LibreOffice executable.")).xy(1,1);
      builder.add(Localization.lang("Please choose which one to connect to:")).xy(1,3);
      builder.add(fileList).xy(1,5);
      int answer=JOptionPane.showConfirmDialog(null,builder.getPanel(),Localization.lang("Choose OpenOffice/LibreOffice executable"),JOptionPane.OK_CANCEL_OPTION);
      if (answer == JOptionPane.CANCEL_OPTION) {
        return false;
      }
 else {
        sOffice=fileList.getSelectedValue();
      }
    }
 else {
      sOffice=sofficeFiles.get(0);
    }
    return setupPreferencesForOO(sOffice.getParentFile(),sOffice,"soffice.exe");
  }
 else   if (OS.OS_X) {
    File rootDir=new File("/Applications");
    File[] files=rootDir.listFiles();
    if (files != null) {
      for (      File file : files) {
        if (file.isDirectory() && ("OpenOffice.org.app".equals(file.getName()) || "LibreOffice.app".equals(file.getName()))) {
          rootDir=file;
          break;
        }
      }
    }
    File sOffice=findFileDir(rootDir,SOFFICE_BIN);
    if (fileSearchCancelled) {
      return false;
    }
    if (sOffice == null) {
      return false;
    }
 else {
      return setupPreferencesForOO(rootDir,sOffice,SOFFICE_BIN);
    }
  }
 else {
    String usrRoot="/usr/lib";
    File inUsr=findFileDir(new File(usrRoot),SOFFICE);
    if (fileSearchCancelled) {
      return false;
    }
    if (inUsr == null) {
      inUsr=findFileDir(new File("/usr/lib64"),SOFFICE);
      if (inUsr != null) {
        usrRoot="/usr/lib64";
      }
    }
    if (fileSearchCancelled) {
      return false;
    }
    File inOpt=findFileDir(new File("/opt"),SOFFICE);
    if (fileSearchCancelled) {
      return false;
    }
    if ((inUsr != null) && (inOpt == null)) {
      return setupPreferencesForOO(usrRoot,inUsr,SOFFICE_BIN);
    }
 else     if (inOpt != null) {
      if (inUsr == null) {
        return setupPreferencesForOO("/opt",inOpt,SOFFICE_BIN);
      }
 else {
        JRadioButton optRB=new JRadioButton(inOpt.getPath(),true);
        JRadioButton usrRB=new JRadioButton(inUsr.getPath(),false);
        ButtonGroup bg=new ButtonGroup();
        bg.add(optRB);
        bg.add(usrRB);
        FormBuilder b=FormBuilder.create().layout(new FormLayout("left:pref","pref, 2dlu, pref, 2dlu, pref "));
        b.add(Localization.lang("Found more than one OpenOffice/LibreOffice executable. Please choose which one to connect to:")).xy(1,1);
        b.add(optRB).xy(1,3);
        b.add(usrRB).xy(1,5);
        int answer=JOptionPane.showConfirmDialog(null,b.getPanel(),Localization.lang("Choose OpenOffice/LibreOffice executable"),JOptionPane.OK_CANCEL_OPTION);
        if (answer == JOptionPane.CANCEL_OPTION) {
          return false;
        }
        if (optRB.isSelected()) {
          return setupPreferencesForOO("/opt",inOpt,SOFFICE_BIN);
        }
 else {
          return setupPreferencesForOO(usrRoot,inUsr,SOFFICE_BIN);
        }
      }
    }
  }
  return false;
}
