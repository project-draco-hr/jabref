{
  final GroupTreeNode node=getNodeToUse();
  final GroupDialog gd=new GroupDialog(frame,panel,null);
  gd.setVisible(true);
  if (!gd.okPressed())   return;
  final AbstractGroup newGroup=gd.getResultingGroup();
  final GroupTreeNode newNode=new GroupTreeNode(newGroup);
  if (node == null)   groupsRoot.add(newNode);
 else   ((GroupTreeNode)node.getParent()).insert(newNode,node.getParent().getIndex(node) + 1);
  UndoableAddOrRemoveGroup undo=new UndoableAddOrRemoveGroup(GroupSelector.this,groupsRoot,newNode,UndoableAddOrRemoveGroup.ADD_NODE);
  revalidateGroups();
  groupsTree.expandPath(new TreePath((node != null ? node : groupsRoot).getPath()));
  panel.undoManager.addEdit(undo);
  panel.markBaseChanged();
  frame.output(Globals.lang("Added group \"%0\".",newGroup.getName()));
}
