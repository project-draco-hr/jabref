{
  int errorCode=0;
  Iterator<String> targetIterator=targetDatabase.getKeySet().iterator();
  boolean abortOperation=false;
  String currentKey;
  BibtexEntry currentEntry;
  Map<String,Boolean> citationHashTable=new HashMap<String,Boolean>();
  Hashtable<Integer,BibtexEntry> rejectedEntries=new Hashtable<Integer,BibtexEntry>();
  InitializeProgressBar initializeProgressBar=new InitializeProgressBar();
  InitializeProgressBarTwo initializeProgressBarTwo=new InitializeProgressBarTwo();
  UpdateProgressBarMaximum updateMaximum=new UpdateProgressBarMaximum(targetDatabase.getEntryCount());
  progressBar2.setVisible(true);
  SwingUtilities.invokeLater(initializeProgressBar);
  SwingUtilities.invokeLater(initializeProgressBarTwo);
  SwingUtilities.invokeLater(updateMaximum);
  int identifierCounter=0;
  UpdateProgressStatus progressStatus=new UpdateProgressStatus(Globals.lang("Fetching Identifiers"));
  SwingUtilities.invokeLater(progressStatus);
  while (targetIterator.hasNext() && !abortOperation) {
    currentKey=targetIterator.next();
    currentEntry=targetDatabase.getEntryById(currentKey);
    abortOperation=generateIdentifierList(currentEntry,citationHashTable,rejectedEntries);
    UpdateProgressBarValue updateValue=new UpdateProgressBarValue(++identifierCounter);
    SwingUtilities.invokeLater(updateValue);
  }
  if (rejectedEntries.size() > 0) {
    errorCode=-1;
    ShowBadIdentifiersDialog badIdentifiersDialog=new ShowBadIdentifiersDialog(rejectedEntries);
    SwingUtilities.invokeLater(badIdentifiersDialog);
  }
  if (citationHashTable.size() > 0) {
    UpdateProgressBarTwoMaximum update2Maximum=new UpdateProgressBarTwoMaximum(citationHashTable.size());
    SwingUtilities.invokeLater(update2Maximum);
  }
  progressStatus=new UpdateProgressStatus(Globals.lang("Fetching Citations"));
  SwingUtilities.invokeLater(progressStatus);
  generateCitationList(citationHashTable,newDatabase);
  progressStatus=new UpdateProgressStatus(Globals.lang("Done"));
  SwingUtilities.invokeLater(progressStatus);
  if (abortOperation)   errorCode=-2;
  return (errorCode);
}
