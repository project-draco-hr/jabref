{
  String writtenValue=null;
  String oldValue=null;
  if (be.hasField(field)) {
    oldValue=be.getField(field);
    if ((newValue == null) || (oldValue.equals(newValue) && nullFieldIfValueIsTheSame)) {
      be.clearField(field);
    }
 else     if (!oldValue.equals(newValue)) {
      writtenValue=newValue;
      be.setField(field,newValue);
    }
  }
 else {
    if (newValue == null) {
      return;
    }
 else {
      writtenValue=newValue;
      be.setField(field,newValue);
    }
  }
  if (ce != null) {
    ce.addEdit(new UndoableFieldChange(be,field,oldValue,writtenValue));
  }
}
