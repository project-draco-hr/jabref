{
  String targetName=entry.getCiteKey() == null ? "default" : entry.getCiteKey();
  StringReader sr=new StringReader(Globals.prefs.get(ImportSettingsTab.PREF_IMPORT_FILENAMEPATTERN));
  Layout layout=null;
  try {
    layout=new LayoutHelper(sr).getLayoutFromText(Globals.FORMATTER_PACKAGE);
  }
 catch (  Exception e) {
    net.sf.jabref.util.Util.LOGGER.info("Wrong format " + e.getMessage(),e);
  }
  if (layout != null) {
    targetName=layout.doLayout(entry,database);
  }
  targetName=FileNameCleaner.cleanFileName(targetName);
  return targetName;
}
