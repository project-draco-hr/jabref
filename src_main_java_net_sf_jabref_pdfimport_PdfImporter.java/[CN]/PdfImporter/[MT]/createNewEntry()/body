{
  EntryTypeDialog etd=new EntryTypeDialog(frame);
  etd.setLocationRelativeTo(frame);
  etd.setVisible(true);
  EntryType type=etd.getChoice();
  if (type != null) {
    String id=IdGenerator.next();
    final BibEntry be=new BibEntry(id,type.getName());
    try {
      panel.database().insertEntry(be);
      ArrayList<BibEntry> list=new ArrayList<>();
      list.add(be);
      UpdateField.setAutomaticFields(list,true,true);
      panel.undoManager.addEdit(new UndoableInsertEntry(panel.database(),be,panel));
      panel.output(Localization.lang("Added new") + " '" + type.getName().toLowerCase()+ "' "+ Localization.lang("entry")+ ".");
      if (panel.getMode() != BasePanelMode.SHOWING_EDITOR) {
        panel.setMode(BasePanelMode.WILL_SHOW_EDITOR);
      }
      panel.showEntry(be);
      panel.markBaseChanged();
      return be;
    }
 catch (    KeyCollisionException ex) {
      LOGGER.info("Key collision occurred",ex);
    }
  }
  return null;
}
