{
  final GroupTreeNode root=panel.getBibDatabaseContext().getMetaData().getGroups();
  final UndoableModifySubtree undo=new UndoableModifySubtree(panel.getGroupSelector(),new GroupTreeNodeViewModel(panel.getBibDatabaseContext().getMetaData().getGroups()),new GroupTreeNodeViewModel(root),Localization.lang("Modified groups"));
  root.removeAllChildren();
  if (changedGroups == null) {
    root.setGroup(new AllEntriesGroup());
  }
 else {
    root.setGroup(changedGroups.getGroup());
    for (    GroupTreeNode child : changedGroups.getChildren()) {
      child.copySubtree().moveTo(root);
    }
    root.refreshGroupsForNewDatabase(panel.database());
  }
  if (panel.getGroupSelector().getGroupTreeRoot().getNode() == root) {
    panel.getGroupSelector().revalidateGroups();
  }
  undoEdit.addEdit(undo);
  tmpGroupRoot.removeAllChildren();
  if (changedGroups != null) {
    GroupTreeNode copied=changedGroups.copySubtree();
    tmpGroupRoot.setGroup(copied.getGroup());
    for (    GroupTreeNode child : copied.getChildren()) {
      child.copySubtree().moveTo(tmpGroupRoot);
    }
  }
  tmpGroupRoot.refreshGroupsForNewDatabase(secondary);
  return true;
}
