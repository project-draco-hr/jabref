{
  String result=s.replaceAll("\\n(?!\\s*\\n)"," ");
  result=result.replaceAll("\\s*\\n\\s*","\n");
  return result.replaceAll(" {2,}"," ").replaceAll("(^\\s*|\\s+$)","");
}
