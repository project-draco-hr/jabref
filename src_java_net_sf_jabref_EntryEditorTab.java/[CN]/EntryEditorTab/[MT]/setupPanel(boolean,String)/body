{
  GridBagLayout gbl=new GridBagLayout();
  GridBagConstraints con=new GridBagConstraints();
  panel.setLayout(gbl);
  double totalWeight=0;
  for (int i=0; i < fields.length; i++) {
    final FieldTextArea ta=new FieldTextArea(fields[i],null);
    JComponent ex=parent.getExtra(fields[i],ta);
    if (firstComponent == null) {
      firstComponent=ex;
    }
    setupJTextComponent(ta);
    editors.put(fields[i],ta);
    if (i == 0)     activeField=ta;
    con.insets=new Insets(5,5,0,0);
    con.anchor=GridBagConstraints.WEST;
    con.fill=GridBagConstraints.BOTH;
    con.gridwidth=1;
    con.weightx=0;
    con.weighty=0;
    con.anchor=GridBagConstraints.NORTH;
    con.fill=GridBagConstraints.BOTH;
    gbl.setConstraints(ta.getLabel(),con);
    panel.add(ta.getLabel());
    con.fill=GridBagConstraints.BOTH;
    con.weightx=1;
    con.weighty=BibtexFields.getFieldWeight(fields[i]);
    totalWeight+=con.weighty;
    if (ex != null)     con.gridwidth=1;
 else     con.gridwidth=GridBagConstraints.REMAINDER;
    gbl.setConstraints(ta.getPane(),con);
    panel.add(ta.getPane());
    if (ex != null) {
      con.gridwidth=GridBagConstraints.REMAINDER;
      con.anchor=GridBagConstraints.NORTH;
      con.fill=GridBagConstraints.HORIZONTAL;
      con.weightx=0;
      gbl.setConstraints(ex,con);
      panel.add(ex);
    }
    panel.setName(title);
  }
  if (addKeyField) {
    con.insets.top+=25;
    con.insets.bottom=10;
    con.gridwidth=1;
    con.weighty=0;
    con.weightx=0;
    con.fill=GridBagConstraints.HORIZONTAL;
    con.anchor=GridBagConstraints.SOUTHWEST;
    final FieldTextField tf=new FieldTextField(BibtexFields.KEY_FIELD,(String)parent.getEntry().getField(BibtexFields.KEY_FIELD),true);
    setupJTextComponent(tf);
    editors.put("bibtexkey",tf);
    if (editors.size() == 1)     activeField=tf;
    gbl.setConstraints(tf.getLabel(),con);
    panel.add(tf.getLabel());
    con.gridwidth=GridBagConstraints.REMAINDER;
    con.weightx=1;
    gbl.setConstraints(tf,con);
    panel.add(tf);
  }
}
