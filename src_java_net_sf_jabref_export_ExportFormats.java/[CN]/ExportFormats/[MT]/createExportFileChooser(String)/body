{
  String lastUsedFormat=Globals.prefs.get("lastUsedExport");
  FileFilter defaultFilter=null;
  JFileChooser fc=new JFileChooser(currentDir);
  TreeSet<FileFilter> filters=new TreeSet<FileFilter>();
  for (Iterator<String> i=exportFormats.keySet().iterator(); i.hasNext(); ) {
    String formatName=i.next();
    ExportFormat format=exportFormats.get(formatName);
    filters.add(format.getFileFilter());
    if (formatName.equals(lastUsedFormat))     defaultFilter=format.getFileFilter();
  }
  for (Iterator<FileFilter> i=filters.iterator(); i.hasNext(); ) {
    fc.addChoosableFileFilter((ExportFileFilter)i.next());
  }
  fc.setAcceptAllFileFilterUsed(false);
  if (defaultFilter != null)   fc.setFileFilter(defaultFilter);
  return fc;
}
