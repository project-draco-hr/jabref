{
  boolean inOriginalOrder;
  if (isSaveOperation) {
    Vector<String> storedSaveOrderConfig=metaData.getData(net.sf.jabref.gui.DatabasePropertiesDialog.SAVE_ORDER_CONFIG);
    if (storedSaveOrderConfig == null) {
      inOriginalOrder=Globals.prefs.getBoolean("saveInOriginalOrder");
    }
 else {
      SaveOrderConfig saveOrderConfig=new SaveOrderConfig(storedSaveOrderConfig);
      inOriginalOrder=saveOrderConfig.saveInOriginalOrder;
    }
  }
 else {
    inOriginalOrder=Globals.prefs.getBoolean("exportInOriginalOrder");
  }
  List<Comparator<BibtexEntry>> comparators;
  if (inOriginalOrder) {
    comparators=new ArrayList<Comparator<BibtexEntry>>();
    comparators.add(new CrossRefEntryComparator());
    comparators.add(new IdComparator());
  }
 else {
    comparators=getSaveComparators(isSaveOperation,metaData);
  }
  FieldComparatorStack<BibtexEntry> comparatorStack=new FieldComparatorStack<BibtexEntry>(comparators);
  BasicEventList<BibtexEntry> entryList=new BasicEventList<BibtexEntry>();
  SortedList<BibtexEntry> sorter=new SortedList<BibtexEntry>(entryList,comparatorStack);
  if (keySet == null) {
    keySet=database.getKeySet();
  }
  if (keySet != null) {
    Iterator<String> i=keySet.iterator();
    for (; i.hasNext(); ) {
      sorter.add(database.getEntryById((i.next())));
    }
  }
  return sorter;
}
