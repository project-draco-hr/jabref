{
  if (data.length == 1) {
    if (!loaded.isEmpty()) {
      ParserResult pr=loaded.get(loaded.size() - 1);
      if (!pr.isInvalid()) {
        try {
          System.out.println(Localization.lang("Saving") + ": " + data[0]);
          SavePreferences prefs=SavePreferences.loadForSaveFromPreferences(Globals.prefs);
          Defaults defaults=new Defaults(BibDatabaseMode.fromPreference(Globals.prefs.getBoolean(JabRefPreferences.BIBLATEX_DEFAULT_MODE)));
          BibDatabaseWriter databaseWriter=new BibDatabaseWriter();
          SaveSession session=databaseWriter.saveDatabase(new BibDatabaseContext(pr.getDatabase(),pr.getMetaData(),defaults),prefs);
          if (!session.getWriter().couldEncodeAll()) {
            System.err.println(Localization.lang("Warning") + ": " + Localization.lang("The chosen encoding '%0' could not encode the following characters:",session.getEncoding().displayName())+ " "+ session.getWriter().getProblemCharacters());
          }
          session.commit(new File(data[0]));
        }
 catch (        SaveException ex) {
          System.err.println(Localization.lang("Could not save file.") + "\n" + ex.getLocalizedMessage());
        }
      }
    }
 else {
      System.err.println(Localization.lang("The output option depends on a valid import option."));
    }
  }
 else   if (data.length == 2) {
    ParserResult pr=loaded.get(loaded.size() - 1);
    File theFile=pr.getFile();
    if (!theFile.isAbsolute()) {
      theFile=theFile.getAbsoluteFile();
    }
    BibDatabaseContext databaseContext=pr.getDatabaseContext();
    databaseContext.setDatabaseFile(theFile);
    Globals.prefs.fileDirForDatabase=databaseContext.getFileDirectory();
    System.out.println(Localization.lang("Exporting") + ": " + data[0]);
    IExportFormat format=ExportFormats.getExportFormat(data[1]);
    if (format == null) {
      System.err.println(Localization.lang("Unknown export format") + ": " + data[1]);
    }
 else {
      try {
        format.performExport(pr.getDatabaseContext(),data[0],pr.getDatabaseContext().getMetaData().getEncoding(),null);
      }
 catch (      Exception ex) {
        System.err.println(Localization.lang("Could not export file") + " '" + data[0]+ "': "+ ex.getMessage());
      }
    }
  }
}
