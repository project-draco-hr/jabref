{
  BasePanel bp=frame.basePanel();
  if (bp == null)   return;
  BibtexEntry[] entries=bp.getSelectedEntries();
  if (diag == null)   createDialog();
  cancelled=true;
  prepareDialog(entries.length > 0);
  Util.placeDialog(diag,frame);
  diag.setVisible(true);
  if (cancelled)   return;
  Collection<BibtexEntry> entryList;
  if (all.isSelected())   entryList=bp.database().getEntries();
 else   entryList=Arrays.asList(entries);
  String toSet=text.getText();
  if (toSet.length() == 0)   toSet=null;
  String[] fields=getFieldNames(field.getText().trim().toLowerCase());
  NamedCompound ce=new NamedCompound(Globals.lang("Set field"));
  if (rename.isSelected()) {
    if (fields.length > 1) {
    }
 else {
      ce.addEdit(Util.massRenameField(entryList,fields[0],renameTo.getText(),overwrite.isSelected()));
    }
  }
 else {
    for (int i=0; i < fields.length; i++) {
      ce.addEdit(Util.massSetField(entryList,fields[i],set.isSelected() ? toSet : null,overwrite.isSelected()));
    }
  }
  ce.end();
  bp.undoManager.addEdit(ce);
  bp.markBaseChanged();
}
