{
  Transferable tsf=dtde.getTransferable();
  dtde.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);
  DataFlavor dtURL=null;
  try {
    dtURL=new DataFlavor("application/x-java-url; class=java.net.URL");
  }
 catch (  ClassNotFoundException e) {
    logger.log(Level.WARNING,"Class not found for DnD... should not happen",e);
  }
  try {
    URL url=(URL)tsf.getTransferData(dtURL);
    JOptionChoice res=(JOptionChoice)JOptionPane.showInputDialog((Component)editor,"",Globals.lang("Select action"),JOptionPane.QUESTION_MESSAGE,null,new JOptionChoice[]{new JOptionChoice(Globals.lang("Insert URL"),0),new JOptionChoice(Globals.lang("Download file"),1)},new JOptionChoice(Globals.lang("Insert URL"),0));
switch (res.getId()) {
case 0:
      feditor.setText(url.toString());
    editor.updateField(feditor);
  break;
case 1:
try {
  File file=new File(new File(Globals.prefs.get("pdfDirectory")),editor.getEntry().getField(Globals.KEY_FIELD) + ".pdf");
  URLDownload udl=new URLDownload((Component)editor,url,file);
  frame.output(Globals.lang("Downloading..."));
  udl.download();
  frame.output(Globals.lang("Download completed"));
  feditor.setText(file.toURL().toString());
  editor.updateField(feditor);
}
 catch (IOException ioex) {
  logger.log(Level.SEVERE,"Error while downloading file",ioex);
  JOptionPane.showMessageDialog((Component)editor,Globals.lang("File download"),Globals.lang("Error while downloading file:" + ioex.getMessage()),JOptionPane.ERROR_MESSAGE);
}
break;
}
return;
}
 catch (UnsupportedFlavorException nfe) {
}
catch (IOException ioex) {
logger.log(Level.WARNING,"!should not happen!",ioex);
}
try {
List filelist=(List)tsf.getTransferData(DataFlavor.javaFileListFlavor);
if (filelist.size() > 1) {
JOptionPane.showMessageDialog((Component)editor,Globals.lang("Only one item is supported"),Globals.lang("Drag and Drop Error"),JOptionPane.ERROR_MESSAGE);
return;
}
File fl=(File)filelist.get(0);
feditor.setText(fl.toURI().toURL().toString());
editor.updateField(feditor);
}
 catch (UnsupportedFlavorException nfe) {
JOptionPane.showMessageDialog((Component)editor,Globals.lang("Operation not supported"),Globals.lang("Drag and Drop Error"),JOptionPane.ERROR_MESSAGE);
logger.log(Level.WARNING,"Transfer exception",nfe);
}
catch (IOException ioex) {
logger.log(Level.WARNING,"Transfer exception",ioex);
}
}
