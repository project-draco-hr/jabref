{
  this.entry=entry;
  this.metaData=metaData;
  AbstractAction okAction=new AbstractAction(){
    private static final long serialVersionUID=-1277323545446098878L;
    @Override public void actionPerformed(    ActionEvent e){
      if (!ok.isEnabled()) {
        return;
      }
      if (externalConfirm != null) {
        FileListEntry testEntry=new FileListEntry("","",null);
        storeSettings(testEntry);
        if (!externalConfirm.confirmClose(testEntry)) {
          return;
        }
      }
      diag.dispose();
      storeSettings(FileListEntryEditor.this.entry);
      okPressed=true;
    }
  }
;
  types=new JComboBox<>();
  types.addItemListener(new ItemListener(){
    @Override public void itemStateChanged(    ItemEvent itemEvent){
      if (!okDisabledExternally) {
        ok.setEnabled(types.getSelectedItem() != null);
      }
    }
  }
);
  FormBuilder builder=FormBuilder.create().layout(new FormLayout("left:pref, 4dlu, fill:150dlu, 4dlu, fill:pref, 4dlu, fill:pref","p, 2dlu, p, 2dlu, p"));
  builder.add(Localization.lang("Link")).xy(1,1);
  builder.add(link).xy(3,1);
  final BrowseListener browse=new BrowseListener(frame,link);
  final JButton browseBut=new JButton(Localization.lang("Browse"));
  browseBut.addActionListener(browse);
  builder.add(browseBut).xy(5,1);
  JButton open=new JButton(Localization.lang("Open"));
  if (showOpenButton) {
    builder.add(open).xy(7,1);
  }
  builder.add(Localization.lang("Description")).xy(1,3);
  builder.add(description).xyw(3,3,3);
  builder.getPanel().setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  builder.add(Localization.lang("File type")).xy(1,5);
  builder.add(types).xyw(3,5,3);
  if (showProgressBar) {
    builder.appendRows("2dlu, p");
    builder.add(downloadLabel).xy(1,7);
    builder.add(prog).xyw(3,7,3);
  }
  ButtonBarBuilder bb=new ButtonBarBuilder();
  bb.addGlue();
  bb.addRelatedGap();
  bb.addButton(ok);
  JButton cancel=new JButton(Localization.lang("Cancel"));
  bb.addButton(cancel);
  bb.addGlue();
  bb.getPanel().setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  ok.addActionListener(okAction);
  link.addActionListener(okAction);
  description.addActionListener(okAction);
  open.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent actionEvent){
      openFile();
    }
  }
);
  AbstractAction cancelAction=new AbstractAction(){
    private static final long serialVersionUID=5291749955917931883L;
    @Override public void actionPerformed(    ActionEvent e){
      diag.dispose();
    }
  }
;
  cancel.addActionListener(cancelAction);
  ActionMap am=builder.getPanel().getActionMap();
  InputMap im=builder.getPanel().getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  im.put(Globals.prefs.getKey("Close dialog"),"close");
  am.put("close",cancelAction);
  link.getDocument().addDocumentListener(new DocumentListener(){
    @Override public void insertUpdate(    DocumentEvent documentEvent){
      checkExtension();
    }
    @Override public void removeUpdate(    DocumentEvent documentEvent){
    }
    @Override public void changedUpdate(    DocumentEvent documentEvent){
      checkExtension();
    }
  }
);
  diag=new JDialog(frame,Localization.lang("Edit file link"),true);
  diag.getContentPane().add(builder.getPanel(),BorderLayout.CENTER);
  diag.getContentPane().add(bb.getPanel(),BorderLayout.SOUTH);
  diag.pack();
  Util.placeDialog(diag,frame);
  diag.addWindowListener(new WindowAdapter(){
    @Override public void windowActivated(    WindowEvent event){
      if (openBrowseWhenShown && !dontOpenBrowseUntilDisposed) {
        dontOpenBrowseUntilDisposed=true;
        SwingUtilities.invokeLater(new Runnable(){
          @Override public void run(){
            browse.actionPerformed(new ActionEvent(browseBut,0,""));
          }
        }
);
      }
    }
    @Override public void windowClosed(    WindowEvent event){
      dontOpenBrowseUntilDisposed=false;
    }
  }
);
  setValues(entry);
}
