{
  this.entry=entry;
  this.metaData=metaData;
  types=new JComboBox(Globals.prefs.getExternalFileTypeSelection());
  types.addItemListener(new ItemListener(){
    public void itemStateChanged(    ItemEvent itemEvent){
      ok.setEnabled(types.getSelectedItem() != null);
    }
  }
);
  DefaultFormBuilder builder=new DefaultFormBuilder(new FormLayout("left:pref, 4dlu, fill:150dlu, 4dlu, fill:pref",""));
  builder.append(Globals.lang("Link"));
  builder.append(link);
  BrowseListener browse=new BrowseListener(parent,link);
  JButton browseBut=new JButton(Globals.lang("Browse"));
  browseBut.addActionListener(browse);
  builder.append(browseBut);
  builder.nextLine();
  builder.append(Globals.lang("Description"));
  builder.append(description);
  builder.getPanel().setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  builder.nextLine();
  builder.append(Globals.lang("File type"));
  builder.append(types);
  if (showProgressBar) {
    builder.nextLine();
    builder.append(downloadLabel);
    builder.append(prog);
  }
  ButtonBarBuilder bb=new ButtonBarBuilder();
  bb.addGlue();
  bb.addGridded(ok);
  bb.addGridded(cancel);
  bb.addGlue();
  ok.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      if (externalConfirm != null) {
        FileListEntry testEntry=new FileListEntry("","",null);
        storeSettings(testEntry);
        if (!externalConfirm.confirmClose(testEntry))         return;
      }
      diag.dispose();
      storeSettings(FileListEntryEditor.this.entry);
      okPressed=true;
    }
  }
);
  cancel.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      diag.dispose();
    }
  }
);
  link.getDocument().addDocumentListener(new DocumentListener(){
    public void insertUpdate(    DocumentEvent documentEvent){
      checkExtension();
    }
    public void removeUpdate(    DocumentEvent documentEvent){
    }
    public void changedUpdate(    DocumentEvent documentEvent){
      checkExtension();
    }
    private void checkExtension(){
      if ((types.getSelectedIndex() == -1) && (link.getText().trim().length() > 0)) {
        String theLink=link.getText().trim();
        int index=theLink.lastIndexOf('.');
        if ((index >= 0) && (index < theLink.length() - 1)) {
          ExternalFileType type=Globals.prefs.getExternalFileTypeByExt(theLink.substring(index + 1));
          if (type != null)           types.setSelectedItem(type);
        }
      }
    }
  }
);
  diag=new JDialog(parent,Globals.lang("Edit file link"),true);
  diag.getContentPane().add(builder.getPanel(),BorderLayout.CENTER);
  diag.getContentPane().add(bb.getPanel(),BorderLayout.SOUTH);
  diag.pack();
  Util.placeDialog(diag,parent);
  setValues(entry);
}
