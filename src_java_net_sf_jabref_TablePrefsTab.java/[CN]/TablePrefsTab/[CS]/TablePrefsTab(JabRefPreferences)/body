{
  _prefs=prefs;
  setLayout(gbl);
  colorCodes=new JCheckBox(Globals.lang("Use color codes for required and optional fields"),_prefs.getBoolean("tableColorCodesOn"));
  autoResizeMode=new JCheckBox(Globals.lang("Fit table horizontally on screen"),(_prefs.getInt("autoResizeMode") == JTable.AUTO_RESIZE_ALL_COLUMNS));
  secDesc=new JCheckBox(Globals.lang("Descending"),_prefs.getBoolean("secDescending"));
  terDesc=new JCheckBox(Globals.lang("Descending"),_prefs.getBoolean("terDescending"));
  tableFields.setText(Util.stringArrayToDelimited(_prefs.getStringArray("columnNames"),";"));
  String[] names=_prefs.getStringArray("columnNames"), lengths=_prefs.getStringArray("columnWidths");
  for (int i=0; i < names.length; i++) {
    if (i < lengths.length)     tableRows.add(new TableRow(names[i],Integer.parseInt(lengths[i])));
 else     tableRows.add(new TableRow(names[i]));
  }
  rowCount=tableRows.size() + 5;
  TableModel tm=new AbstractTableModel(){
    public int getRowCount(){
      return rowCount;
    }
    public int getColumnCount(){
      return 2;
    }
    public Object getValueAt(    int row,    int column){
      if (row >= tableRows.size())       return "";
      Object rowContent=tableRows.elementAt(row);
      if (rowContent == null)       return "";
      TableRow tr=(TableRow)rowContent;
switch (column) {
case 0:
        return tr.name;
case 1:
      return ((tr.length > 0) ? new Integer(tr.length).toString() : "");
  }
  return null;
}
public String getColumnName(int col){
  return (col == 0 ? Globals.lang("Field name") : Globals.lang("Column width"));
}
public Class getColumnClass(int column){
  if (column == 0)   return String.class;
 else   return Integer.class;
}
public boolean isCellEditable(int row,int col){
  return true;
}
public void setValueAt(Object value,int row,int col){
  tableChanged=true;
  while (row >= tableRows.size())   tableRows.add(new TableRow("",-1));
  TableRow rowContent=(TableRow)tableRows.elementAt(row);
  if (col == 0) {
    rowContent.name=value.toString();
    if (((String)getValueAt(row,1)).equals(""))     setValueAt("" + GUIGlobals.DEFAULT_FIELD_LENGTH,row,1);
  }
 else {
    if (value == null)     rowContent.length=-1;
 else     rowContent.length=Integer.parseInt(value.toString());
  }
}
}
;
colSetup=new JTable(tm);
TableColumnModel cm=colSetup.getColumnModel();
cm.getColumn(0).setPreferredWidth(90);
cm.getColumn(1).setPreferredWidth(30);
JLabel lab;
JPanel upper=new JPanel(), sort=new JPanel();
upper.setLayout(gbl);
sort.setLayout(gbl);
upper.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(),Globals.lang("Table appearance")));
sort.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(),Globals.lang("Sort options")));
con.gridwidth=GridBagConstraints.REMAINDER;
con.fill=GridBagConstraints.NONE;
con.anchor=GridBagConstraints.WEST;
gbl.setConstraints(colorCodes,con);
upper.add(colorCodes);
gbl.setConstraints(autoResizeMode,con);
upper.add(autoResizeMode);
con.fill=GridBagConstraints.BOTH;
gbl.setConstraints(upper,con);
add(upper);
String sec=prefs.get("secSort"), ter=prefs.get("terSort");
for (int i=0; i < GUIGlobals.ALL_FIELDS.length; i++) {
if (sec.equals(GUIGlobals.ALL_FIELDS[i])) secSort.setSelectedIndex(i);
if (ter.equals(GUIGlobals.ALL_FIELDS[i])) terSort.setSelectedIndex(i);
}
lab=new JLabel(Globals.lang("Secondary sort criterion"));
con.gridwidth=1;
con.insets=new Insets(0,5,0,0);
gbl.setConstraints(lab,con);
sort.add(lab);
con.weightx=1;
gbl.setConstraints(secSort,con);
sort.add(secSort);
con.gridwidth=GridBagConstraints.REMAINDER;
gbl.setConstraints(secDesc,con);
sort.add(secDesc);
con.gridwidth=1;
lab=new JLabel(Globals.lang("Tertiary sort criterion"));
gbl.setConstraints(lab,con);
sort.add(lab);
con.weightx=0;
gbl.setConstraints(terSort,con);
sort.add(terSort);
con.weightx=1;
con.gridwidth=GridBagConstraints.REMAINDER;
gbl.setConstraints(terDesc,con);
sort.add(terDesc);
con.insets=new Insets(0,0,0,0);
gbl.setConstraints(sort,con);
add(sort);
tableFields.setBorder(BorderFactory.createEtchedBorder());
JScrollPane sp=new JScrollPane(colSetup,JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
sp.setMinimumSize(new Dimension(200,300));
sp.setBorder(BorderFactory.createTitledBorder(BorderFactory.createEtchedBorder(),Globals.lang("Visible fields")));
con.weighty=1;
con.weightx=0;
con.fill=GridBagConstraints.NONE;
gbl.setConstraints(sp,con);
add(sp);
}
