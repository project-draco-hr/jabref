{
  if (!fileOk)   return;
  if (bibtexResult != null) {
    if (!openInNew) {
      final BasePanel panel=(BasePanel)frame.getTabbedPane().getSelectedComponent();
      BibtexDatabase toAddTo=panel.database();
      if (Globals.prefs.getBoolean("useImportInspectionDialog") && (Globals.prefs.getBoolean("useImportInspectionDialogForSingle") || (bibtexResult.getDatabase().getEntryCount() > 1))) {
        ImportInspectionDialog diag=new ImportInspectionDialog(frame,panel,BibtexFields.DEFAULT_INSPECTION_FIELDS,Globals.lang("Import"),openInNew);
        diag.addEntries(bibtexResult.getDatabase().getEntries());
        diag.entryListComplete();
        Util.placeDialog(diag,frame);
        diag.setVisible(true);
        diag.toFront();
      }
 else {
        boolean generateKeys=Globals.prefs.getBoolean("generateKeysAfterInspection");
        NamedCompound ce=new NamedCompound(Globals.lang("Import entries"));
        if (Globals.prefs.getBoolean("unmarkAllEntriesBeforeImporting"))         for (        BibtexEntry entry : toAddTo.getEntries()) {
          Util.unmarkEntry(entry,true,toAddTo,ce);
        }
        for (        BibtexEntry entry : bibtexResult.getDatabase().getEntries()) {
          try {
            boolean keepEntry=true;
            BibtexEntry duplicate=DuplicateCheck.containsDuplicate(toAddTo,entry);
            if (duplicate != null) {
              int answer=DuplicateResolverDialog.resolveDuplicateInImport(frame,duplicate,entry);
              if (answer == DuplicateResolverDialog.DO_NOT_IMPORT)               keepEntry=false;
              if (answer == DuplicateResolverDialog.IMPORT_AND_DELETE_OLD) {
                toAddTo.removeEntry(duplicate.getId());
                ce.addEdit(new UndoableRemoveEntry(toAddTo,duplicate,panel));
              }
            }
            if (keepEntry) {
              toAddTo.insertEntry(entry);
              if (generateKeys) {
                LabelPatternUtil.makeLabel(bibtexResult.getMetaData(),toAddTo,entry);
              }
              ce.addEdit(new UndoableInsertEntry(toAddTo,entry,panel));
            }
          }
 catch (          KeyCollisionException e) {
            e.printStackTrace();
          }
        }
        ce.end();
        if (ce.hasEdits()) {
          panel.undoManager.addEdit(ce);
          panel.markBaseChanged();
        }
      }
    }
 else {
      frame.addTab(bibtexResult.getDatabase(),bibtexResult.getFile(),bibtexResult.getMetaData(),Globals.prefs.get("defaultEncoding"),true);
      frame.output(Globals.lang("Imported entries") + ": " + bibtexResult.getDatabase().getEntryCount());
    }
  }
 else {
    if (importer == null)     frame.output(Globals.lang("Could not find a suitable import format."));
 else {
      if (importError != null) {
        JOptionPane.showMessageDialog(frame,importError.getMessage(),Globals.lang("Import failed"),JOptionPane.ERROR_MESSAGE);
      }
 else {
        JOptionPane.showMessageDialog(frame,Globals.lang("No entries found. Please make sure you are " + "using the correct import filter."),Globals.lang("Import failed"),JOptionPane.ERROR_MESSAGE);
      }
    }
  }
  frame.unblock();
}
